<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Riduzione della Densità per Matrici di Mobilità di Grandi Dimensioni • moneca</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Riduzione della Densità per Matrici di Mobilità di Grandi Dimensioni">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">moneca</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/moneca-introduction.html">Introduction to moneca: Mobility Network Clustering Analysis</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="dropdown-item" href="https://gmontaletti.github.io/MONECA/news/index.html#moneca-100">Version 1.0.0</a></li>
    <li><a class="dropdown-item" href="https://gmontaletti.github.io/MONECA/news/index.html#moneca-09">Version 0.9</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gmontaletti/MONECA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Riduzione della Densità per Matrici di Mobilità di Grandi Dimensioni</h1>
                        <h4 data-toc-skip class="author">Giampaolo
Montaletti</h4>
            
            <h4 data-toc-skip class="date">2026-02-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gmontaletti/MONECA/blob/master/vignettes/reduce_density_guida_it.Rmd" class="external-link"><code>vignettes/reduce_density_guida_it.Rmd</code></a></small>
      <div class="d-none name"><code>reduce_density_guida_it.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduzione">1. Introduzione<a class="anchor" aria-label="anchor" href="#introduzione"></a>
</h2>
<div class="section level3">
<h3 id="il-problema-densità-elevata-e-complessità-computazionale">1.1 Il problema: densità elevata e complessità computazionale<a class="anchor" aria-label="anchor" href="#il-problema-densit%C3%A0-elevata-e-complessit%C3%A0-computazionale"></a>
</h3>
<p>L’algoritmo MONECA analizza tabelle di mobilità attraverso reti
ponderate e cliques per identificare cluster di posizioni con elevata
mobilità interna. Questo approccio funziona in modo efficace per matrici
con 10-50 categorie, dove i pattern di mobilità sono sufficientemente
chiari e il rumore nei dati non oscura le strutture sottostanti.</p>
<div class="section level4">
<h4 id="cosè-la-densità-di-una-matrice">1.1.1 Cos’è la densità di una matrice<a class="anchor" aria-label="anchor" href="#cos%C3%A8-la-densit%C3%A0-di-una-matrice"></a>
</h4>
<p>La <strong>densità</strong> di una matrice è la proporzione di celle
con valori diversi da zero rispetto al totale delle celle:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Densità</mtext><mo>=</mo><mfrac><mtext mathvariant="normal">Numero di celle non-zero</mtext><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{Densità} = \frac{\text{Numero di celle non-zero}}{n \times n}</annotation></semantics></math></p>
<p>Ad esempio, una matrice 80×80 ha 6.400 celle. Se 4.000 celle
contengono valori positivi, la densità è 62.5% (e la sparsità è
37.5%).</p>
</div>
<div class="section level4">
<h4 id="come-moneca-costruisce-la-rete">1.1.2 Come MONECA costruisce la rete<a class="anchor" aria-label="anchor" href="#come-moneca-costruisce-la-rete"></a>
</h4>
<p>MONECA costruisce una rete pesata dalla matrice di mobilità
attraverso due passaggi:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Calcolo dei rischi relativi</strong>: internamente,
<code><a href="../reference/moneca.html">moneca()</a></code> chiama <code><a href="../reference/weight.matrix.html">weight.matrix()</a></code> per calcolare
il rischio relativo (RR) di ogni cella:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>R</mi><mo>=</mo><mfrac><mrow><mi>o</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>o</mi></mrow><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>s</mi><mi>o</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">RR = \frac{osservato}{atteso}</annotation></semantics></math></p></li>
<li><p><strong>Filtraggio con cut.off</strong>: per default,
<code><a href="../reference/weight.matrix.html">weight.matrix()</a></code> usa <code>cut.off = 1</code>, mantenendo
solo le celle con
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>R</mi><mo>≥</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">RR \geq 1</annotation></semantics></math>
(mobilità pari o superiore alle aspettative). Le altre celle vengono
escluse dalla rete.</p></li>
</ol>
<p>La rete risultante ha: - Ogni <strong>categoria</strong> come
<strong>nodo</strong> - Ogni <strong>cella con RR &gt;= 1</strong> come
<strong>arco</strong> tra due nodi</p>
</div>
<div class="section level4">
<h4 id="due-concetti-di-densità">1.1.3 Due concetti di densità<a class="anchor" aria-label="anchor" href="#due-concetti-di-densit%C3%A0"></a>
</h4>
<p>È importante distinguere due concetti di densità:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Densità dei conteggi</strong>: proporzione di celle con
conteggi &gt; 0 nella matrice originale</li>
<li>
<strong>Densità della rete</strong>: proporzione di celle con RR
&gt;= 1 dopo il calcolo dei rischi relativi</li>
</ol>
<p>La <strong>densità della rete</strong> è ciò che determina il numero
di archi nel grafo analizzato da MONECA. Il filtraggio interno con
<code>cut.off = 1</code> è già molto efficace nel ridurre questa
densità.</p>
<p><strong>Esempio tipico:</strong> - Densità conteggi: ~80% (molte
celle con almeno un’osservazione) - Densità rete: ~10-15% (poche celle
con mobilità sopra le aspettative)</p>
</div>
<div class="section level4">
<h4 id="perché-la-densità-della-rete-incide-sui-tempi-di-calcolo">1.1.4 Perché la densità della rete incide sui tempi di calcolo<a class="anchor" aria-label="anchor" href="#perch%C3%A9-la-densit%C3%A0-della-rete-incide-sui-tempi-di-calcolo"></a>
</h4>
<p>L’algoritmo cerca <strong>cliques</strong> (sottografi completi)
nella rete. Il problema computazionale è che il numero di cliques
potenziali cresce in modo <strong>combinatoriale</strong> con il numero
di archi:</p>
<ul>
<li>Più celle con RR &gt;= 1 → più archi nella rete</li>
<li>Più archi → più cliques potenziali da esaminare</li>
<li>Il tempo di calcolo può crescere esponenzialmente</li>
</ul>
</div>
<div class="section level4">
<h4 id="problemi-delle-matrici-di-grandi-dimensioni">1.1.5 Problemi delle matrici di grandi dimensioni<a class="anchor" aria-label="anchor" href="#problemi-delle-matrici-di-grandi-dimensioni"></a>
</h4>
<p>Quando si lavora con matrici di mobilità di grandi dimensioni (60+
categorie), emergono problemi specifici:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Rumore statistico</strong>: con un numero elevato di
categorie, molte celle contengono poche osservazioni, producendo stime
instabili dei rischi relativi</p></li>
<li><p><strong>Falsi positivi nella rete</strong>: celle con pochi
conteggi possono avere RR &gt;= 1 per caso, creando archi “rumorosi”
nella rete</p></li>
<li><p><strong>Esplosione combinatoriale</strong>: più archi nella rete
significa più cliques potenziali, con tempi di calcolo che possono
diventare proibitivi</p></li>
<li><p><strong>Difficoltà interpretativa</strong>: cluster basati su
connessioni deboli (rumore) possono oscurare i pattern di mobilità
sostantivi</p></li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="soluzione-preprocessing-con-reduce_density">1.2 Soluzione: preprocessing con reduce_density()<a class="anchor" aria-label="anchor" href="#soluzione-preprocessing-con-reduce_density"></a>
</h3>
<p>La funzione <code><a href="../reference/reduce_density.html">reduce_density()</a></code> opera sui
<strong>conteggi</strong> della matrice <strong>prima</strong> che
MONECA calcoli i rischi relativi. L’obiettivo è rimuovere il rumore
statistico per ottenere rischi relativi più stabili.</p>
<p><strong>Workflow:</strong></p>
<pre><code>matrice_grezza -&gt; reduce_density() -&gt; moneca()
                                        ↓
                              (internamente chiama weight.matrix)</code></pre>
<p><strong>Importante:</strong> <code><a href="../reference/reduce_density.html">reduce_density()</a></code> non agisce
direttamente sulla densità della rete (celle con RR &gt;= 1), ma
modifica i conteggi. L’effetto sulla rete dipende da come questa
modifica influenza il calcolo dei rischi relativi.</p>
<div class="section level4">
<h4 id="effetto-dei-due-metodi-sulla-densità-della-rete">1.2.1 Effetto dei due metodi sulla densità della rete<a class="anchor" aria-label="anchor" href="#effetto-dei-due-metodi-sulla-densit%C3%A0-della-rete"></a>
</h4>
<p>Entrambi i metodi (SVD e NMF) utilizzano un approccio basato su
filtro:</p>
<p><strong>Approccio unificato (SVD e NMF):</strong></p>
<ul>
<li>Calcolano una ricostruzione a basso rango della matrice</li>
<li>Usano i valori di ricostruzione come <strong>criterio di
filtro</strong> per identificare celle significative</li>
<li>
<strong>Preservano i valori originali</strong> delle celle che
superano la soglia (nessuna distorsione)</li>
<li>
<strong>Azzerano</strong> le celle considerate rumore (valori di
ricostruzione sotto la soglia)</li>
<li>
<strong>Riducono</strong> efficacemente la densità della rete</li>
</ul>
<p><strong>Differenze tra SVD e NMF:</strong></p>
<ul>
<li>
<strong>SVD</strong>: più veloce, usa varianza spiegata per
selezionare k automaticamente</li>
<li>
<strong>NMF</strong>: componenti interpretabili come pattern latenti
di mobilità, richiede <code>RcppML</code>
</li>
<li>Entrambi usano il parametro <code>filter_quantile</code> per
controllare la selezione delle celle</li>
</ul>
</div>
<div class="section level4">
<h4 id="quando-usare-reduce_density">1.2.2 Quando usare reduce_density()<a class="anchor" aria-label="anchor" href="#quando-usare-reduce_density"></a>
</h4>
<p>Il filtraggio interno di MONECA (<code>cut.off = 1</code>) è già
efficace nel ridurre la densità della rete. L’uso di
<code><a href="../reference/reduce_density.html">reduce_density()</a></code> è utile quando:</p>
<ol style="list-style-type: decimal">
<li>
<strong>La matrice è molto grande</strong> (100+ categorie) e il
calcolo è lento</li>
<li>
<strong>Si vuole rimuovere rumore statistico</strong> prima del
calcolo dei rischi relativi</li>
<li>
<strong>Si vogliono preservare i conteggi originali</strong> delle
celle significative (entrambi i metodi preservano i valori
originali)</li>
<li>
<strong>Si vuole ridurre la densità della rete</strong> in modo
controllato tramite il parametro <code>filter_quantile</code>
</li>
</ol>
</div>
</div>
</div>
<div class="section level2">
<h2 id="fondamenti-matematici">2. Fondamenti Matematici<a class="anchor" aria-label="anchor" href="#fondamenti-matematici"></a>
</h2>
<div class="section level3">
<h3 id="decomposizione-ai-valori-singolari-svd">2.1 Decomposizione ai Valori Singolari (SVD)<a class="anchor" aria-label="anchor" href="#decomposizione-ai-valori-singolari-svd"></a>
</h3>
<p>La Singular Value Decomposition (SVD) è una tecnica di
fattorizzazione matriciale che decompone una matrice
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
(dimensioni
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n \times n</annotation></semantics></math>)
nel prodotto di tre matrici:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mi>U</mi><mi>Σ</mi><msup><mi>V</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">M = U \Sigma V^T</annotation></semantics></math></p>
<p>dove:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>U</mi><annotation encoding="application/x-tex">U</annotation></semantics></math>:
matrice ortogonale
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n \times n</annotation></semantics></math>
(vettori singolari sinistri)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Σ</mi><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math>:
matrice diagonale
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n \times n</annotation></semantics></math>
con valori singolari
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mn>1</mn></msub><mo>≥</mo><msub><mi>σ</mi><mn>2</mn></msub><mo>≥</mo><mi>…</mi><mo>≥</mo><msub><mi>σ</mi><mi>n</mi></msub><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\sigma_1 \geq \sigma_2 \geq \ldots \geq \sigma_n \geq 0</annotation></semantics></math>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>V</mi><mi>T</mi></msup><annotation encoding="application/x-tex">V^T</annotation></semantics></math>:
matrice ortogonale
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n \times n</annotation></semantics></math>
trasposta (vettori singolari destri)</li>
</ul>
<div class="section level4">
<h4 id="interpretazione-geometrica">2.1.1 Interpretazione geometrica<a class="anchor" aria-label="anchor" href="#interpretazione-geometrica"></a>
</h4>
<p>I valori singolari
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\sigma_i</annotation></semantics></math>
rappresentano l’importanza delle diverse componenti nella struttura
della matrice. I primi valori singolari catturano la maggior parte della
variabilità, mentre gli ultimi corrispondono principalmente a
rumore.</p>
</div>
<div class="section level4">
<h4 id="riduzione-dimensionale-tramite-svd-troncata">2.1.2 Riduzione dimensionale tramite SVD troncata<a class="anchor" aria-label="anchor" href="#riduzione-dimensionale-tramite-svd-troncata"></a>
</h4>
<p>La SVD troncata a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
componenti
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>&lt;</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">k &lt; n</annotation></semantics></math>)
ricostruisce la matrice mantenendo solo le prime
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
componenti:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mi>k</mi></msub><mo>=</mo><msub><mi>U</mi><mi>k</mi></msub><msub><mi>Σ</mi><mi>k</mi></msub><msubsup><mi>V</mi><mi>k</mi><mi>T</mi></msubsup></mrow><annotation encoding="application/x-tex">M_k = U_k \Sigma_k V_k^T</annotation></semantics></math></p>
<p>dove
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>U</mi><mi>k</mi></msub><annotation encoding="application/x-tex">U_k</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Σ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\Sigma_k</annotation></semantics></math>,
e
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mi>k</mi></msub><annotation encoding="application/x-tex">V_k</annotation></semantics></math>
contengono solo le prime
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
colonne/righe.</p>
<p><strong>Proprietà della SVD troncata:</strong></p>
<ul>
<li>Fornisce la migliore approssimazione a basso rango di
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
in termini di norma di Frobenius</li>
<li>La varianza spiegata dalla componente
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
è proporzionale a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mi>i</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_i^2</annotation></semantics></math>
</li>
<li>La varianza cumulativa spiegata dalle prime
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
componenti è:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></msubsup><msubsup><mi>σ</mi><mi>i</mi><mn>2</mn></msubsup></mrow><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msubsup><mi>σ</mi><mi>i</mi><mn>2</mn></msubsup></mrow></mfrac><annotation encoding="application/x-tex">\frac{\sum_{i=1}^{k} \sigma_i^2}{\sum_{i=1}^{n} \sigma_i^2}</annotation></semantics></math>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="come-la-svd-riduce-la-densità">2.1.3 Come la SVD riduce la densità<a class="anchor" aria-label="anchor" href="#come-la-svd-riduce-la-densit%C3%A0"></a>
</h4>
<p>Nella funzione <code><a href="../reference/reduce_density.html">reduce_density()</a></code>, la SVD utilizza un
approccio di <strong>filtraggio</strong> simile a NMF:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Ricostruzione a basso rango</strong>: usando solo
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
componenti, si ottiene una matrice ricostruita che rappresenta i pattern
dominanti</li>
<li>
<strong>Clipping dei negativi</strong>: eventuali valori negativi
prodotti dalla ricostruzione vengono impostati a zero per il calcolo
della soglia</li>
<li>
<strong>Selezione via quantile</strong>: le celle con valori di
ricostruzione sotto una certa soglia (determinata dal parametro
<code>filter_quantile</code>) vengono considerate rumore</li>
<li>
<strong>Preservazione dei valori originali</strong>: per le celle
identificate come significative, vengono mantenuti i <em>valori
originali</em> della matrice, non i valori ricostruiti</li>
</ol>
<p>Il risultato è una matrice con meno celle non-zero: le connessioni
deboli (rumore) vengono azzerate, mentre le connessioni forti (segnale)
mantengono i loro valori originali intatti.</p>
</div>
<div class="section level4">
<h4 id="vantaggi-e-limitazioni-della-svd">2.1.4 Vantaggi e limitazioni della SVD<a class="anchor" aria-label="anchor" href="#vantaggi-e-limitazioni-della-svd"></a>
</h4>
<p><strong>Vantaggi:</strong></p>
<ul>
<li>Computazionalmente efficiente (libreria <code>irlba</code> per SVD
troncata)</li>
<li>Soluzione ottimale per approssimazione a basso rango</li>
<li>Varianza spiegata facilmente interpretabile</li>
<li>Preserva i valori originali delle celle significative (approccio
filtro)</li>
<li>Parametro <code>filter_quantile</code> regolabile per controllare la
selezione</li>
</ul>
<p><strong>Limitazioni:</strong></p>
<ul>
<li>Il processo di filtraggio si basa su valori di ricostruzione che
possono includere negativi (corretti prima del calcolo della
soglia)</li>
<li>La selezione del quantile può richiedere calibrazione per casi
specifici</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="fattorizzazione-a-matrici-non-negative-nmf">2.2 Fattorizzazione a Matrici Non-Negative (NMF)<a class="anchor" aria-label="anchor" href="#fattorizzazione-a-matrici-non-negative-nmf"></a>
</h3>
<p>La Non-negative Matrix Factorization (NMF) decompone una matrice
non-negativa
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
nel prodotto di due matrici non-negative:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>≈</mo><mi>W</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">M \approx W H</annotation></semantics></math></p>
<p>dove:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>:
matrice
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">n \times k</annotation></semantics></math>
(matrice delle basi)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math>:
matrice
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">k \times n</annotation></semantics></math>
(matrice dei coefficienti)</li>
<li>Tutte le entrate di
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
e
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math>
sono
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\geq 0</annotation></semantics></math>
</li>
</ul>
<div class="section level4">
<h4 id="interpretazione-per-dati-di-mobilità">2.2.1 Interpretazione per dati di mobilità<a class="anchor" aria-label="anchor" href="#interpretazione-per-dati-di-mobilit%C3%A0"></a>
</h4>
<p>La NMF ha un’interpretazione naturale per matrici di mobilità:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>:
rappresenta
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
pattern di mobilità latenti (profili di origine)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math>:
rappresenta i pesi di questi pattern per ciascuna destinazione</li>
<li>Il vincolo di non-negatività preserva l’interpretabilità dei
conteggi</li>
</ul>
</div>
<div class="section level4">
<h4 id="nmf-come-filtro-nella-funzione-reduce_density">2.2.2 NMF come filtro nella funzione reduce_density()<a class="anchor" aria-label="anchor" href="#nmf-come-filtro-nella-funzione-reduce_density"></a>
</h4>
<p>A differenza della SVD, che sostituisce i valori originali con una
ricostruzione a basso rango, nella funzione
<code><a href="../reference/reduce_density.html">reduce_density()</a></code> la NMF viene utilizzata come
<strong>filtro</strong> per identificare celle significative:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Calcolo della ricostruzione</strong>: La decomposizione
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">WH</annotation></semantics></math>
produce una matrice ricostruita che rappresenta i pattern dominanti di
mobilità</li>
<li>
<strong>Identificazione delle celle significative</strong>: I valori
di ricostruzione indicano quanto una cella contribuisce ai pattern
latenti identificati dalla NMF</li>
<li>
<strong>Selezione via quantile</strong>: Le celle con valori di
ricostruzione sotto una certa soglia (determinata dal parametro
<code>filter_quantile</code>) vengono considerate rumore</li>
<li>
<strong>Preservazione dei valori originali</strong>: Per le celle
identificate come significative, vengono mantenuti i <em>valori
originali</em> della matrice, non i valori ricostruiti</li>
</ol>
<p>Questo approccio offre un vantaggio rispetto alla ricostruzione
diretta: i conteggi nella matrice risultante sono esattamente quelli
osservati nei dati originali, senza distorsioni introdotte dalla
ricostruzione. Le celle considerate rumore vengono semplicemente
azzerate.</p>
</div>
<div class="section level4">
<h4 id="come-la-nmf-riduce-la-densità">2.2.3 Come la NMF riduce la densità<a class="anchor" aria-label="anchor" href="#come-la-nmf-riduce-la-densit%C3%A0"></a>
</h4>
<p>La NMF riduce la densità attraverso un approccio di
<strong>filtraggio selettivo</strong>:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Analisi dei pattern latenti</strong>: la decomposizione
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">WH</annotation></semantics></math>
identifica
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
pattern dominanti di mobilità</li>
<li>
<strong>Valutazione delle celle</strong>: ogni cella riceve un
“punteggio di ricostruzione” che indica quanto contribuisce ai pattern
identificati</li>
<li>
<strong>Separazione segnale/rumore</strong>: le celle con punteggi
bassi contribuiscono poco ai pattern dominanti e sono considerate
rumore</li>
<li>
<strong>Azzeramento del rumore</strong>: le celle sotto la soglia
<code>filter_quantile</code> vengono impostate a zero</li>
</ol>
<p>Il risultato è una matrice più sparsa dove: - Le celle significative
mantengono i loro <strong>valori originali</strong> (nessuna
distorsione) - Le celle rumorose sono <strong>azzerate</strong> (rimosse
dalla rete)</p>
<p>Questo riduce il numero di archi nella rete MONECA, accelerando il
calcolo delle cliques.</p>
</div>
<div class="section level4">
<h4 id="algoritmo-di-ottimizzazione">2.2.4 Algoritmo di ottimizzazione<a class="anchor" aria-label="anchor" href="#algoritmo-di-ottimizzazione"></a>
</h4>
<p>La NMF non ha una soluzione analitica chiusa. L’algoritmo standard
minimizza la distanza tra
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
e
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">WH</annotation></semantics></math>
attraverso aggiornamenti iterativi.</p>
<p>La funzione <code><a href="../reference/reduce_density.html">reduce_density()</a></code> utilizza il pacchetto
<code>RcppML</code>, che implementa algoritmi efficienti di NMF.</p>
</div>
<div class="section level4">
<h4 id="vantaggi-e-limitazioni-della-nmf-approccio-filtro">2.2.5 Vantaggi e limitazioni della NMF (approccio filtro)<a class="anchor" aria-label="anchor" href="#vantaggi-e-limitazioni-della-nmf-approccio-filtro"></a>
</h4>
<p><strong>Vantaggi:</strong></p>
<ul>
<li>Preserva i valori originali dei conteggi (nessuna distorsione)</li>
<li>Utilizza NMF per rilevamento intelligente del rumore</li>
<li>Componenti interpretabili per identificare pattern
significativi</li>
<li>Parametro <code>filter_quantile</code> regolabile per controllare la
selezione</li>
</ul>
<p><strong>Limitazioni:</strong></p>
<ul>
<li>Più lenta della SVD (ottimizzazione iterativa)</li>
<li>Richiede inizializzazione casuale (necessario specificare
<code>seed</code> per riproducibilità)</li>
<li>Non ha una metrica diretta di “varianza spiegata”</li>
<li>La selezione del quantile può richiedere calibrazione per casi
specifici</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="normalizzazioni-pre-processing">2.3 Normalizzazioni pre-processing<a class="anchor" aria-label="anchor" href="#normalizzazioni-pre-processing"></a>
</h3>
<p>Prima di applicare SVD o NMF, è possibile trasformare la matrice di
mobilità per enfatizzare aspetti specifici.</p>
<div class="section level4">
<h4 id="nessuna-normalizzazione-normalization-none">2.3.1 Nessuna normalizzazione
(<code>normalization = "none"</code>)<a class="anchor" aria-label="anchor" href="#nessuna-normalizzazione-normalization-none"></a>
</h4>
<p>Utilizza i conteggi grezzi. Adatta quando:</p>
<ul>
<li>Le dimensioni marginali non introducono distorsioni
sistematiche</li>
<li>Si vuole preservare l’informazione sulle frequenze assolute</li>
<li>La matrice è già ragionevolmente bilanciata</li>
</ul>
</div>
<div class="section level4">
<h4 id="residui-di-pearson-normalization-pearson">2.3.2 Residui di Pearson
(<code>normalization = "pearson"</code>)<a class="anchor" aria-label="anchor" href="#residui-di-pearson-normalization-pearson"></a>
</h4>
<p>Standardizza per gli effetti marginali calcolando i residui di
Pearson:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>O</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>−</mo><msub><mi>E</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><msqrt><msub><mi>E</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></msqrt></mfrac></mrow><annotation encoding="application/x-tex">r_{ij} = \frac{O_{ij} - E_{ij}}{\sqrt{E_{ij}}}</annotation></semantics></math></p>
<p>dove
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>O</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">O_{ij}</annotation></semantics></math>
sono i conteggi osservati e
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>E</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mfrac><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mi>e</mi><mi>_</mi><mi>r</mi><mi>i</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mi>e</mi><mi>_</mi><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>n</mi><mi>n</mi><msub><mi>a</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mi>e</mi><mi>_</mi><mi>c</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>i</mi><mi>v</mi><mi>o</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">E_{ij} = \frac{(totale\_riga_i)(totale\_colonna_j)}{totale\_complessivo}</annotation></semantics></math>
sono i conteggi attesi sotto indipendenza.</p>
<p><strong>Utilizzo:</strong> enfatizza deviazioni dal modello di
indipendenza, utile quando le distribuzioni marginali sono
eterogenee.</p>
</div>
<div class="section level4">
<h4 id="ppmi---positive-pointwise-mutual-information-normalization-ppmi">2.3.3 PPMI - Positive Pointwise Mutual Information
(<code>normalization = "ppmi"</code>)<a class="anchor" aria-label="anchor" href="#ppmi---positive-pointwise-mutual-information-normalization-ppmi"></a>
</h4>
<p>Calcola la mutua informazione puntuale positiva:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>P</mi><mi>M</mi><msub><mi>I</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mo>max</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msub><mo>log</mo><mn>2</mn></msub><mfrac><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">PPMI_{ij} = \max\left(0, \log_2\frac{P(i,j)}{P(i)P(j)}\right)</annotation></semantics></math></p>
<p>dove:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>g</mi><mi>g</mi><mi>i</mi><msub><mi>o</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mi>e</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">P(i,j) = \frac{conteggio_{ij}}{totale}</annotation></semantics></math>
(probabilità congiunta)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mi>e</mi><mi>_</mi><mi>r</mi><mi>i</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub></mrow><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mi>e</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">P(i) = \frac{totale\_riga_i}{totale}</annotation></semantics></math>
(probabilità marginale origine)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mi>e</mi><mi>_</mi><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>n</mi><mi>n</mi><msub><mi>a</mi><mi>j</mi></msub></mrow><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mi>e</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">P(j) = \frac{totale\_colonna_j}{totale}</annotation></semantics></math>
(probabilità marginale destinazione)</li>
</ul>
<p><strong>Interpretazione:</strong> valori positivi indicano mobilità
superiore a quanto atteso per caso; valori zero indicano mobilità sotto
le aspettative o assente.</p>
<p><strong>Utilizzo:</strong> enfatizza connessioni di mobilità
sorprendenti rispetto alla casualità, utile per identificare cluster
basati su affinità strutturali piuttosto che su frequenze assolute.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="la-funzione-reduce_density">3. La Funzione <code>reduce_density()</code><a class="anchor" aria-label="anchor" href="#la-funzione-reduce_density"></a>
</h2>
<div class="section level3">
<h3 id="sintassi-e-parametri">3.1 Sintassi e parametri<a class="anchor" aria-label="anchor" href="#sintassi-e-parametri"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span></span>
<span>  <span class="va">mx</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"svd"</span>, <span class="st">"nmf"</span><span class="op">)</span>,</span>
<span>  normalization <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"pearson"</span>, <span class="st">"ppmi"</span><span class="op">)</span>,</span>
<span>  k <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  variance_target <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  threshold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  threshold_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sd"</span>, <span class="st">"percentile"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  filter_quantile <span class="op">=</span> <span class="st">"auto"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="parametri-obbligatori">3.1.1 Parametri obbligatori<a class="anchor" aria-label="anchor" href="#parametri-obbligatori"></a>
</h4>
<p><strong><code>mx</code></strong>: matrice di mobilità in formato
standard moneca (con riga e colonna dei totali). Deve essere quadrata e
contenere almeno 4 categorie (5 righe inclusi i totali).</p>
</div>
<div class="section level4">
<h4 id="parametri-del-metodo-di-riduzione">3.1.2 Parametri del metodo di riduzione<a class="anchor" aria-label="anchor" href="#parametri-del-metodo-di-riduzione"></a>
</h4>
<p><strong><code>method</code></strong>: metodo di riduzione
dimensionale da utilizzare.</p>
<ul>
<li>
<code>"svd"</code> (default): Singular Value Decomposition. Veloce,
efficiente in memoria, usa la varianza spiegata per selezionare k
automaticamente. Consigliata come prima scelta.</li>
<li>
<code>"nmf"</code>: Non-negative Matrix Factorization. Componenti
interpretabili come pattern latenti di mobilità. Richiede il pacchetto
<code>RcppML</code>.</li>
</ul>
<p><strong><code>filter_quantile</code></strong>: parametro che si
applica a entrambi i metodi (SVD e NMF). Controlla la proporzione di
celle da mantenere.</p>
<ul>
<li>
<code>"auto"</code> (default): selezione automatica basata sul
rilevamento del gomito (elbow) sui valori di ricostruzione ordinati</li>
<li>numerico (0-1): proporzione di celle da mantenere. Es.
<code>0.75</code> mantiene il 75% delle celle con i valori di
ricostruzione più alti</li>
</ul>
<p><strong>Nota importante</strong>: Entrambi i metodi (SVD e NMF) usano
i valori di ricostruzione solo per <em>identificare</em> quali celle
sono significative (segnale vs rumore), ma restituiscono i <em>valori
originali</em> per quelle celle. Questo preserva l’interpretabilità dei
conteggi senza introdurre distorsioni.</p>
<p><strong><code>normalization</code></strong>: trasformazione
pre-processing da applicare.</p>
<ul>
<li>
<code>"none"</code> (default): nessuna normalizzazione, utilizza
conteggi grezzi</li>
<li>
<code>"pearson"</code>: residui di Pearson, standardizza per effetti
marginali</li>
<li>
<code>"ppmi"</code>: Positive Pointwise Mutual Information,
enfatizza mobilità sopra il caso</li>
</ul>
</div>
<div class="section level4">
<h4 id="parametri-per-la-selezione-delle-componenti">3.1.3 Parametri per la selezione delle componenti<a class="anchor" aria-label="anchor" href="#parametri-per-la-selezione-delle-componenti"></a>
</h4>
<p><strong><code>k</code></strong>: numero di componenti da
mantenere.</p>
<ul>
<li>
<code>"auto"</code> (default): selezione automatica basata su
varianza spiegata e rilevamento del gomito (elbow)</li>
<li>intero positivo: specifica manualmente il numero di componenti
(tipicamente 15-25 per matrici 60+)</li>
</ul>
<p><strong><code>variance_target</code></strong>: valore numerico (0-1)
che specifica la varianza cumulativa target quando
<code>k = "auto"</code>. Default <code>0.75</code> (75%). Valori più
alti mantengono più dettaglio ma anche più rumore.</p>
</div>
<div class="section level4">
<h4 id="parametri-di-post-processing">3.1.4 Parametri di post-processing<a class="anchor" aria-label="anchor" href="#parametri-di-post-processing"></a>
</h4>
<p><strong><code>threshold</code></strong>: soglia opzionale per
aumentare la sparsità.</p>
<ul>
<li>
<code>NULL</code> (default): nessuna soglia applicata</li>
<li>
<code>"auto"</code>: soglia automatica (media + 1 deviazione
standard)</li>
<li>numerico: valori sotto questa soglia vengono impostati a zero</li>
</ul>
<p><strong><code>threshold_type</code></strong>: interpretazione della
soglia numerica.</p>
<ul>
<li>
<code>"sd"</code> (default): numero di deviazioni standard sopra la
media</li>
<li>
<code>"percentile"</code>: soglia percentile (0-100)</li>
</ul>
</div>
<div class="section level4">
<h4 id="parametri-di-controllo">3.1.5 Parametri di controllo<a class="anchor" aria-label="anchor" href="#parametri-di-controllo"></a>
</h4>
<p><strong><code>verbose</code></strong>: logico. Se <code>TRUE</code>,
stampa informazioni sul progresso dell’elaborazione. Default
<code>FALSE</code>.</p>
<p><strong><code>seed</code></strong>: intero opzionale per garantire
riproducibilità. Particolarmente importante per NMF che usa
inizializzazione casuale.</p>
</div>
</div>
<div class="section level3">
<h3 id="valore-restituito">3.2 Valore restituito<a class="anchor" aria-label="anchor" href="#valore-restituito"></a>
</h3>
<p>La funzione restituisce un oggetto di classe
<code>"density_reduced"</code> (eredita da <code>"matrix"</code>) con i
seguenti attributi:</p>
<ul>
<li>
<strong><code>method</code></strong>: metodo di riduzione utilizzato
(“svd” o “nmf”)</li>
<li>
<strong><code>normalization</code></strong>: metodo di
normalizzazione applicato</li>
<li>
<strong><code>k</code></strong>: numero di componenti mantenute</li>
<li>
<strong><code>variance_explained</code></strong>: proporzione di
varianza spiegata (solo per SVD)</li>
<li>
<strong><code>filter_quantile</code></strong>: quantile di filtro
utilizzato (entrambi i metodi) - indica la proporzione di celle
mantenute basata sui valori di ricostruzione</li>
<li>
<strong><code>threshold_applied</code></strong>: valore di soglia
applicato (se presente)</li>
<li>
<strong><code>original_dims</code></strong>: dimensioni della
matrice originale (senza totali)</li>
<li>
<strong><code>original_total</code></strong>: totale delle
osservazioni originali</li>
<li>
<strong><code>reduced_total</code></strong>: totale delle
osservazioni dopo riduzione</li>
</ul>
<p>L’oggetto può essere stampato direttamente per visualizzare un
riepilogo delle operazioni eseguite.</p>
</div>
<div class="section level3">
<h3 id="pipeline-di-elaborazione">3.3 Pipeline di elaborazione<a class="anchor" aria-label="anchor" href="#pipeline-di-elaborazione"></a>
</h3>
<p>La funzione esegue i seguenti passaggi:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Validazione input</strong>: verifica formato matrice ed
estrae la matrice core (escludendo riga/colonna totali)</li>
<li>
<strong>Normalizzazione</strong>: applica opzionalmente
trasformazioni PPMI o residui di Pearson</li>
<li>
<strong>Selezione componenti</strong>: quando
<code>k = "auto"</code>, usa varianza spiegata con rilevamento del
gomito</li>
<li>
<strong>Riduzione dimensionale</strong>: applica SVD o NMF per
estrarre pattern dominanti</li>
<li>
<strong>Ricostruzione</strong>: ricostruisce la matrice dalle
componenti ridotte</li>
<li>
<strong>Filtraggio</strong>: usa i valori di ricostruzione come
soglia per identificare celle significative. Le celle con valori di
ricostruzione sotto la soglia (<code>filter_quantile</code>) vengono
azzerate. I valori originali vengono preservati per le celle che passano
il filtro.</li>
<li>
<strong>Soglia opzionale</strong>: imposta valori bassi a zero se
richiesto (threshold aggiuntivo)</li>
<li>
<strong>Ricalcolo totali</strong>: aggiorna riga e colonna dei
totali</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="esempi-pratici">4. Esempi Pratici<a class="anchor" aria-label="anchor" href="#esempi-pratici"></a>
</h2>
<div class="section level3">
<h3 id="preparazione-dei-dati-di-esempio">4.1 Preparazione dei dati di esempio<a class="anchor" aria-label="anchor" href="#preparazione-dei-dati-di-esempio"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Carica il pacchetto</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gmontaletti.github.io/MONECA/">moneca</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Genera una matrice di mobilità di grandi dimensioni (80 classi)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">large_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_mobility_data.html">generate_mobility_data</a></span><span class="op">(</span></span>
<span>  n_classes <span class="op">=</span> <span class="fl">80</span>,</span>
<span>  n_total <span class="op">=</span> <span class="fl">100000</span>,</span>
<span>  immobility_strength <span class="op">=</span> <span class="fl">0.65</span>,</span>
<span>  class_clustering <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>  noise_level <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>  class_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%02d"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">80</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Informazioni sulla matrice</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Dimensioni matrice:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">large_data</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Dimensioni matrice: 81 81</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Totale osservazioni:"</span>, <span class="va">large_data</span><span class="op">[</span><span class="fl">81</span>, <span class="fl">81</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Totale osservazioni: 1e+05</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Celle non-zero:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">large_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">80</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">80</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, <span class="st">"su"</span>, <span class="fl">80</span><span class="op">*</span><span class="fl">80</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Celle non-zero: 4885 su 6400</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Sparsità:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">large_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">80</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">80</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">80</span><span class="op">*</span><span class="fl">80</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sparsità: 23.7 %</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizzazione-dello-scree-plot">4.2 Visualizzazione dello scree plot<a class="anchor" aria-label="anchor" href="#visualizzazione-dello-scree-plot"></a>
</h3>
<p>Prima di applicare la riduzione, è utile visualizzare la varianza
spiegata per componente per capire quante componenti sono
necessarie.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Crea lo scree plot</span></span>
<span><span class="va">p_scree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_scree.html">plot_scree</a></span><span class="op">(</span></span>
<span>  <span class="va">large_data</span>,</span>
<span>  max_components <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  variance_target <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  show_elbow <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Scree Plot: Varianza Spiegata per Componente"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_scree</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/density-scree_plot-1.png" class="r-plt" alt="" width="100%"></p>
<p><strong>Interpretazione dello scree plot:</strong></p>
<ul>
<li>
<strong>Barre blu</strong>: varianza spiegata da ciascuna componente
individuale</li>
<li>
<strong>Linea rossa</strong>: varianza cumulativa spiegata</li>
<li>
<strong>Linea tratteggiata orizzontale</strong>: target di varianza
(75% in questo caso)</li>
<li>
<strong>Linea verticale rossa</strong>: numero di componenti
necessarie per raggiungere il target</li>
<li>
<strong>Linea verticale verde</strong>: punto di gomito rilevato
automaticamente</li>
</ul>
<p>Lo scree plot mostra che le prime componenti catturano la maggior
parte della varianza, mentre le componenti successive contribuiscono
progressivamente meno. Il punto di gomito indica dove il beneficio
marginale di aggiungere componenti diventa trascurabile.</p>
</div>
<div class="section level3">
<h3 id="esempio-1-riduzione-base-con-svd-e-selezione-automatica-di-k">4.3 Esempio 1: Riduzione base con SVD e selezione automatica di
k<a class="anchor" aria-label="anchor" href="#esempio-1-riduzione-base-con-svd-e-selezione-automatica-di-k"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Riduzione base con parametri di default</span></span>
<span><span class="va">reduced_basic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span></span>
<span>  <span class="va">large_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"svd"</span>,</span>
<span>  normalization <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  k <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  variance_target <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualizza il risultato</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">reduced_basic</span><span class="op">)</span></span>
<span><span class="co">#&gt; Density-Reduced Mobility Matrix</span></span>
<span><span class="co">#&gt; ================================</span></span>
<span><span class="co">#&gt; Dimensions: 80 x 80 categories</span></span>
<span><span class="co">#&gt; Method: svd</span></span>
<span><span class="co">#&gt; Normalization: none</span></span>
<span><span class="co">#&gt; Components (k): 16</span></span>
<span><span class="co">#&gt; Variance explained: 75.3%</span></span>
<span><span class="co">#&gt; Filter quantile: 25.0% (keeps top cells by reconstruction)</span></span>
<span><span class="co">#&gt; Observations: 100000 -&gt; 80086 (80.1% retained)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Core matrix preview (first 5x5):</span></span>
<span><span class="co">#&gt;     C01  C02 C03 C04  C05</span></span>
<span><span class="co">#&gt; C01 465   99  49   1    0</span></span>
<span><span class="co">#&gt; C02 286 1467 286 172    0</span></span>
<span><span class="co">#&gt; C03   4   17  62  10    6</span></span>
<span><span class="co">#&gt; C04   3   73 149 683  140</span></span>
<span><span class="co">#&gt; C05   0    0 163 339 1866</span></span></code></pre></div>
<p><strong>Cosa è successo:</strong></p>
<ol style="list-style-type: decimal">
<li>La funzione ha estratto la matrice core 80×80 (escludendo i
totali)</li>
<li>Ha calcolato la SVD per determinare automaticamente k</li>
<li>Ha selezionato il numero di componenti che spiegano il 75% della
varianza</li>
<li>Ha ricostruito la matrice mantenendo solo queste componenti</li>
<li>Ha arrotondato i valori a interi e ricalcolato i totali</li>
</ol>
<p><strong>Interpretazione del risultato:</strong></p>
<ul>
<li>Il numero di componenti selezionate (k) bilancia la preservazione
della struttura con la riduzione del rumore</li>
<li>La percentuale di varianza spiegata indica quanto della variabilità
originale è stata mantenuta</li>
<li>La percentuale di osservazioni mantenute mostra l’effetto
dell’arrotondamento e della rimozione di rumore</li>
</ul>
</div>
<div class="section level3">
<h3 id="esempio-2-riduzione-con-normalizzazione-ppmi">4.4 Esempio 2: Riduzione con normalizzazione PPMI<a class="anchor" aria-label="anchor" href="#esempio-2-riduzione-con-normalizzazione-ppmi"></a>
</h3>
<p>La normalizzazione PPMI è utile quando si vogliono enfatizzare le
connessioni di mobilità che superano le aspettative casuali,
indipendentemente dalla frequenza assoluta.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Riduzione con PPMI</span></span>
<span><span class="va">reduced_ppmi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span></span>
<span>  <span class="va">large_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"svd"</span>,</span>
<span>  normalization <span class="op">=</span> <span class="st">"ppmi"</span>,</span>
<span>  k <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  variance_target <span class="op">=</span> <span class="fl">0.80</span>,  <span class="co"># Target più alto per preservare più struttura</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">reduced_ppmi</span><span class="op">)</span></span>
<span><span class="co">#&gt; Density-Reduced Mobility Matrix</span></span>
<span><span class="co">#&gt; ================================</span></span>
<span><span class="co">#&gt; Dimensions: 80 x 80 categories</span></span>
<span><span class="co">#&gt; Method: svd</span></span>
<span><span class="co">#&gt; Normalization: ppmi</span></span>
<span><span class="co">#&gt; Components (k): 18</span></span>
<span><span class="co">#&gt; Variance explained: 81.2%</span></span>
<span><span class="co">#&gt; Filter quantile: 25.0% (keeps top cells by reconstruction)</span></span>
<span><span class="co">#&gt; Observations: 100000 -&gt; 88909 (88.9% retained)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Core matrix preview (first 5x5):</span></span>
<span><span class="co">#&gt;     C01  C02 C03 C04  C05</span></span>
<span><span class="co">#&gt; C01 465   99  49   1    2</span></span>
<span><span class="co">#&gt; C02 286 1467 286 172    2</span></span>
<span><span class="co">#&gt; C03   4   17  62  10    6</span></span>
<span><span class="co">#&gt; C04   3   73 149 683  140</span></span>
<span><span class="co">#&gt; C05   1    6 163 339 1866</span></span></code></pre></div>
<p><strong>Confronto con la riduzione base:</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Confronta le dimensioni ridotte</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Riduzione base (none):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Riduzione base (none):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  k ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">reduced_basic</span>, <span class="st">"k"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   k = 16</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Varianza spiegata ="</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">reduced_basic</span>, <span class="st">"variance_explained"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Varianza spiegata = 75.3 %</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Riduzione PPMI:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Riduzione PPMI:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  k ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">reduced_ppmi</span>, <span class="st">"k"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   k = 18</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Varianza spiegata ="</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">reduced_ppmi</span>, <span class="st">"variance_explained"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Varianza spiegata = 81.2 %</span></span></code></pre></div>
<p><strong>Differenze attese:</strong></p>
<ul>
<li>La normalizzazione PPMI trasforma i dati prima della SVD,
enfatizzando pattern di co-occorrenza</li>
<li>Il numero di componenti necessarie potrebbe differire</li>
<li>La matrice ricostruita enfatizza mobilità “sorprendente” rispetto al
caso</li>
</ul>
</div>
<div class="section level3">
<h3 id="esempio-3-riduzione-con-nmf-approccio-filtro">4.5 Esempio 3: Riduzione con NMF (approccio filtro)<a class="anchor" aria-label="anchor" href="#esempio-3-riduzione-con-nmf-approccio-filtro"></a>
</h3>
<p>La NMF utilizza un approccio diverso dalla SVD: invece di sostituire
i valori con una ricostruzione, la NMF identifica le celle significative
e preserva i valori originali.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Riduzione con NMF - selezione automatica del quantile</span></span>
<span><span class="va">reduced_nmf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span></span>
<span>  <span class="va">large_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"nmf"</span>,</span>
<span>  normalization <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">20</span>,  <span class="co"># Specifica k manualmente per NMF</span></span>
<span>  filter_quantile <span class="op">=</span> <span class="st">"auto"</span>,  <span class="co"># Selezione automatica via elbow detection</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">reduced_nmf</span><span class="op">)</span></span>
<span><span class="co">#&gt; Density-Reduced Mobility Matrix</span></span>
<span><span class="co">#&gt; ================================</span></span>
<span><span class="co">#&gt; Dimensions: 80 x 80 categories</span></span>
<span><span class="co">#&gt; Method: nmf</span></span>
<span><span class="co">#&gt; Normalization: none</span></span>
<span><span class="co">#&gt; Components (k): 20</span></span>
<span><span class="co">#&gt; Filter quantile: 25.0% (keeps top cells by reconstruction)</span></span>
<span><span class="co">#&gt; Observations: 100000 -&gt; 84774 (84.8% retained)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Core matrix preview (first 5x5):</span></span>
<span><span class="co">#&gt;     C01  C02 C03 C04  C05</span></span>
<span><span class="co">#&gt; C01 465   99  49   1    0</span></span>
<span><span class="co">#&gt; C02 286 1467 286 172    0</span></span>
<span><span class="co">#&gt; C03   4   17  62  10    6</span></span>
<span><span class="co">#&gt; C04   3   73 149 683  140</span></span>
<span><span class="co">#&gt; C05   0    0 163 339 1866</span></span></code></pre></div>
<p><strong>Come funziona l’approccio NMF filtro:</strong></p>
<p>L’output verbose mostra informazioni sul processo di filtraggio:</p>
<ul>
<li>“Auto quantile selection: keep top X% of cells” indica la
proporzione di celle selezionate automaticamente</li>
<li>“NMF filter: keeping N/M cells (X%)” mostra quante celle sono state
mantenute</li>
<li>I valori nella matrice risultante sono i <strong>conteggi
originali</strong>, non valori ricostruiti</li>
</ul>
<p><strong>Specifica manuale del quantile:</strong></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Riduzione con quantile specificato manualmente</span></span>
<span><span class="va">reduced_nmf_75</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span></span>
<span>  <span class="va">large_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"nmf"</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  filter_quantile <span class="op">=</span> <span class="fl">0.75</span>,  <span class="co"># Mantieni il 75% delle celle più significative</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Il filter_quantile viene salvato come attributo</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Filter quantile utilizzato:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">reduced_nmf_75</span>, <span class="st">"filter_quantile"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Filter quantile utilizzato: 0.75</span></span></code></pre></div>
<p><strong>Note sulla NMF:</strong></p>
<ul>
<li>Richiede il pacchetto <code>RcppML</code>
(<code>install.packages("RcppML")</code>)</li>
<li>Preserva i valori originali dei conteggi (nessuna distorsione)</li>
<li>Il parametro <code>filter_quantile</code> controlla la selezione:
valori più alti mantengono più celle</li>
<li>L’argomento <code>seed</code> è essenziale per la
riproducibilità</li>
<li>Specificare <code>k</code> manualmente è spesso preferibile per
NMF</li>
</ul>
</div>
<div class="section level3">
<h3 id="esempio-4-riduzione-con-soglia-per-aumentare-la-sparsità">4.6 Esempio 4: Riduzione con soglia per aumentare la sparsità<a class="anchor" aria-label="anchor" href="#esempio-4-riduzione-con-soglia-per-aumentare-la-sparsit%C3%A0"></a>
</h3>
<p>L’applicazione di una soglia può rimuovere ulteriormente valori bassi
che potrebbero rappresentare rumore.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Riduzione con soglia automatica</span></span>
<span><span class="va">reduced_sparse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span></span>
<span>  <span class="va">large_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"svd"</span>,</span>
<span>  k <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  variance_target <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  threshold <span class="op">=</span> <span class="st">"auto"</span>,  <span class="co"># Soglia automatica: media + 1 SD</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">reduced_sparse</span><span class="op">)</span></span>
<span><span class="co">#&gt; Density-Reduced Mobility Matrix</span></span>
<span><span class="co">#&gt; ================================</span></span>
<span><span class="co">#&gt; Dimensions: 80 x 80 categories</span></span>
<span><span class="co">#&gt; Method: svd</span></span>
<span><span class="co">#&gt; Normalization: none</span></span>
<span><span class="co">#&gt; Components (k): 16</span></span>
<span><span class="co">#&gt; Variance explained: 75.3%</span></span>
<span><span class="co">#&gt; Filter quantile: 25.0% (keeps top cells by reconstruction)</span></span>
<span><span class="co">#&gt; Threshold applied: 108.56</span></span>
<span><span class="co">#&gt; Observations: 100000 -&gt; 66974 (67.0% retained)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Core matrix preview (first 5x5):</span></span>
<span><span class="co">#&gt;     C01  C02 C03 C04  C05</span></span>
<span><span class="co">#&gt; C01 465    0   0   0    0</span></span>
<span><span class="co">#&gt; C02 286 1467 286 172    0</span></span>
<span><span class="co">#&gt; C03   0    0   0   0    0</span></span>
<span><span class="co">#&gt; C04   0    0 149 683  140</span></span>
<span><span class="co">#&gt; C05   0    0 163 339 1866</span></span>
<span></span>
<span><span class="co"># Confronta la sparsità</span></span>
<span><span class="va">sparsity_original</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">large_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">80</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">80</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">80</span><span class="op">*</span><span class="fl">80</span><span class="op">)</span></span>
<span><span class="va">sparsity_basic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">reduced_basic</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">80</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">80</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">80</span><span class="op">*</span><span class="fl">80</span><span class="op">)</span></span>
<span><span class="va">sparsity_sparse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">reduced_sparse</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">80</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">80</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">80</span><span class="op">*</span><span class="fl">80</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nConfronto sparsità:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Confronto sparsità:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Originale:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">sparsity_original</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Originale: 23.7 %</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Riduzione base:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">sparsity_basic</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Riduzione base: 77.2 %</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Con soglia:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">sparsity_sparse</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Con soglia: 97.6 %</span></span></code></pre></div>
<p><strong>Effetto della soglia:</strong></p>
<ul>
<li>La soglia rimuove valori bassi che possono rappresentare rumore</li>
<li>Aumenta la sparsità della matrice</li>
<li>Può migliorare l’identificazione di cluster nella successiva analisi
MONECA</li>
</ul>
</div>
<div class="section level3">
<h3 id="esempio-5-riduzione-con-soglia-personalizzata">4.7 Esempio 5: Riduzione con soglia personalizzata<a class="anchor" aria-label="anchor" href="#esempio-5-riduzione-con-soglia-personalizzata"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Soglia basata su deviazioni standard</span></span>
<span><span class="va">reduced_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span></span>
<span>  <span class="va">large_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"svd"</span>,</span>
<span>  k <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">1.5</span>,  <span class="co"># 1.5 deviazioni standard sopra la media</span></span>
<span>  threshold_type <span class="op">=</span> <span class="st">"sd"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Soglia basata su percentile</span></span>
<span><span class="va">reduced_percentile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span></span>
<span>  <span class="va">large_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"svd"</span>,</span>
<span>  k <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">25</span>,  <span class="co"># Mantieni solo valori sopra il 25° percentile</span></span>
<span>  threshold_type <span class="op">=</span> <span class="st">"percentile"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Soglia SD:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">reduced_sd</span>, <span class="st">"threshold_applied"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Soglia SD: 156.576</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Soglia percentile:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">reduced_percentile</span>, <span class="st">"threshold_applied"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Soglia percentile: 0</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="integrazione-con-il-workflow-moneca">5. Integrazione con il Workflow MONECA<a class="anchor" aria-label="anchor" href="#integrazione-con-il-workflow-moneca"></a>
</h2>
<div class="section level3">
<h3 id="pipeline-completa-da-riduzione-ad-analisi">5.1 Pipeline completa: da riduzione ad analisi<a class="anchor" aria-label="anchor" href="#pipeline-completa-da-riduzione-ad-analisi"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Riduzione della densità</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span></span>
<span>  <span class="va">large_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"svd"</span>,</span>
<span>  normalization <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  k <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  variance_target <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Analisi MONECA sulla matrice ridotta</span></span>
<span><span class="va">seg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moneca.html">moneca</a></span><span class="op">(</span></span>
<span>  <span class="va">reduced</span>,</span>
<span>  segment.levels <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  small.cell.reduction <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |==                                                                    |   3%  |                                                                              |=====                                                                 |   6%  |                                                                              |=======                                                               |  10%  |                                                                              |=========                                                             |  13%  |                                                                              |===========                                                           |  16%  |                                                                              |==============                                                        |  19%  |                                                                              |================                                                      |  23%</span></span>
<span><span class="co">#&gt; 25% ready!</span></span>
<span><span class="co">#&gt;   |                                                                              |==================                                                    |  26%  |                                                                              |====================                                                  |  29%  |                                                                              |=======================                                               |  32%  |                                                                              |=========================                                             |  35%  |                                                                              |===========================                                           |  39%  |                                                                              |=============================                                         |  42%  |                                                                              |================================                                      |  45%  |                                                                              |==================================                                    |  48%</span></span>
<span><span class="co">#&gt; 50% ready!</span></span>
<span><span class="co">#&gt;   |                                                                              |====================================                                  |  52%  |                                                                              |======================================                                |  55%  |                                                                              |=========================================                             |  58%  |                                                                              |===========================================                           |  61%  |                                                                              |=============================================                         |  65%  |                                                                              |===============================================                       |  68%  |                                                                              |==================================================                    |  71%  |                                                                              |====================================================                  |  74%</span></span>
<span><span class="co">#&gt; 75% ready!</span></span>
<span><span class="co">#&gt;   |                                                                              |======================================================                |  77%  |                                                                              |========================================================              |  81%  |                                                                              |===========================================================           |  84%  |                                                                              |=============================================================         |  87%  |                                                                              |===============================================================       |  90%  |                                                                              |=================================================================     |  94%  |                                                                              |====================================================================  |  97%  |                                                                              |======================================================================| 100%</span></span>
<span><span class="co">#&gt; 100% ready!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |===                                                                   |   4%  |                                                                              |======                                                                |   9%  |                                                                              |=========                                                             |  13%  |                                                                              |============                                                          |  17%  |                                                                              |===============                                                       |  22%</span></span>
<span><span class="co">#&gt; 25% ready!</span></span>
<span><span class="co">#&gt;   |                                                                              |==================                                                    |  26%  |                                                                              |=====================                                                 |  30%  |                                                                              |========================                                              |  35%  |                                                                              |===========================                                           |  39%  |                                                                              |==============================                                        |  43%  |                                                                              |=================================                                     |  48%</span></span>
<span><span class="co">#&gt; 50% ready!</span></span>
<span><span class="co">#&gt;   |                                                                              |=====================================                                 |  52%  |                                                                              |========================================                              |  57%  |                                                                              |===========================================                           |  61%  |                                                                              |==============================================                        |  65%  |                                                                              |=================================================                     |  70%  |                                                                              |====================================================                  |  74%</span></span>
<span><span class="co">#&gt; 75% ready!</span></span>
<span><span class="co">#&gt;   |                                                                              |=======================================================               |  78%  |                                                                              |==========================================================            |  83%  |                                                                              |=============================================================         |  87%  |                                                                              |================================================================      |  91%  |                                                                              |===================================================================   |  96%  |                                                                              |======================================================================| 100%</span></span>
<span><span class="co">#&gt; 100% ready!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |====                                                                  |   6%  |                                                                              |========                                                              |  12%  |                                                                              |============                                                          |  18%  |                                                                              |================                                                      |  24%</span></span>
<span><span class="co">#&gt; 28% ready!</span></span>
<span><span class="co">#&gt;   |                                                                              |=====================                                                 |  29%  |                                                                              |=========================                                             |  35%  |                                                                              |=============================                                         |  41%  |                                                                              |=================================                                     |  47%</span></span>
<span><span class="co">#&gt; 50% ready!</span></span>
<span><span class="co">#&gt;   |                                                                              |=====================================                                 |  53%  |                                                                              |=========================================                             |  59%  |                                                                              |=============================================                         |  65%  |                                                                              |=================================================                     |  71%  |                                                                              |======================================================                |  76%</span></span>
<span><span class="co">#&gt; 78% ready!</span></span>
<span><span class="co">#&gt;   |                                                                              |==========================================================            |  82%  |                                                                              |==============================================================        |  88%  |                                                                              |==================================================================    |  94%  |                                                                              |======================================================================| 100%</span></span>
<span><span class="co">#&gt; 100% ready!</span></span>
<span></span>
<span><span class="co"># 3. Visualizza i risultati</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">seg</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt;                         moneca MOBILITY ANALYSIS RESULTS                        </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; OVERALL MOBILITY PATTERNS</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Overall Population Mobility Rate:                    40.0%</span></span>
<span><span class="co">#&gt; Average Mobility Concentration (all levels):         94.2%</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; HIERARCHICAL SEGMENTATION ANALYSIS</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Internal Mobility Within Segments (%):</span></span>
<span><span class="co">#&gt; Level 1 Level 2 Level 3 Level 4 </span></span>
<span><span class="co">#&gt;    60.0    67.5    76.0    82.0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Mobility Concentration in Significant Pathways by Level (%):</span></span>
<span><span class="co">#&gt; Level 1 Level 2 Level 3 Level 4 </span></span>
<span><span class="co">#&gt;    95.3    94.8    94.6    92.2 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Network Structure by Level:</span></span>
<span><span class="co">#&gt;                                    Level 1      Level 2      Level 3      Level 4 </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Active Segments/Classes:                80           65           51           41 </span></span>
<span><span class="co">#&gt; Significant Edges:                      34           34           27           14 </span></span>
<span><span class="co">#&gt; Network Density:                     0.005        0.008        0.011        0.009 </span></span>
<span><span class="co">#&gt; Isolated Segments:                      38           31           24           24 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; DETAILED WEIGHTED DEGREE DISTRIBUTIONS (STRENGTH)</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total Weighted Connections (Strength In + Out):</span></span>
<span><span class="co">#&gt;         Min Q1 Median Mean    Q3   Max</span></span>
<span><span class="co">#&gt; Level 1   0  0   4.73 6.37 11.19 25.77</span></span>
<span><span class="co">#&gt; Level 2   0  0   5.12 5.61 10.10 19.05</span></span>
<span><span class="co">#&gt; Level 3   0  0   3.16 3.82  7.16 13.54</span></span>
<span><span class="co">#&gt; Level 4   0  0   0.00 2.39  3.46 11.22</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Outward Mobility Strength (Weighted Out-Degree):</span></span>
<span><span class="co">#&gt;         Min Q1 Median Mean   Q3   Max</span></span>
<span><span class="co">#&gt; Level 1   0  0      0 3.19 0.00 25.00</span></span>
<span><span class="co">#&gt; Level 2   0  0      0 2.81 5.43 14.87</span></span>
<span><span class="co">#&gt; Level 3   0  0      0 1.91 3.30 10.77</span></span>
<span><span class="co">#&gt; Level 4   0  0      0 1.19 1.29 10.75</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Inward Mobility Strength (Weighted In-Degree):</span></span>
<span><span class="co">#&gt;         Min Q1 Median Mean   Q3   Max</span></span>
<span><span class="co">#&gt; Level 1   0  0      0 3.19 6.38 16.74</span></span>
<span><span class="co">#&gt; Level 2   0  0      0 2.81 5.39 11.76</span></span>
<span><span class="co">#&gt; Level 3   0  0      0 1.91 4.01  9.75</span></span>
<span><span class="co">#&gt; Level 4   0  0      0 1.19 1.60 10.75</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Edge Weight Distribution (Relative Risk Values):</span></span>
<span><span class="co">#&gt;          Min   Q1 Median Mean   Q3   Max</span></span>
<span><span class="co">#&gt; Level 1 3.25 5.93   6.83 7.50 8.83 16.74</span></span>
<span><span class="co">#&gt; Level 2 2.35 3.71   5.07 5.37 6.51 11.76</span></span>
<span><span class="co">#&gt; Level 3 1.36 1.95   3.16 3.61 4.33  9.75</span></span>
<span><span class="co">#&gt; Level 4 1.09 1.70   2.84 3.50 3.81 10.75</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ================================================================================</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="confronto-con-e-senza-riduzione">5.2 Confronto: con e senza riduzione<a class="anchor" aria-label="anchor" href="#confronto-con-e-senza-riduzione"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analisi senza riduzione (potrebbe essere computazionalmente onerosa)</span></span>
<span><span class="co"># NOTA: con 80 classi, questo può richiedere molto tempo</span></span>
<span><span class="co"># seg_original &lt;- moneca(large_data, segment.levels = 3)</span></span>
<span></span>
<span><span class="co"># Analisi con riduzione (già calcolata)</span></span>
<span><span class="va">seg_reduced</span> <span class="op">&lt;-</span> <span class="va">seg</span></span>
<span></span>
<span><span class="co"># Visualizza la qualità dei segmenti</span></span>
<span><span class="va">quality_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment.quality.html">segment.quality</a></span><span class="op">(</span><span class="va">seg_reduced</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">quality_reduced</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Membership 1: Segment 1: within.mobility 1: share.of.mobility 1: Density</span></span>
<span><span class="co">#&gt; C77       4.10         77              0.653                0.031        NaN</span></span>
<span><span class="co">#&gt; C76       4.10         76              0.461                0.011        NaN</span></span>
<span><span class="co">#&gt; C78       4.10         78              0.493                0.013        NaN</span></span>
<span><span class="co">#&gt; C80       4.10         80              0.762                0.036        NaN</span></span>
<span><span class="co">#&gt; C79       4.10         79              0.567                0.017        NaN</span></span>
<span><span class="co">#&gt; C49        4.3         49              0.682                0.040        NaN</span></span>
<span><span class="co">#&gt; C50        4.3         50              0.249                0.007        NaN</span></span>
<span><span class="co">#&gt; C54        4.6         54              0.613                0.025        NaN</span></span>
<span><span class="co">#&gt; C53        4.6         53              0.537                0.015        NaN</span></span>
<span><span class="co">#&gt; C52        4.6         52              0.627                0.018        NaN</span></span>
<span><span class="co">#&gt; C48        4.3         48              0.451                0.011        NaN</span></span>
<span><span class="co">#&gt; C47        4.3         47              0.631                0.017        NaN</span></span>
<span><span class="co">#&gt; C51        4.6         51              0.595                0.016        NaN</span></span>
<span><span class="co">#&gt; C14        4.7         14              0.671                0.028        NaN</span></span>
<span><span class="co">#&gt; C15        4.7         15              0.608                0.023        NaN</span></span>
<span><span class="co">#&gt; C16        4.7         16              0.553                0.013        NaN</span></span>
<span><span class="co">#&gt; C13        4.7         13              0.444                0.010        NaN</span></span>
<span><span class="co">#&gt; C05        4.4          5              0.682                0.034        NaN</span></span>
<span><span class="co">#&gt; C04        4.4          4              0.558                0.015        NaN</span></span>
<span><span class="co">#&gt; C06        4.4          6              0.632                0.018        NaN</span></span>
<span><span class="co">#&gt; C07        4.4          7              0.295                0.006        NaN</span></span>
<span><span class="co">#&gt; C28        4.5         28              0.622                0.021        NaN</span></span>
<span><span class="co">#&gt; C29        4.5         29              0.639                0.019        NaN</span></span>
<span><span class="co">#&gt; C30        4.5         30              0.597                0.013        NaN</span></span>
<span><span class="co">#&gt; C31        4.5         31              0.638                0.015        NaN</span></span>
<span><span class="co">#&gt; C68        4.8         68              0.641                0.025        NaN</span></span>
<span><span class="co">#&gt; C67        4.8         67              0.603                0.017        NaN</span></span>
<span><span class="co">#&gt; C69        4.8         69              0.601                0.018        NaN</span></span>
<span><span class="co">#&gt; C66        4.8         66              0.489                0.007        NaN</span></span>
<span><span class="co">#&gt; C09        4.2          9              0.667                0.026        NaN</span></span>
<span><span class="co">#&gt; C08        4.2          8              0.000                0.003        NaN</span></span>
<span><span class="co">#&gt; C10        4.2         10              0.621                0.017        NaN</span></span>
<span><span class="co">#&gt; C11        4.2         11              0.627                0.018        NaN</span></span>
<span><span class="co">#&gt; C35        4.9         35              0.667                0.026        NaN</span></span>
<span><span class="co">#&gt; C36        4.9         36              0.348                0.007        NaN</span></span>
<span><span class="co">#&gt; C34        4.9         34              0.587                0.012        NaN</span></span>
<span><span class="co">#&gt; C33        4.9         33              0.596                0.011        NaN</span></span>
<span><span class="co">#&gt; C59        4.1         59              0.674                0.019        NaN</span></span>
<span><span class="co">#&gt; C58        4.1         58              0.515                0.008        NaN</span></span>
<span><span class="co">#&gt; C60        4.1         60              0.638                0.013        NaN</span></span>
<span><span class="co">#&gt; C61        4.1         61              0.403                0.005        NaN</span></span>
<span><span class="co">#&gt; C55       3.11         55              0.667                0.039        NaN</span></span>
<span><span class="co">#&gt; C56       3.11         56              0.467                0.011        NaN</span></span>
<span><span class="co">#&gt; C57       3.11         57              0.439                0.007        NaN</span></span>
<span><span class="co">#&gt; C75        3.3         75              0.651                0.028        NaN</span></span>
<span><span class="co">#&gt; C74        3.3         74              0.457                0.009        NaN</span></span>
<span><span class="co">#&gt; C73        3.3         73              0.603                0.015        NaN</span></span>
<span><span class="co">#&gt; C27       3.12         27              0.680                0.021        NaN</span></span>
<span><span class="co">#&gt; C26       3.12         26              0.572                0.012        NaN</span></span>
<span><span class="co">#&gt; C25       3.12         25              0.667                0.010        NaN</span></span>
<span><span class="co">#&gt; C02        3.2          2              0.709                0.026        NaN</span></span>
<span><span class="co">#&gt; C03        3.2          3              0.148                0.005        NaN</span></span>
<span><span class="co">#&gt; C01        3.2          1              0.659                0.009        NaN</span></span>
<span><span class="co">#&gt; C37       1.37         37              0.653                0.016        NaN</span></span>
<span><span class="co">#&gt; C12       1.12         12              0.584                0.014        NaN</span></span>
<span><span class="co">#&gt; C71       1.71         71              0.680                0.013        NaN</span></span>
<span><span class="co">#&gt; C64       1.64         64              0.883                0.012        NaN</span></span>
<span><span class="co">#&gt; C70       1.70         70              0.551                0.011        NaN</span></span>
<span><span class="co">#&gt; C17       1.17         17              0.581                0.009        NaN</span></span>
<span><span class="co">#&gt; C32       1.32         32              0.000                0.003        NaN</span></span>
<span><span class="co">#&gt; C46       1.46         46              0.000                0.003        NaN</span></span>
<span><span class="co">#&gt; C18       1.18         18              0.000                0.002        NaN</span></span>
<span><span class="co">#&gt; C24       1.24         24              0.000                0.002        NaN</span></span>
<span><span class="co">#&gt; C38       1.38         38              0.000                0.002        NaN</span></span>
<span><span class="co">#&gt; C65       1.65         65              0.000                0.002        NaN</span></span>
<span><span class="co">#&gt; C72       1.72         72              0.000                0.002        NaN</span></span>
<span><span class="co">#&gt; C20       1.20         20              0.000                0.001        NaN</span></span>
<span><span class="co">#&gt; C39       1.39         39              0.000                0.001        NaN</span></span>
<span><span class="co">#&gt; C40       1.40         40              0.000                0.001        NaN</span></span>
<span><span class="co">#&gt; C41       1.41         41              0.000                0.001        NaN</span></span>
<span><span class="co">#&gt; C42       1.42         42              0.000                0.001        NaN</span></span>
<span><span class="co">#&gt; C62       1.62         62              0.000                0.001        NaN</span></span>
<span><span class="co">#&gt; C63       1.63         63              0.000                0.001        NaN</span></span>
<span><span class="co">#&gt; C19       1.19         19              0.000                0.000        NaN</span></span>
<span><span class="co">#&gt; C21       1.21         21              0.000                0.000        NaN</span></span>
<span><span class="co">#&gt; C22       1.22         22              0.000                0.000        NaN</span></span>
<span><span class="co">#&gt; C23       1.23         23              0.000                0.000        NaN</span></span>
<span><span class="co">#&gt; C43       1.43         43              0.000                0.000        NaN</span></span>
<span><span class="co">#&gt; C44       1.44         44              0.000                0.000        NaN</span></span>
<span><span class="co">#&gt; C45       1.45         45              0.000                0.000        NaN</span></span>
<span><span class="co">#&gt;     1: Nodes 1: Max.path 1: share.of.total 2: Segment 2: within.mobility</span></span>
<span><span class="co">#&gt; C77        1           0             0.031         10              0.722</span></span>
<span><span class="co">#&gt; C76        1           0             0.011         10              0.722</span></span>
<span><span class="co">#&gt; C78        1           0             0.013         NA                 NA</span></span>
<span><span class="co">#&gt; C80        1           0             0.036         11              0.843</span></span>
<span><span class="co">#&gt; C79        1           0             0.017         11              0.843</span></span>
<span><span class="co">#&gt; C49        1           0             0.040          7              0.728</span></span>
<span><span class="co">#&gt; C50        1           0             0.007          7              0.728</span></span>
<span><span class="co">#&gt; C54        1           0             0.025         15              0.692</span></span>
<span><span class="co">#&gt; C53        1           0             0.015         15              0.692</span></span>
<span><span class="co">#&gt; C52        1           0             0.018         NA                 NA</span></span>
<span><span class="co">#&gt; C48        1           0             0.011         NA                 NA</span></span>
<span><span class="co">#&gt; C47        1           0             0.017         NA                 NA</span></span>
<span><span class="co">#&gt; C51        1           0             0.016         NA                 NA</span></span>
<span><span class="co">#&gt; C14        1           0             0.028          6              0.771</span></span>
<span><span class="co">#&gt; C15        1           0             0.023          6              0.771</span></span>
<span><span class="co">#&gt; C16        1           0             0.013         NA                 NA</span></span>
<span><span class="co">#&gt; C13        1           0             0.010         NA                 NA</span></span>
<span><span class="co">#&gt; C05        1           0             0.034         13              0.765</span></span>
<span><span class="co">#&gt; C04        1           0             0.015         13              0.765</span></span>
<span><span class="co">#&gt; C06        1           0             0.018         NA                 NA</span></span>
<span><span class="co">#&gt; C07        1           0             0.006         NA                 NA</span></span>
<span><span class="co">#&gt; C28        1           0             0.021         14              0.751</span></span>
<span><span class="co">#&gt; C29        1           0             0.019         14              0.751</span></span>
<span><span class="co">#&gt; C30        1           0             0.013         NA                 NA</span></span>
<span><span class="co">#&gt; C31        1           0             0.015         NA                 NA</span></span>
<span><span class="co">#&gt; C68        1           0             0.025         12              0.754</span></span>
<span><span class="co">#&gt; C67        1           0             0.017         12              0.754</span></span>
<span><span class="co">#&gt; C69        1           0             0.018         NA                 NA</span></span>
<span><span class="co">#&gt; C66        1           0             0.007         NA                 NA</span></span>
<span><span class="co">#&gt; C09        1           0             0.026          1              0.709</span></span>
<span><span class="co">#&gt; C08        1           0             0.003          1              0.709</span></span>
<span><span class="co">#&gt; C10        1           0             0.017         NA                 NA</span></span>
<span><span class="co">#&gt; C11        1           0             0.018         NA                 NA</span></span>
<span><span class="co">#&gt; C35        1           0             0.026          4              0.721</span></span>
<span><span class="co">#&gt; C36        1           0             0.007          4              0.721</span></span>
<span><span class="co">#&gt; C34        1           0             0.012         NA                 NA</span></span>
<span><span class="co">#&gt; C33        1           0             0.011         NA                 NA</span></span>
<span><span class="co">#&gt; C59        1           0             0.019          2              0.752</span></span>
<span><span class="co">#&gt; C58        1           0             0.008          2              0.752</span></span>
<span><span class="co">#&gt; C60        1           0             0.013         NA                 NA</span></span>
<span><span class="co">#&gt; C61        1           0             0.005         NA                 NA</span></span>
<span><span class="co">#&gt; C55        1           0             0.039          8              0.748</span></span>
<span><span class="co">#&gt; C56        1           0             0.011          8              0.748</span></span>
<span><span class="co">#&gt; C57        1           0             0.007         NA                 NA</span></span>
<span><span class="co">#&gt; C75        1           0             0.028          5              0.731</span></span>
<span><span class="co">#&gt; C74        1           0             0.009          5              0.731</span></span>
<span><span class="co">#&gt; C73        1           0             0.015         NA                 NA</span></span>
<span><span class="co">#&gt; C27        1           0             0.021          9              0.761</span></span>
<span><span class="co">#&gt; C26        1           0             0.012          9              0.761</span></span>
<span><span class="co">#&gt; C25        1           0             0.010         NA                 NA</span></span>
<span><span class="co">#&gt; C02        1           0             0.026          3              0.736</span></span>
<span><span class="co">#&gt; C03        1           0             0.005          3              0.736</span></span>
<span><span class="co">#&gt; C01        1           0             0.009         NA                 NA</span></span>
<span><span class="co">#&gt; C37        1           0             0.016         NA                 NA</span></span>
<span><span class="co">#&gt; C12        1           0             0.014         NA                 NA</span></span>
<span><span class="co">#&gt; C71        1           0             0.013         NA                 NA</span></span>
<span><span class="co">#&gt; C64        1           0             0.012         NA                 NA</span></span>
<span><span class="co">#&gt; C70        1           0             0.011         NA                 NA</span></span>
<span><span class="co">#&gt; C17        1           0             0.009         NA                 NA</span></span>
<span><span class="co">#&gt; C32        1           0             0.003         NA                 NA</span></span>
<span><span class="co">#&gt; C46        1           0             0.003         NA                 NA</span></span>
<span><span class="co">#&gt; C18        1           0             0.002         NA                 NA</span></span>
<span><span class="co">#&gt; C24        1           0             0.002         NA                 NA</span></span>
<span><span class="co">#&gt; C38        1           0             0.002         NA                 NA</span></span>
<span><span class="co">#&gt; C65        1           0             0.002         NA                 NA</span></span>
<span><span class="co">#&gt; C72        1           0             0.002         NA                 NA</span></span>
<span><span class="co">#&gt; C20        1           0             0.001         NA                 NA</span></span>
<span><span class="co">#&gt; C39        1           0             0.001         NA                 NA</span></span>
<span><span class="co">#&gt; C40        1           0             0.001         NA                 NA</span></span>
<span><span class="co">#&gt; C41        1           0             0.001         NA                 NA</span></span>
<span><span class="co">#&gt; C42        1           0             0.001         NA                 NA</span></span>
<span><span class="co">#&gt; C62        1           0             0.001         NA                 NA</span></span>
<span><span class="co">#&gt; C63        1           0             0.001         NA                 NA</span></span>
<span><span class="co">#&gt; C19        1           0             0.000         NA                 NA</span></span>
<span><span class="co">#&gt; C21        1           0             0.000         NA                 NA</span></span>
<span><span class="co">#&gt; C22        1           0             0.000         NA                 NA</span></span>
<span><span class="co">#&gt; C23        1           0             0.000         NA                 NA</span></span>
<span><span class="co">#&gt; C43        1           0             0.000         NA                 NA</span></span>
<span><span class="co">#&gt; C44        1           0             0.000         NA                 NA</span></span>
<span><span class="co">#&gt; C45        1           0             0.000         NA                 NA</span></span>
<span><span class="co">#&gt;     2: share.of.mobility 2: Density 2: Nodes 2: Max.path 2: share.of.total</span></span>
<span><span class="co">#&gt; C77                0.042          1        2           1             0.042</span></span>
<span><span class="co">#&gt; C76                0.042          1        2           1             0.042</span></span>
<span><span class="co">#&gt; C78                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C80                0.053          1        2           1             0.053</span></span>
<span><span class="co">#&gt; C79                0.053          1        2           1             0.053</span></span>
<span><span class="co">#&gt; C49                0.047          1        2           1             0.047</span></span>
<span><span class="co">#&gt; C50                0.047          1        2           1             0.047</span></span>
<span><span class="co">#&gt; C54                0.040          1        2           1             0.040</span></span>
<span><span class="co">#&gt; C53                0.040          1        2           1             0.040</span></span>
<span><span class="co">#&gt; C52                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C48                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C47                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C51                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C14                0.051          1        2           1             0.051</span></span>
<span><span class="co">#&gt; C15                0.051          1        2           1             0.051</span></span>
<span><span class="co">#&gt; C16                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C13                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C05                0.049          1        2           1             0.049</span></span>
<span><span class="co">#&gt; C04                0.049          1        2           1             0.049</span></span>
<span><span class="co">#&gt; C06                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C07                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C28                0.040          1        2           1             0.040</span></span>
<span><span class="co">#&gt; C29                0.040          1        2           1             0.040</span></span>
<span><span class="co">#&gt; C30                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C31                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C68                0.042          1        2           1             0.042</span></span>
<span><span class="co">#&gt; C67                0.042          1        2           1             0.042</span></span>
<span><span class="co">#&gt; C69                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C66                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C09                0.030          1        2           1             0.030</span></span>
<span><span class="co">#&gt; C08                0.030          1        2           1             0.030</span></span>
<span><span class="co">#&gt; C10                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C11                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C35                0.033          1        2           1             0.033</span></span>
<span><span class="co">#&gt; C36                0.033          1        2           1             0.033</span></span>
<span><span class="co">#&gt; C34                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C33                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C59                0.027          1        2           1             0.027</span></span>
<span><span class="co">#&gt; C58                0.027          1        2           1             0.027</span></span>
<span><span class="co">#&gt; C60                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C61                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C55                0.050          1        2           1             0.050</span></span>
<span><span class="co">#&gt; C56                0.050          1        2           1             0.050</span></span>
<span><span class="co">#&gt; C57                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C75                0.037          1        2           1             0.037</span></span>
<span><span class="co">#&gt; C74                0.037          1        2           1             0.037</span></span>
<span><span class="co">#&gt; C73                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C27                0.034          1        2           1             0.034</span></span>
<span><span class="co">#&gt; C26                0.034          1        2           1             0.034</span></span>
<span><span class="co">#&gt; C25                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C02                0.031          1        2           1             0.031</span></span>
<span><span class="co">#&gt; C03                0.031          1        2           1             0.031</span></span>
<span><span class="co">#&gt; C01                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C37                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C12                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C71                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C64                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C70                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C17                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C32                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C46                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C18                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C24                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C38                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C65                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C72                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C20                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C39                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C40                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C41                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C42                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C62                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C63                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C19                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C21                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C22                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C23                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C43                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C44                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C45                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt;     3: Segment 3: within.mobility 3: share.of.mobility 3: Density 3: Nodes</span></span>
<span><span class="co">#&gt; C77         13              0.785                0.055  1.0000000        3</span></span>
<span><span class="co">#&gt; C76         13              0.785                0.055  1.0000000        3</span></span>
<span><span class="co">#&gt; C78         13              0.785                0.055  1.0000000        3</span></span>
<span><span class="co">#&gt; C80         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C79         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C49         10              0.805                0.058  1.0000000        3</span></span>
<span><span class="co">#&gt; C50         10              0.805                0.058  1.0000000        3</span></span>
<span><span class="co">#&gt; C54          8              0.778                0.058  1.0000000        3</span></span>
<span><span class="co">#&gt; C53          8              0.778                0.058  1.0000000        3</span></span>
<span><span class="co">#&gt; C52          8              0.778                0.058  1.0000000        3</span></span>
<span><span class="co">#&gt; C48         10              0.805                0.058  1.0000000        3</span></span>
<span><span class="co">#&gt; C47         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C51         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C14          4              0.832                0.064  1.0000000        3</span></span>
<span><span class="co">#&gt; C15          4              0.832                0.064  1.0000000        3</span></span>
<span><span class="co">#&gt; C16          4              0.832                0.064  1.0000000        3</span></span>
<span><span class="co">#&gt; C13         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C05          6              0.857                0.067  1.0000000        3</span></span>
<span><span class="co">#&gt; C04          6              0.857                0.067  1.0000000        3</span></span>
<span><span class="co">#&gt; C06          6              0.857                0.067  1.0000000        3</span></span>
<span><span class="co">#&gt; C07         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C28         14              0.818                0.054  1.0000000        3</span></span>
<span><span class="co">#&gt; C29         14              0.818                0.054  1.0000000        3</span></span>
<span><span class="co">#&gt; C30         14              0.818                0.054  1.0000000        3</span></span>
<span><span class="co">#&gt; C31         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C68          5              0.833                0.060  1.0000000        3</span></span>
<span><span class="co">#&gt; C67          5              0.833                0.060  1.0000000        3</span></span>
<span><span class="co">#&gt; C69          5              0.833                0.060  1.0000000        3</span></span>
<span><span class="co">#&gt; C66         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C09          1              0.814                0.047  1.0000000        3</span></span>
<span><span class="co">#&gt; C08          1              0.814                0.047  1.0000000        3</span></span>
<span><span class="co">#&gt; C10          1              0.814                0.047  1.0000000        3</span></span>
<span><span class="co">#&gt; C11         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C35          7              0.817                0.045  1.0000000        3</span></span>
<span><span class="co">#&gt; C36          7              0.817                0.045  1.0000000        3</span></span>
<span><span class="co">#&gt; C34          7              0.817                0.045  1.0000000        3</span></span>
<span><span class="co">#&gt; C33         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C59          9              0.838                0.039  1.0000000        3</span></span>
<span><span class="co">#&gt; C58          9              0.838                0.039  1.0000000        3</span></span>
<span><span class="co">#&gt; C60          9              0.838                0.039  1.0000000        3</span></span>
<span><span class="co">#&gt; C61         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C55         11              0.792                0.057  1.0000000        3</span></span>
<span><span class="co">#&gt; C56         11              0.792                0.057  1.0000000        3</span></span>
<span><span class="co">#&gt; C57         11              0.792                0.057  1.0000000        3</span></span>
<span><span class="co">#&gt; C75          3              0.803                0.053  1.0000000        3</span></span>
<span><span class="co">#&gt; C74          3              0.803                0.053  1.0000000        3</span></span>
<span><span class="co">#&gt; C73          3              0.803                0.053  1.0000000        3</span></span>
<span><span class="co">#&gt; C27         12              0.835                0.043  1.0000000        3</span></span>
<span><span class="co">#&gt; C26         12              0.835                0.043  1.0000000        3</span></span>
<span><span class="co">#&gt; C25         12              0.835                0.043  1.0000000        3</span></span>
<span><span class="co">#&gt; C02          2              0.856                0.040  0.8333333        3</span></span>
<span><span class="co">#&gt; C03          2              0.856                0.040  0.8333333        3</span></span>
<span><span class="co">#&gt; C01          2              0.856                0.040  0.8333333        3</span></span>
<span><span class="co">#&gt; C37         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C12         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C71         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C64         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C70         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C17         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C32         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C46         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C18         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C24         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C38         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C65         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C72         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C20         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C39         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C40         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C41         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C42         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C62         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C63         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C19         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C21         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C22         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C23         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C43         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C44         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt; C45         NA                 NA                   NA         NA       NA</span></span>
<span><span class="co">#&gt;     3: Max.path 3: share.of.total 4: Segment 4: within.mobility</span></span>
<span><span class="co">#&gt; C77           1             0.055         10              0.901</span></span>
<span><span class="co">#&gt; C76           1             0.055         10              0.901</span></span>
<span><span class="co">#&gt; C78           1             0.055         10              0.901</span></span>
<span><span class="co">#&gt; C80          NA                NA         10              0.901</span></span>
<span><span class="co">#&gt; C79          NA                NA         10              0.901</span></span>
<span><span class="co">#&gt; C49           1             0.058          3              0.862</span></span>
<span><span class="co">#&gt; C50           1             0.058          3              0.862</span></span>
<span><span class="co">#&gt; C54           1             0.058          6              0.818</span></span>
<span><span class="co">#&gt; C53           1             0.058          6              0.818</span></span>
<span><span class="co">#&gt; C52           1             0.058          6              0.818</span></span>
<span><span class="co">#&gt; C48           1             0.058          3              0.862</span></span>
<span><span class="co">#&gt; C47          NA                NA          3              0.862</span></span>
<span><span class="co">#&gt; C51          NA                NA          6              0.818</span></span>
<span><span class="co">#&gt; C14           1             0.064          7              0.867</span></span>
<span><span class="co">#&gt; C15           1             0.064          7              0.867</span></span>
<span><span class="co">#&gt; C16           1             0.064          7              0.867</span></span>
<span><span class="co">#&gt; C13          NA                NA          7              0.867</span></span>
<span><span class="co">#&gt; C05           1             0.067          4              0.879</span></span>
<span><span class="co">#&gt; C04           1             0.067          4              0.879</span></span>
<span><span class="co">#&gt; C06           1             0.067          4              0.879</span></span>
<span><span class="co">#&gt; C07          NA                NA          4              0.879</span></span>
<span><span class="co">#&gt; C28           1             0.054          5              0.857</span></span>
<span><span class="co">#&gt; C29           1             0.054          5              0.857</span></span>
<span><span class="co">#&gt; C30           1             0.054          5              0.857</span></span>
<span><span class="co">#&gt; C31          NA                NA          5              0.857</span></span>
<span><span class="co">#&gt; C68           1             0.060          8              0.865</span></span>
<span><span class="co">#&gt; C67           1             0.060          8              0.865</span></span>
<span><span class="co">#&gt; C69           1             0.060          8              0.865</span></span>
<span><span class="co">#&gt; C66          NA                NA          8              0.865</span></span>
<span><span class="co">#&gt; C09           1             0.047          2              0.864</span></span>
<span><span class="co">#&gt; C08           1             0.047          2              0.864</span></span>
<span><span class="co">#&gt; C10           1             0.047          2              0.864</span></span>
<span><span class="co">#&gt; C11          NA                NA          2              0.864</span></span>
<span><span class="co">#&gt; C35           1             0.045          9              0.859</span></span>
<span><span class="co">#&gt; C36           1             0.045          9              0.859</span></span>
<span><span class="co">#&gt; C34           1             0.045          9              0.859</span></span>
<span><span class="co">#&gt; C33          NA                NA          9              0.859</span></span>
<span><span class="co">#&gt; C59           1             0.039          1              0.869</span></span>
<span><span class="co">#&gt; C58           1             0.039          1              0.869</span></span>
<span><span class="co">#&gt; C60           1             0.039          1              0.869</span></span>
<span><span class="co">#&gt; C61          NA                NA          1              0.869</span></span>
<span><span class="co">#&gt; C55           1             0.057         NA                 NA</span></span>
<span><span class="co">#&gt; C56           1             0.057         NA                 NA</span></span>
<span><span class="co">#&gt; C57           1             0.057         NA                 NA</span></span>
<span><span class="co">#&gt; C75           1             0.053         NA                 NA</span></span>
<span><span class="co">#&gt; C74           1             0.053         NA                 NA</span></span>
<span><span class="co">#&gt; C73           1             0.053         NA                 NA</span></span>
<span><span class="co">#&gt; C27           1             0.043         NA                 NA</span></span>
<span><span class="co">#&gt; C26           1             0.043         NA                 NA</span></span>
<span><span class="co">#&gt; C25           1             0.043         NA                 NA</span></span>
<span><span class="co">#&gt; C02           2             0.040         NA                 NA</span></span>
<span><span class="co">#&gt; C03           2             0.040         NA                 NA</span></span>
<span><span class="co">#&gt; C01           2             0.040         NA                 NA</span></span>
<span><span class="co">#&gt; C37          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C12          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C71          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C64          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C70          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C17          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C32          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C46          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C18          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C24          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C38          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C65          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C72          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C20          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C39          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C40          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C41          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C42          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C62          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C63          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C19          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C21          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C22          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C23          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C43          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C44          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt; C45          NA                NA         NA                 NA</span></span>
<span><span class="co">#&gt;     4: share.of.mobility 4: Density 4: Nodes 4: Max.path 4: share.of.total</span></span>
<span><span class="co">#&gt; C77                0.109  0.7000000        5           2             0.109</span></span>
<span><span class="co">#&gt; C76                0.109  0.7000000        5           2             0.109</span></span>
<span><span class="co">#&gt; C78                0.109  0.7000000        5           2             0.109</span></span>
<span><span class="co">#&gt; C80                0.109  0.7000000        5           2             0.109</span></span>
<span><span class="co">#&gt; C79                0.109  0.7000000        5           2             0.109</span></span>
<span><span class="co">#&gt; C49                0.075  0.8333333        4           2             0.075</span></span>
<span><span class="co">#&gt; C50                0.075  0.8333333        4           2             0.075</span></span>
<span><span class="co">#&gt; C54                0.075  0.8333333        4           2             0.075</span></span>
<span><span class="co">#&gt; C53                0.075  0.8333333        4           2             0.075</span></span>
<span><span class="co">#&gt; C52                0.075  0.8333333        4           2             0.075</span></span>
<span><span class="co">#&gt; C48                0.075  0.8333333        4           2             0.075</span></span>
<span><span class="co">#&gt; C47                0.075  0.8333333        4           2             0.075</span></span>
<span><span class="co">#&gt; C51                0.075  0.8333333        4           2             0.075</span></span>
<span><span class="co">#&gt; C14                0.074  0.8333333        4           2             0.074</span></span>
<span><span class="co">#&gt; C15                0.074  0.8333333        4           2             0.074</span></span>
<span><span class="co">#&gt; C16                0.074  0.8333333        4           2             0.074</span></span>
<span><span class="co">#&gt; C13                0.074  0.8333333        4           2             0.074</span></span>
<span><span class="co">#&gt; C05                0.073  0.8333333        4           2             0.073</span></span>
<span><span class="co">#&gt; C04                0.073  0.8333333        4           2             0.073</span></span>
<span><span class="co">#&gt; C06                0.073  0.8333333        4           2             0.073</span></span>
<span><span class="co">#&gt; C07                0.073  0.8333333        4           2             0.073</span></span>
<span><span class="co">#&gt; C28                0.069  0.8333333        4           2             0.069</span></span>
<span><span class="co">#&gt; C29                0.069  0.8333333        4           2             0.069</span></span>
<span><span class="co">#&gt; C30                0.069  0.8333333        4           2             0.069</span></span>
<span><span class="co">#&gt; C31                0.069  0.8333333        4           2             0.069</span></span>
<span><span class="co">#&gt; C68                0.068  0.8333333        4           2             0.068</span></span>
<span><span class="co">#&gt; C67                0.068  0.8333333        4           2             0.068</span></span>
<span><span class="co">#&gt; C69                0.068  0.8333333        4           2             0.068</span></span>
<span><span class="co">#&gt; C66                0.068  0.8333333        4           2             0.068</span></span>
<span><span class="co">#&gt; C09                0.065  0.8333333        4           2             0.065</span></span>
<span><span class="co">#&gt; C08                0.065  0.8333333        4           2             0.065</span></span>
<span><span class="co">#&gt; C10                0.065  0.8333333        4           2             0.065</span></span>
<span><span class="co">#&gt; C11                0.065  0.8333333        4           2             0.065</span></span>
<span><span class="co">#&gt; C35                0.056  0.8333333        4           2             0.056</span></span>
<span><span class="co">#&gt; C36                0.056  0.8333333        4           2             0.056</span></span>
<span><span class="co">#&gt; C34                0.056  0.8333333        4           2             0.056</span></span>
<span><span class="co">#&gt; C33                0.056  0.8333333        4           2             0.056</span></span>
<span><span class="co">#&gt; C59                0.044  0.8333333        4           2             0.044</span></span>
<span><span class="co">#&gt; C58                0.044  0.8333333        4           2             0.044</span></span>
<span><span class="co">#&gt; C60                0.044  0.8333333        4           2             0.044</span></span>
<span><span class="co">#&gt; C61                0.044  0.8333333        4           2             0.044</span></span>
<span><span class="co">#&gt; C55                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C56                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C57                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C75                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C74                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C73                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C27                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C26                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C25                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C02                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C03                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C01                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C37                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C12                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C71                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C64                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C70                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C17                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C32                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C46                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C18                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C24                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C38                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C65                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C72                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C20                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C39                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C40                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C41                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C42                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C62                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C63                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C19                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C21                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C22                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C23                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C43                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C44                   NA         NA       NA          NA                NA</span></span>
<span><span class="co">#&gt; C45                   NA         NA       NA          NA                NA</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizzazione-della-rete-ridotta">5.3 Visualizzazione della rete ridotta<a class="anchor" aria-label="anchor" href="#visualizzazione-della-rete-ridotta"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualizza la rete al primo livello di segmentazione</span></span>
<span><span class="fu"><a href="../reference/plot_moneca_ggraph.html">plot_moneca_ggraph</a></span><span class="op">(</span></span>
<span>  <span class="va">seg_reduced</span>,</span>
<span>  level <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  layout <span class="op">=</span> <span class="st">"fr"</span>,</span>
<span>  node_color <span class="op">=</span> <span class="st">"segment"</span>,</span>
<span>  node_size <span class="op">=</span> <span class="st">"mobility"</span>,</span>
<span>  show_labels <span class="op">=</span> <span class="cn">FALSE</span>,  <span class="co"># Troppe etichette con 80 nodi</span></span>
<span>  title <span class="op">=</span> <span class="st">"Rete di Mobilità dopo Riduzione della Densità (Livello 1)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/density-network_plot-1.png" class="r-plt" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="visualizzazione-dendrogramma">5.4 Visualizzazione dendrogramma<a class="anchor" aria-label="anchor" href="#visualizzazione-dendrogramma"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Dendrogramma gerarchico</span></span>
<span><span class="fu"><a href="../reference/plot_moneca_dendrogram.html">plot_moneca_dendrogram</a></span><span class="op">(</span></span>
<span>  <span class="va">seg_reduced</span>,</span>
<span>  label_size <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Struttura Gerarchica dei Segmenti"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/density-dendrogram_plot-1.png" class="r-plt" alt="" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="guida-alla-scelta-dei-parametri">6. Guida alla Scelta dei Parametri<a class="anchor" aria-label="anchor" href="#guida-alla-scelta-dei-parametri"></a>
</h2>
<div class="section level3">
<h3 id="quando-usare-reduce_density-1">6.1 Quando usare reduce_density()<a class="anchor" aria-label="anchor" href="#quando-usare-reduce_density-1"></a>
</h3>
<p><strong>Utilizzare <code><a href="../reference/reduce_density.html">reduce_density()</a></code> quando:</strong></p>
<ul>
<li>La matrice ha 60+ categorie</li>
<li>La densità è elevata (molte celle non-zero, sparsità &lt;
60-70%)</li>
<li>Molte celle hanno conteggi bassi (&lt; 10) che rappresentano rumore
statistico</li>
<li>L’analisi MONECA diretta produce cluster instabili o troppo
frammentati</li>
<li>L’analisi MONECA è computazionalmente troppo lenta a causa del
numero di connessioni</li>
</ul>
<p><strong>Non utilizzare <code><a href="../reference/reduce_density.html">reduce_density()</a></code>
quando:</strong></p>
<ul>
<li>La matrice ha meno di 30 categorie (l’algoritmo standard funziona
bene)</li>
<li>La matrice è già molto sparsa (poche celle non-zero, tutte con
conteggi robusti)</li>
<li>Si vuole preservare esattamente ogni singola osservazione</li>
</ul>
</div>
<div class="section level3">
<h3 id="scelta-del-metodo-svd-vs-nmf">6.2 Scelta del metodo: SVD vs NMF<a class="anchor" aria-label="anchor" href="#scelta-del-metodo-svd-vs-nmf"></a>
</h3>
<p>Entrambi i metodi ora utilizzano un approccio di filtraggio che
preserva i valori originali delle celle significative.</p>
<div class="section level4">
<h4 id="quando-usare-svd">6.2.1 Quando usare SVD<a class="anchor" aria-label="anchor" href="#quando-usare-svd"></a>
</h4>
<p><strong>Vantaggi:</strong></p>
<ul>
<li>Più veloce (importante per matrici molto grandi)</li>
<li>Selezione automatica di k basata su varianza spiegata</li>
<li>Metriche chiare (varianza spiegata)</li>
<li>Implementazione efficiente con <code>irlba</code>
</li>
<li>Preserva i valori originali dei conteggi (approccio filtro)</li>
</ul>
<p><strong>Svantaggi:</strong></p>
<ul>
<li>La ricostruzione può produrre valori negativi (corretti in
pre-processing per il calcolo della soglia)</li>
<li>Componenti possono essere meno interpretabili rispetto a NMF</li>
</ul>
<p><strong>Raccomandazione:</strong> utilizzare SVD come metodo di
default per la maggior parte dei casi.</p>
</div>
<div class="section level4">
<h4 id="quando-usare-nmf">6.2.2 Quando usare NMF<a class="anchor" aria-label="anchor" href="#quando-usare-nmf"></a>
</h4>
<p><strong>Vantaggi:</strong></p>
<ul>
<li>Preserva i valori originali dei conteggi (approccio filtro, come
SVD)</li>
<li>Componenti interpretabili come pattern latenti di mobilità</li>
<li>Vincolo di non-negatività naturale per dati di conteggio</li>
<li>Il parametro <code>filter_quantile</code> può essere regolato per
controllare la selezione</li>
</ul>
<p><strong>Svantaggi:</strong></p>
<ul>
<li>Più lenta (ottimizzazione iterativa)</li>
<li>Richiede <code>seed</code> per riproducibilità</li>
<li>Nessuna metrica diretta di varianza spiegata</li>
<li>Richiede il pacchetto <code>RcppML</code>
</li>
</ul>
<p><strong>Raccomandazione:</strong> utilizzare NMF quando
l’interpretabilità delle componenti latenti è importante, o quando si
lavora con dati dove il vincolo di non-negatività è teoricamente
rilevante.</p>
</div>
<div class="section level4">
<h4 id="regolazione-del-filter_quantile-entrambi-i-metodi">6.2.3 Regolazione del <code>filter_quantile</code> (entrambi i
metodi)<a class="anchor" aria-label="anchor" href="#regolazione-del-filter_quantile-entrambi-i-metodi"></a>
</h4>
<p>Il parametro <code>filter_quantile</code> controlla quante celle
vengono mantenute. Si applica sia a SVD che a NMF:</p>
<ul>
<li>Valori più alti (es. 0.80-0.90) mantengono più celle, riducono meno
il rumore</li>
<li>Valori più bassi (es. 0.50-0.70) mantengono meno celle, rimozione
più aggressiva del rumore</li>
<li>
<code>"auto"</code> (default) seleziona il quantile basandosi sul
punto di gomito dei valori di ricostruzione</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="scelta-della-normalizzazione">6.3 Scelta della normalizzazione<a class="anchor" aria-label="anchor" href="#scelta-della-normalizzazione"></a>
</h3>
<div class="section level4">
<h4 id="normalization-none-default">6.3.1 <code>normalization = "none"</code> (default)<a class="anchor" aria-label="anchor" href="#normalization-none-default"></a>
</h4>
<p><strong>Quando usare:</strong></p>
<ul>
<li>La matrice è ragionevolmente bilanciata</li>
<li>Non ci sono grandi differenze nelle dimensioni marginali</li>
<li>Si vogliono preservare le frequenze assolute</li>
</ul>
<p><strong>Consigliata come prima scelta</strong> per la maggior parte
delle applicazioni.</p>
</div>
<div class="section level4">
<h4 id="normalization-pearson">6.3.2 <code>normalization = "pearson"</code><a class="anchor" aria-label="anchor" href="#normalization-pearson"></a>
</h4>
<p><strong>Quando usare:</strong></p>
<ul>
<li>Le distribuzioni marginali sono molto eterogenee (alcune classi
molto più grandi di altre)</li>
<li>Si vuole standardizzare per effetti di dimensione</li>
<li>Si vogliono identificare deviazioni dal modello di indipendenza</li>
</ul>
<p><strong>Attenzione:</strong> può amplificare il rumore in celle con
conteggi attesi bassi.</p>
</div>
<div class="section level4">
<h4 id="normalization-ppmi">6.3.3 <code>normalization = "ppmi"</code><a class="anchor" aria-label="anchor" href="#normalization-ppmi"></a>
</h4>
<p><strong>Quando usare:</strong></p>
<ul>
<li>Si vogliono enfatizzare connessioni “sorprendenti” rispetto al
caso</li>
<li>La mobilità assoluta è meno importante della mobilità relativa</li>
<li>Si lavora con matrici molto sparse</li>
</ul>
<p><strong>Attenzione:</strong> elimina informazioni sulle frequenze
assolute; utile per enfatizzare pattern strutturali.</p>
</div>
</div>
<div class="section level3">
<h3 id="scelta-del-numero-di-componenti-k">6.4 Scelta del numero di componenti (k)<a class="anchor" aria-label="anchor" href="#scelta-del-numero-di-componenti-k"></a>
</h3>
<div class="section level4">
<h4 id="selezione-automatica-k-auto">6.4.1 Selezione automatica (<code>k = "auto"</code>)<a class="anchor" aria-label="anchor" href="#selezione-automatica-k-auto"></a>
</h4>
<p><strong>Vantaggi:</strong></p>
<ul>
<li>Bilancia varianza spiegata e parsimonia</li>
<li>Usa sia il criterio della varianza target che il rilevamento del
gomito</li>
<li>Adatta per esplorazioni iniziali</li>
</ul>
<p><strong>Parametro chiave: <code>variance_target</code></strong></p>
<ul>
<li>
<code>0.60-0.70</code>: riduzione aggressiva, mantiene solo
strutture molto dominanti</li>
<li>
<code>0.75</code> (default): buon compromesso per la maggior parte
dei casi</li>
<li>
<code>0.80-0.90</code>: riduzione conservativa, preserva più
dettaglio</li>
</ul>
<p><strong>Raccomandazione:</strong> iniziare con
<code>k = "auto"</code> e <code>variance_target = 0.75</code>, poi
esplorare visualizzando lo scree plot.</p>
</div>
<div class="section level4">
<h4 id="selezione-manuale">6.4.2 Selezione manuale<a class="anchor" aria-label="anchor" href="#selezione-manuale"></a>
</h4>
<p><strong>Quando specificare k manualmente:</strong></p>
<ul>
<li>Dopo aver esaminato lo scree plot</li>
<li>Per NMF (dove la varianza spiegata non è disponibile)</li>
<li>Quando si ha conoscenza a priori del numero appropriato di
dimensioni latenti</li>
</ul>
<p><strong>Linee guida per k:</strong></p>
<ul>
<li>Matrici 60-100 categorie: tipicamente k = 15-25</li>
<li>Matrici 100-200 categorie: tipicamente k = 20-35</li>
<li>Regola empirica: k ≈ 20-30% del numero di categorie originali</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="uso-della-soglia-threshold">6.5 Uso della soglia (threshold)<a class="anchor" aria-label="anchor" href="#uso-della-soglia-threshold"></a>
</h3>
<div class="section level4">
<h4 id="nessuna-soglia-threshold-null">6.5.1 Nessuna soglia (<code>threshold = NULL</code>)<a class="anchor" aria-label="anchor" href="#nessuna-soglia-threshold-null"></a>
</h4>
<p><strong>Default raccomandato:</strong> lasciare che la riduzione
dimensionale faccia il suo lavoro senza post-processing aggiuntivo.</p>
</div>
<div class="section level4">
<h4 id="soglia-automatica-threshold-auto">6.5.2 Soglia automatica (<code>threshold = "auto"</code>)<a class="anchor" aria-label="anchor" href="#soglia-automatica-threshold-auto"></a>
</h4>
<p><strong>Quando usare:</strong></p>
<ul>
<li>La matrice ricostruita contiene ancora molti valori molto bassi</li>
<li>Si vuole aumentare ulteriormente la sparsità</li>
<li>I cluster MONECA risultano troppo densi</li>
</ul>
<p><strong>Effetto:</strong> rimuove valori sotto media + 1 SD.</p>
</div>
<div class="section level4">
<h4 id="soglia-personalizzata">6.5.3 Soglia personalizzata<a class="anchor" aria-label="anchor" href="#soglia-personalizzata"></a>
</h4>
<p><strong>Tipo <code>"sd"</code>:</strong></p>
<ul>
<li>
<code>threshold = 0.5</code>: rimozione conservativa</li>
<li>
<code>threshold = 1.0</code>: rimozione moderata</li>
<li>
<code>threshold = 1.5-2.0</code>: rimozione aggressiva</li>
</ul>
<p><strong>Tipo <code>"percentile"</code>:</strong></p>
<ul>
<li>
<code>threshold = 10-20</code>: mantiene valori sopra il 10-20°
percentile</li>
<li>
<code>threshold = 25</code>: mantiene il 75% dei valori più
alti</li>
<li>
<code>threshold = 50</code>: mantiene solo la metà superiore</li>
</ul>
<p><strong>Raccomandazione:</strong> esplorare prima senza soglia;
applicare solo se necessario dopo ispezione dei risultati.</p>
</div>
</div>
<div class="section level3">
<h3 id="workflow-esplorativo-consigliato">6.6 Workflow esplorativo consigliato<a class="anchor" aria-label="anchor" href="#workflow-esplorativo-consigliato"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Visualizza lo scree plot per capire la struttura della varianza</span></span>
<span><span class="fu"><a href="../reference/plot_scree.html">plot_scree</a></span><span class="op">(</span><span class="va">large_data</span>, max_components <span class="op">=</span> <span class="fl">40</span>, variance_target <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Prova la riduzione base con parametri di default</span></span>
<span><span class="va">reduced_default</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span></span>
<span>  <span class="va">large_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"svd"</span>,</span>
<span>  k <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Confronta con target di varianza diversi</span></span>
<span><span class="va">reduced_conservative</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span></span>
<span>  <span class="va">large_data</span>,</span>
<span>  variance_target <span class="op">=</span> <span class="fl">0.85</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Prova normalizzazioni diverse se le distribuzioni marginali sono problematiche</span></span>
<span><span class="va">reduced_ppmi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span></span>
<span>  <span class="va">large_data</span>,</span>
<span>  normalization <span class="op">=</span> <span class="st">"ppmi"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. Esegui MONECA su ciascuna versione e confronta la qualità</span></span>
<span><span class="va">seg_default</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moneca.html">moneca</a></span><span class="op">(</span><span class="va">reduced_default</span>, segment.levels <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">seg_conservative</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moneca.html">moneca</a></span><span class="op">(</span><span class="va">reduced_conservative</span>, segment.levels <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">seg_ppmi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moneca.html">moneca</a></span><span class="op">(</span><span class="va">reduced_ppmi</span>, segment.levels <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 6. Confronta le metriche di qualità</span></span>
<span><span class="va">quality_default</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment.quality.html">segment.quality</a></span><span class="op">(</span><span class="va">seg_default</span><span class="op">)</span></span>
<span><span class="va">quality_conservative</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment.quality.html">segment.quality</a></span><span class="op">(</span><span class="va">seg_conservative</span><span class="op">)</span></span>
<span><span class="va">quality_ppmi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment.quality.html">segment.quality</a></span><span class="op">(</span><span class="va">seg_ppmi</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="diagnosi-e-risoluzione-problemi">7. Diagnosi e Risoluzione Problemi<a class="anchor" aria-label="anchor" href="#diagnosi-e-risoluzione-problemi"></a>
</h2>
<div class="section level3">
<h3 id="problemi-comuni">7.1 Problemi comuni<a class="anchor" aria-label="anchor" href="#problemi-comuni"></a>
</h3>
<div class="section level4">
<h4 id="package-rcppml-is-required-for-nmf">7.1.1 “Package ‘RcppML’ is required for NMF”<a class="anchor" aria-label="anchor" href="#package-rcppml-is-required-for-nmf"></a>
</h4>
<p><strong>Problema:</strong> si è scelto <code>method = "nmf"</code> ma
il pacchetto RcppML non è installato.</p>
<p><strong>Soluzione:</strong></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"RcppML"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="risultati-non-riproducibili-con-nmf">7.1.2 Risultati non riproducibili con NMF<a class="anchor" aria-label="anchor" href="#risultati-non-riproducibili-con-nmf"></a>
</h4>
<p><strong>Problema:</strong> eseguendo due volte la stessa chiamata con
NMF si ottengono risultati leggermente diversi.</p>
<p><strong>Causa:</strong> NMF usa inizializzazione casuale.</p>
<p><strong>Soluzione:</strong> specificare sempre l’argomento
<code>seed</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">large_data</span>, method <span class="op">=</span> <span class="st">"nmf"</span>, k <span class="op">=</span> <span class="fl">20</span>, seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="b-nmf-mantiene-troppe-o-troppo-poche-celle">7.1.2b NMF mantiene troppe o troppo poche celle<a class="anchor" aria-label="anchor" href="#b-nmf-mantiene-troppe-o-troppo-poche-celle"></a>
</h4>
<p><strong>Problema:</strong> con il metodo NMF, la percentuale di celle
mantenute è troppo alta (poco filtraggio) o troppo bassa (perdita
eccessiva di dati).</p>
<p><strong>Causa:</strong> il parametro <code>filter_quantile</code>
automatico potrebbe non essere ottimale per i dati specifici.</p>
<p><strong>Soluzioni:</strong></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Se troppo poche celle mantenute, aumenta filter_quantile</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">large_data</span>, method <span class="op">=</span> <span class="st">"nmf"</span>, k <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                          filter_quantile <span class="op">=</span> <span class="fl">0.85</span>,  <span class="co"># Mantieni più celle</span></span>
<span>                          seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Se troppe celle mantenute (poco filtraggio), riduci filter_quantile</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">large_data</span>, method <span class="op">=</span> <span class="st">"nmf"</span>, k <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                          filter_quantile <span class="op">=</span> <span class="fl">0.50</span>,  <span class="co"># Filtraggio più aggressivo</span></span>
<span>                          seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Verifica il quantile effettivamente utilizzato</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Filter quantile:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">reduced</span>, <span class="st">"filter_quantile"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="riduzione-troppo-aggressiva-troppe-osservazioni-perse">7.1.3 Riduzione troppo aggressiva (troppe osservazioni perse)<a class="anchor" aria-label="anchor" href="#riduzione-troppo-aggressiva-troppe-osservazioni-perse"></a>
</h4>
<p><strong>Problema:</strong> la percentuale di osservazioni mantenute è
troppo bassa (&lt; 80%).</p>
<p><strong>Possibili cause:</strong></p>
<ul>
<li>
<code>k</code> troppo basso (troppo poche componenti)</li>
<li>
<code>variance_target</code> troppo basso</li>
<li>Normalizzazione inadeguata per i dati</li>
</ul>
<p><strong>Soluzioni:</strong></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Aumenta il target di varianza</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">large_data</span>, variance_target <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Oppure specifica k manualmente più alto</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">large_data</span>, k <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Oppure prova senza normalizzazione</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">large_data</span>, normalization <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="riduzione-troppo-conservativa-poca-riduzione-del-rumore">7.1.4 Riduzione troppo conservativa (poca riduzione del rumore)<a class="anchor" aria-label="anchor" href="#riduzione-troppo-conservativa-poca-riduzione-del-rumore"></a>
</h4>
<p><strong>Problema:</strong> la matrice ridotta è ancora troppo simile
all’originale, con molto rumore residuo.</p>
<p><strong>Soluzioni:</strong></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Riduci il target di varianza</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">large_data</span>, variance_target <span class="op">=</span> <span class="fl">0.65</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Oppure applica una soglia</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">large_data</span>, threshold <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Oppure usa PPMI per enfatizzare pattern strutturali</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">large_data</span>, normalization <span class="op">=</span> <span class="st">"ppmi"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="cluster-moneca-instabili-dopo-riduzione">7.1.5 Cluster MONECA instabili dopo riduzione<a class="anchor" aria-label="anchor" href="#cluster-moneca-instabili-dopo-riduzione"></a>
</h4>
<p><strong>Problema:</strong> l’analisi MONECA sulla matrice ridotta
produce cluster inconsistenti o poco interpretabili.</p>
<p><strong>Possibili cause:</strong></p>
<ul>
<li>Riduzione troppo aggressiva ha rimosso strutture importanti</li>
<li>Parametri di riduzione non adatti ai dati</li>
<li>
<code>small.cell.reduction</code> in <code><a href="../reference/moneca.html">moneca()</a></code> troppo
alto o troppo basso</li>
</ul>
<p><strong>Soluzioni:</strong></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prova riduzione più conservativa</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">large_data</span>, variance_target <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Aggiusta small.cell.reduction in moneca()</span></span>
<span><span class="va">seg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moneca.html">moneca</a></span><span class="op">(</span><span class="va">reduced</span>, small.cell.reduction <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>  <span class="co"># Valore più basso</span></span>
<span></span>
<span><span class="co"># Prova normalizzazione diversa</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">large_data</span>, normalization <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="validazione-dei-risultati">7.2 Validazione dei risultati<a class="anchor" aria-label="anchor" href="#validazione-dei-risultati"></a>
</h3>
<div class="section level4">
<h4 id="confronta-distribuzioni-marginali">7.2.1 Confronta distribuzioni marginali<a class="anchor" aria-label="anchor" href="#confronta-distribuzioni-marginali"></a>
</h4>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Confronta totali di riga prima e dopo</span></span>
<span><span class="va">original_row_totals</span> <span class="op">&lt;-</span> <span class="va">large_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">80</span>, <span class="fl">81</span><span class="op">]</span></span>
<span><span class="va">reduced_row_totals</span> <span class="op">&lt;-</span> <span class="va">reduced</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">80</span>, <span class="fl">81</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">original_row_totals</span>, <span class="va">reduced_row_totals</span><span class="op">)</span>  <span class="co"># Dovrebbe essere &gt; 0.95</span></span>
<span></span>
<span><span class="co"># Visualizza</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">original_row_totals</span>, <span class="va">reduced_row_totals</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Totali originali"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Totali ridotti"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Confronto totali di riga"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="confronta-struttura-di-correlazione">7.2.2 Confronta struttura di correlazione<a class="anchor" aria-label="anchor" href="#confronta-struttura-di-correlazione"></a>
</h4>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calcola matrici di correlazione</span></span>
<span><span class="va">cor_original</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">large_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">80</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">80</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">cor_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">reduced</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">80</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">80</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Confronta</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">cor_original</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">cor_reduced</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Dovrebbe essere alto</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="confronta-risultati-moneca">7.2.3 Confronta risultati MONECA<a class="anchor" aria-label="anchor" href="#confronta-risultati-moneca"></a>
</h4>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analizza sia originale che ridotta</span></span>
<span><span class="va">seg_original</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moneca.html">moneca</a></span><span class="op">(</span><span class="va">large_data</span>, segment.levels <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">seg_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moneca.html">moneca</a></span><span class="op">(</span><span class="va">reduced</span>, segment.levels <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Confronta qualità</span></span>
<span><span class="va">quality_original</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment.quality.html">segment.quality</a></span><span class="op">(</span><span class="va">seg_original</span><span class="op">)</span></span>
<span><span class="va">quality_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment.quality.html">segment.quality</a></span><span class="op">(</span><span class="va">seg_reduced</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Confronta membership</span></span>
<span><span class="co"># (richiede analisi più dettagliata della concordanza tra segmentazioni)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="considerazioni-teoriche-e-limitazioni">8. Considerazioni Teoriche e Limitazioni<a class="anchor" aria-label="anchor" href="#considerazioni-teoriche-e-limitazioni"></a>
</h2>
<div class="section level3">
<h3 id="assunzioni-sottostanti">8.1 Assunzioni sottostanti<a class="anchor" aria-label="anchor" href="#assunzioni-sottostanti"></a>
</h3>
<p>La riduzione della densità tramite SVD o NMF assume che:</p>
<ol style="list-style-type: decimal">
<li><p><strong>La matrice di mobilità ha una struttura a basso
rango</strong>: i pattern di mobilità sono generati da un numero
limitato di dimensioni latenti sottostanti.</p></li>
<li><p><strong>Il rumore è additivo e relativamente omogeneo</strong>:
le fluttuazioni casuali sono sovrapposte ai pattern
sistematici.</p></li>
<li><p><strong>Le prime componenti catturano segnale, le ultime
catturano rumore</strong>: questa assunzione è generalmente valida ma
non sempre garantita.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="limitazioni">8.2 Limitazioni<a class="anchor" aria-label="anchor" href="#limitazioni"></a>
</h3>
<div class="section level4">
<h4 id="perdita-di-informazione">8.2.1 Perdita di informazione<a class="anchor" aria-label="anchor" href="#perdita-di-informazione"></a>
</h4>
<p>La riduzione dimensionale comporta sempre perdita di informazione.
Anche con <code>variance_target = 0.90</code>, il 10% della variabilità
originale viene scartato. Se questa variabilità contiene pattern
sostantivi piuttosto che rumore, l’analisi successiva può essere
compromessa.</p>
</div>
<div class="section level4">
<h4 id="arrotondamento">8.2.2 Arrotondamento<a class="anchor" aria-label="anchor" href="#arrotondamento"></a>
</h4>
<p>La ricostruzione produce valori continui che vengono arrotondati a
interi per compatibilità con MONECA. L’arrotondamento introduce
ulteriori approssimazioni e può alterare sottilmente la struttura della
matrice.</p>
</div>
<div class="section level4">
<h4 id="modificazione-delle-distribuzioni-marginali">8.2.3 Modificazione delle distribuzioni marginali<a class="anchor" aria-label="anchor" href="#modificazione-delle-distribuzioni-marginali"></a>
</h4>
<p>Sebbene il processo cerchi di preservare i totali marginali
attraverso il rescaling, le distribuzioni marginali possono essere
alterate, specialmente con riduzione aggressiva o normalizzazioni
non-triviali.</p>
</div>
<div class="section level4">
<h4 id="sensibilità-ai-parametri">8.2.4 Sensibilità ai parametri<a class="anchor" aria-label="anchor" href="#sensibilit%C3%A0-ai-parametri"></a>
</h4>
<p>I risultati dipendono dalle scelte di:</p>
<ul>
<li>Metodo (SVD vs NMF)</li>
<li>Normalizzazione</li>
<li>Numero di componenti (k)</li>
<li>Soglia</li>
</ul>
<p>Non esiste un insieme di parametri “ottimale” universale; la scelta
dipende dai dati specifici e dagli obiettivi analitici.</p>
</div>
</div>
<div class="section level3">
<h3 id="validazione-raccomandata">8.3 Validazione raccomandata<a class="anchor" aria-label="anchor" href="#validazione-raccomandata"></a>
</h3>
<p>Prima di procedere con l’analisi MONECA completa su dati ridotti:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Confronta statistiche descrittive</strong> (totali, medie,
varianze) tra matrice originale e ridotta</li>
<li>
<strong>Visualizza lo scree plot</strong> per valutare se k è
appropriato</li>
<li>
<strong>Esamina la percentuale di osservazioni mantenute</strong>
(idealmente &gt; 85%)</li>
<li>
<strong>Confronta risultati MONECA</strong> tra versioni con
parametri di riduzione diversi</li>
<li>
<strong>Verifica la stabilità dei cluster</strong> identificati</li>
</ol>
</div>
<div class="section level3">
<h3 id="alternative-e-complementi">8.4 Alternative e complementi<a class="anchor" aria-label="anchor" href="#alternative-e-complementi"></a>
</h3>
<div class="section level4">
<h4 id="aggregazione-a-priori">8.4.1 Aggregazione a priori<a class="anchor" aria-label="anchor" href="#aggregazione-a-priori"></a>
</h4>
<p>Se le categorie hanno una struttura gerarchica nota (es. professioni
ISCO a diversi livelli di dettaglio), aggregare a priori a un livello
più grossolano può essere preferibile alla riduzione dimensionale.</p>
</div>
<div class="section level4">
<h4 id="selezione-di-sottoinsiemi">8.4.2 Selezione di sottoinsiemi<a class="anchor" aria-label="anchor" href="#selezione-di-sottoinsiemi"></a>
</h4>
<p>Se solo un sottoinsieme di categorie è di interesse sostantivo,
escludere a priori le categorie irrilevanti può ridurre la complessità
senza le approssimazioni della riduzione dimensionale.</p>
</div>
<div class="section level4">
<h4 id="uso-combinato">8.4.3 Uso combinato<a class="anchor" aria-label="anchor" href="#uso-combinato"></a>
</h4>
<p><code><a href="../reference/reduce_density.html">reduce_density()</a></code> può essere usata insieme a queste
alternative:</p>
<ul>
<li>Aggregare prima a un livello medio-grossolano (es. 100 → 60
categorie)</li>
<li>Applicare <code><a href="../reference/reduce_density.html">reduce_density()</a></code> al risultato (60 → riduzione
a basso rango)</li>
<li>Procedere con MONECA</li>
</ul>
</div>
</div>
</div>
<div class="section level2">
<h2 id="riferimenti-e-approfondimenti">9. Riferimenti e Approfondimenti<a class="anchor" aria-label="anchor" href="#riferimenti-e-approfondimenti"></a>
</h2>
<div class="section level3">
<h3 id="metodi-matematici">9.1 Metodi matematici<a class="anchor" aria-label="anchor" href="#metodi-matematici"></a>
</h3>
<p><strong>Singular Value Decomposition (SVD):</strong></p>
<ul>
<li>Golub, G. H., &amp; Van Loan, C. F. (2013). <em>Matrix
Computations</em> (4th ed.). Johns Hopkins University Press.</li>
<li>Halko, N., Martinsson, P. G., &amp; Tropp, J. A. (2011). Finding
structure with randomness: Probabilistic algorithms for constructing
approximate matrix decompositions. <em>SIAM Review</em>, 53(2),
217-288.</li>
</ul>
<p><strong>Non-negative Matrix Factorization (NMF):</strong></p>
<ul>
<li>Lee, D. D., &amp; Seung, H. S. (1999). Learning the parts of objects
by non-negative matrix factorization. <em>Nature</em>, 401(6755),
788-791.</li>
<li>DeBruine, Z. J., Melcher, K., &amp; Triche, T. J. (2021). Fast and
robust non-negative matrix factorization for single-cell experiments.
<em>arXiv preprint</em> arXiv:2104.00166.</li>
</ul>
<p><strong>Positive Pointwise Mutual Information (PPMI):</strong></p>
<ul>
<li>Church, K. W., &amp; Hanks, P. (1990). Word association norms,
mutual information, and lexicography. <em>Computational
Linguistics</em>, 16(1), 22-29.</li>
<li>Bullinaria, J. A., &amp; Levy, J. P. (2007). Extracting semantic
representations from word co-occurrence statistics: A computational
study. <em>Behavior Research Methods</em>, 39(3), 510-526.</li>
</ul>
</div>
<div class="section level3">
<h3 id="applicazioni-alla-mobilità-sociale">9.2 Applicazioni alla mobilità sociale<a class="anchor" aria-label="anchor" href="#applicazioni-alla-mobilit%C3%A0-sociale"></a>
</h3>
<p><strong>Analisi di matrici di mobilità:</strong></p>
<ul>
<li>Touboel, J., &amp; Larsen, A. G. (2017). Mobility Network Clustering
Analysis. In <em>Research in Social Stratification and Mobility</em>
(Vol. 47).</li>
</ul>
<p><strong>Dimensionality reduction in mobility research:</strong></p>
<ul>
<li>Breen, R. (Ed.). (2004). <em>Social Mobility in Europe</em>. Oxford
University Press.</li>
<li>Erikson, R., &amp; Goldthorpe, J. H. (1992). <em>The Constant Flux:
A Study of Class Mobility in Industrial Societies</em>. Clarendon
Press.</li>
</ul>
</div>
<div class="section level3">
<h3 id="pacchetti-r-utilizzati">9.3 Pacchetti R utilizzati<a class="anchor" aria-label="anchor" href="#pacchetti-r-utilizzati"></a>
</h3>
<p><strong>Core computational packages:</strong></p>
<ul>
<li>
<code>irlba</code>: Baglama, J., &amp; Reichel, L. (2005). Augmented
implicitly restarted Lanczos bidiagonalization methods. <em>SIAM Journal
on Scientific Computing</em>, 27(1), 19-42.</li>
<li>
<code>RcppML</code>: DeBruine, Z. J. (2021). RcppML: Rcpp Machine
Learning Library. R package.</li>
</ul>
<p><strong>Visualization:</strong></p>
<ul>
<li>
<code>ggplot2</code>: Wickham, H. (2016). <em>ggplot2: Elegant
Graphics for Data Analysis</em>. Springer-Verlag New York.</li>
<li>
<code>ggraph</code>: Pedersen, T. L. (2021). ggraph: An
Implementation of Grammar of Graphics for Graphs and Networks. R
package.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="conclusioni">10. Conclusioni<a class="anchor" aria-label="anchor" href="#conclusioni"></a>
</h2>
<p>La funzione <code><a href="../reference/reduce_density.html">reduce_density()</a></code> rappresenta un utile
strumento di preprocessing per l’analisi MONECA di matrici di mobilità
di grandi dimensioni. La riduzione dimensionale tramite SVD o NMF
permette di:</p>
<ul>
<li>Filtrare il rumore statistico preservando i pattern dominanti di
mobilità</li>
<li>Migliorare la scalabilità computazionale dell’analisi</li>
<li>Facilitare l’identificazione di cluster stabili e
interpretabili</li>
</ul>
<p><strong>Raccomandazioni finali:</strong></p>
<ol style="list-style-type: decimal">
<li>Utilizzare <code><a href="../reference/reduce_density.html">reduce_density()</a></code> per matrici con 60+
categorie caratterizzate da sparsità e rumore</li>
<li>Iniziare con parametri di default (<code>method = "svd"</code>,
<code>k = "auto"</code>, <code>variance_target = 0.75</code>)</li>
<li>Esplorare lo scree plot prima di scegliere k manualmente</li>
<li>Validare i risultati confrontando con la matrice originale</li>
<li>Documentare i parametri utilizzati per garantire
riproducibilità</li>
</ol>
<p>L’integrazione di <code><a href="../reference/reduce_density.html">reduce_density()</a></code> nel workflow MONECA
estende l’applicabilità dell’algoritmo a contesti con granularità molto
elevata, mantenendo l’interpretabilità e l’efficacia dell’approccio
basato su cliques.</p>
</div>
<div class="section level2">
<h2 id="categorie-isolate-in-moneca">11. Categorie Isolate in MONECA<a class="anchor" aria-label="anchor" href="#categorie-isolate-in-moneca"></a>
</h2>
<div class="section level3">
<h3 id="definizione-di-isolato">11.1 Definizione di isolato<a class="anchor" aria-label="anchor" href="#definizione-di-isolato"></a>
</h3>
<p>In MONECA, un <strong>isolato</strong> è una categoria occupazionale
che non appartiene a nessun segmento multi-membro al livello finale
della segmentazione. Sono le categorie “rimaste fuori” dal processo di
clustering basato su cliques.</p>
<div class="section level4">
<h4 id="definizione-matematica">11.1.1 Definizione matematica<a class="anchor" aria-label="anchor" href="#definizione-matematica"></a>
</h4>
<p>MONECA costruisce una rete pesata dove:</p>
<ul>
<li>I <strong>nodi</strong> sono le categorie occupazionali</li>
<li>Gli <strong>archi</strong> collegano categorie con rischio relativo
(RR) &gt;= cut.off (default 1)</li>
</ul>
<p>I <strong>segmenti</strong> sono identificati come
<strong>cliques</strong> (sottografi completi) in questa rete. Una
clique è un insieme di nodi dove ogni nodo è connesso a tutti gli
altri.</p>
<p>Un nodo diventa <strong>isolato</strong> quando:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∀</mo><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> clique </mtext><mspace width="0.333em"></mspace></mrow><mi>C</mi><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> nel grafo</mtext></mrow><mo>:</mo><mi>v</mi><mo>∉</mo><mi>C</mi><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> oppure </mtext><mspace width="0.333em"></mspace></mrow><mrow><mo stretchy="true" form="prefix">|</mo><mi>C</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\forall \text{ clique } C \text{ nel grafo}: v \notin C \text{ oppure } |C| = 1</annotation></semantics></math></p>
<p>In altre parole, la categoria non fa parte di nessuna clique di
dimensione maggiore di 1.</p>
</div>
<div class="section level4">
<h4 id="come-vengono-gestiti-gli-isolati-nellalgoritmo">11.1.2 Come vengono gestiti gli isolati nell’algoritmo<a class="anchor" aria-label="anchor" href="#come-vengono-gestiti-gli-isolati-nellalgoritmo"></a>
</h4>
<p>Durante la discesa gerarchica, l’algoritmo rimuove i segmenti di
dimensione 1:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Dal codice interno di moneca_fast</span></span>
<span><span class="va">level.down.fast</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">level.current</span>, <span class="va">level.below</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Remove isolates</span></span>
<span>  <span class="va">lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">level.current</span><span class="op">)</span></span>
<span>  <span class="va">level.current</span> <span class="op">&lt;-</span> <span class="va">level.current</span><span class="op">[</span><span class="va">lengths</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="co"># ...</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Con il parametro <code>isolates = TRUE</code> in
<code><a href="../reference/moneca_fast.html">moneca_fast()</a></code>, è possibile ottenere informazioni
dettagliate sugli isolati:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moneca_fast.html">moneca_fast</a></span><span class="op">(</span><span class="va">mobility_matrix</span>,</span>
<span>                   segment.levels <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                   isolates <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Membership con isolati etichettati come "altri"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">seg</span><span class="op">$</span><span class="va">isolates_summary</span><span class="op">$</span><span class="va">membership</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Matrice di mobilità aggregata tra segmenti e "altri"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">seg</span><span class="op">$</span><span class="va">isolates_summary</span><span class="op">$</span><span class="va">mobility_matrix</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="cause-dellisolamento">11.2 Cause dell’isolamento<a class="anchor" aria-label="anchor" href="#cause-dellisolamento"></a>
</h3>
<p>Una categoria può diventare isolata per tre ragioni principali:</p>
<div class="section level4">
<h4 id="pattern-disperso">11.2.1 Pattern disperso<a class="anchor" aria-label="anchor" href="#pattern-disperso"></a>
</h4>
<p>La categoria ha mobilità distribuita uniformemente verso molte
destinazioni, senza preferenze marcate.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Esempio: categoria con mobilità dispersa</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Esempio di pattern DISPERSO:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Esempio di pattern DISPERSO:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">  Freelance -&gt; Manager:     18 (RR ≈ 1.0)</span></span>
<span><span class="st">  Freelance -&gt; Impiegato:   20 (RR ≈ 1.0)</span></span>
<span><span class="st">  Freelance -&gt; Tecnico:     22 (RR ≈ 1.0)</span></span>
<span><span class="st">  Freelance -&gt; Operaio:     15 (RR ≈ 1.0)</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Nessuna destinazione ha RR significativamente &gt; 1</span></span>
<span><span class="st">  → Nessun arco forte → Nessuna clique → ISOLATO</span></span>
<span><span class="st">"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Freelance -&gt; Manager:     18 (RR ≈ 1.0)</span></span>
<span><span class="co">#&gt;   Freelance -&gt; Impiegato:   20 (RR ≈ 1.0)</span></span>
<span><span class="co">#&gt;   Freelance -&gt; Tecnico:     22 (RR ≈ 1.0)</span></span>
<span><span class="co">#&gt;   Freelance -&gt; Operaio:     15 (RR ≈ 1.0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Nessuna destinazione ha RR significativamente &gt; 1</span></span>
<span><span class="co">#&gt;   → Nessun arco forte → Nessuna clique → ISOLATO</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="pattern-atipico-non-reciproco">11.2.2 Pattern atipico (non reciproco)<a class="anchor" aria-label="anchor" href="#pattern-atipico-non-reciproco"></a>
</h4>
<p>La categoria ha forte mobilità verso una destinazione, ma questa non
ricambia.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Esempio di pattern ATIPICO:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Esempio di pattern ATIPICO:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">  Artista -&gt; Cameriere:  RR = 3.5 (mobilità alta)</span></span>
<span><span class="st">  Cameriere -&gt; Artista:  RR = 0.4 (mobilità bassa)</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Con symmetric = TRUE:</span></span>
<span><span class="st">  Arco finale = (3.5 + 0.4) / 2 = 1.95</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Ma Cameriere forma clique con Cuoco, Barista (non con Artista)</span></span>
<span><span class="st">  → Artista rimane ISOLATO</span></span>
<span><span class="st">"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Artista -&gt; Cameriere:  RR = 3.5 (mobilità alta)</span></span>
<span><span class="co">#&gt;   Cameriere -&gt; Artista:  RR = 0.4 (mobilità bassa)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Con symmetric = TRUE:</span></span>
<span><span class="co">#&gt;   Arco finale = (3.5 + 0.4) / 2 = 1.95</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Ma Cameriere forma clique con Cuoco, Barista (non con Artista)</span></span>
<span><span class="co">#&gt;   → Artista rimane ISOLATO</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="alta-immobilità-pattern-periferico">11.2.3 Alta immobilità (pattern periferico)<a class="anchor" aria-label="anchor" href="#alta-immobilit%C3%A0-pattern-periferico"></a>
</h4>
<p>La categoria ha altissima immobilità (diagonale grande), con poche
transizioni esterne che si disperdono.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Esempio di pattern PERIFERICO:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Esempio di pattern PERIFERICO:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">  Agricoltore: 93% immobilità (200 su 215 restano)</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Solo 15 uscite totali:</span></span>
<span><span class="st">  Agricoltore -&gt; A: 4 (osservato &lt;&lt; atteso → RR = 0.07)</span></span>
<span><span class="st">  Agricoltore -&gt; B: 6 (osservato &lt;&lt; atteso → RR = 0.08)</span></span>
<span><span class="st">  Agricoltore -&gt; C: 5 (osservato &lt;&lt; atteso → RR = 0.08)</span></span>
<span><span class="st"></span></span>
<span><span class="st">  Grado = 0 nel grafo → completamente ISOLATO</span></span>
<span><span class="st">"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Agricoltore: 93% immobilità (200 su 215 restano)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Solo 15 uscite totali:</span></span>
<span><span class="co">#&gt;   Agricoltore -&gt; A: 4 (osservato &lt;&lt; atteso → RR = 0.07)</span></span>
<span><span class="co">#&gt;   Agricoltore -&gt; B: 6 (osservato &lt;&lt; atteso → RR = 0.08)</span></span>
<span><span class="co">#&gt;   Agricoltore -&gt; C: 5 (osservato &lt;&lt; atteso → RR = 0.08)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Grado = 0 nel grafo → completamente ISOLATO</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="ruolo-indiretto-della-diagonale">11.3 Ruolo indiretto della diagonale<a class="anchor" aria-label="anchor" href="#ruolo-indiretto-della-diagonale"></a>
</h3>
<p>La diagonale (immobilità) <strong>non crea direttamente
archi</strong> nel grafo - viene sempre impostata a NA nella matrice dei
pesi:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Dal codice di weight.matrix()</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">diagonal</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">mx.1i</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Tuttavia, la diagonale influisce <strong>indirettamente</strong> sui
rischi relativi attraverso i marginali:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Atteso</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><msub><mtext mathvariant="normal">marginale_riga</mtext><mi>i</mi></msub><mo>×</mo><msub><mtext mathvariant="normal">marginale_colonna</mtext><mi>j</mi></msub></mrow><msup><mtext mathvariant="normal">totale</mtext><mn>2</mn></msup></mfrac><mo>×</mo><mtext mathvariant="normal">mobilità_totale</mtext></mrow><annotation encoding="application/x-tex">\text{Atteso}(i,j) = \frac{\text{marginale\_riga}_i \times \text{marginale\_colonna}_j}{\text{totale}^2} \times \text{mobilità\_totale}</annotation></semantics></math></p>
<p>Con alta immobilità:</p>
<ol style="list-style-type: decimal">
<li>Marginale di riga alto (include la diagonale)</li>
<li>Valori attesi off-diagonale più alti</li>
<li>RR = osservato/atteso più bassi</li>
<li>Meno probabilità di archi nel grafo</li>
</ol>
</div>
<div class="section level3">
<h3 id="esempio-pratico-con-dati-simulati">11.4 Esempio pratico con dati simulati<a class="anchor" aria-label="anchor" href="#esempio-pratico-con-dati-simulati"></a>
</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gmontaletti.github.io/MONECA/">moneca</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Creare matrice con struttura nota</span></span>
<span><span class="va">mob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="co"># A      B      C      Z     Tot</span></span>
<span>   <span class="fl">300</span>,   <span class="fl">180</span>,   <span class="fl">120</span>,     <span class="fl">5</span>,    <span class="fl">605</span>,  <span class="co"># A - clique con B,C</span></span>
<span>   <span class="fl">170</span>,   <span class="fl">350</span>,   <span class="fl">160</span>,     <span class="fl">8</span>,    <span class="fl">688</span>,  <span class="co"># B - clique con A,C</span></span>
<span>   <span class="fl">115</span>,   <span class="fl">155</span>,   <span class="fl">280</span>,     <span class="fl">6</span>,    <span class="fl">556</span>,  <span class="co"># C - clique con A,B</span></span>
<span>     <span class="fl">4</span>,     <span class="fl">6</span>,     <span class="fl">5</span>,   <span class="fl">200</span>,    <span class="fl">215</span>,  <span class="co"># Z - alta immobilità, disperso</span></span>
<span>   <span class="fl">589</span>,   <span class="fl">691</span>,   <span class="fl">565</span>,   <span class="fl">219</span>,   <span class="fl">2064</span>   <span class="co"># Tot</span></span>
<span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">5</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mob</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mob</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"Z"</span>, <span class="st">"Tot"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Matrice di mobilità:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Matrice di mobilità:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mob</span><span class="op">)</span></span>
<span><span class="co">#&gt;       A   B   C   Z  Tot</span></span>
<span><span class="co">#&gt; A   300 180 120   5  605</span></span>
<span><span class="co">#&gt; B   170 350 160   8  688</span></span>
<span><span class="co">#&gt; C   115 155 280   6  556</span></span>
<span><span class="co">#&gt; Z     4   6   5 200  215</span></span>
<span><span class="co">#&gt; Tot 589 691 565 219 2064</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nTassi di immobilità:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tassi di immobilità:</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">immob</span> <span class="op">&lt;-</span> <span class="va">mob</span><span class="op">[</span><span class="va">i</span>,<span class="va">i</span><span class="op">]</span> <span class="op">/</span> <span class="va">mob</span><span class="op">[</span><span class="va">i</span>, <span class="fl">5</span><span class="op">]</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  %s: %.1f%%\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mob</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">immob</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;   A: 49.6%</span></span>
<span><span class="co">#&gt;   B: 50.9%</span></span>
<span><span class="co">#&gt;   C: 50.4%</span></span>
<span><span class="co">#&gt;   Z: 93.0%</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calcolare la matrice dei rischi relativi</span></span>
<span><span class="va">wm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weight.matrix.html">weight.matrix</a></span><span class="op">(</span><span class="va">mob</span>, cut.off <span class="op">=</span> <span class="fl">1</span>, symmetric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nMatrice dei rischi relativi (RR &gt;= 1):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrice dei rischi relativi (RR &gt;= 1):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">wm</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      A    B    C  Z</span></span>
<span><span class="co">#&gt; A   NA 1.75 1.45 NA</span></span>
<span><span class="co">#&gt; B 1.75   NA 1.68 NA</span></span>
<span><span class="co">#&gt; C 1.45 1.68   NA NA</span></span>
<span><span class="co">#&gt; Z   NA   NA   NA NA</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nInterpretazione:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Interpretazione:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- A, B, C sono tutti connessi tra loro (clique)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - A, B, C sono tutti connessi tra loro (clique)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Z non ha archi con nessuno (tutti NA) → ISOLATO\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Z non ha archi con nessuno (tutti NA) → ISOLATO</span></span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Eseguire MONECA con tracciamento isolati</span></span>
<span><span class="va">seg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moneca_fast.html">moneca_fast</a></span><span class="op">(</span><span class="va">mob</span>, segment.levels <span class="op">=</span> <span class="fl">2</span>, progress <span class="op">=</span> <span class="cn">FALSE</span>, isolates <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nSegmenti al livello 2:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Segmenti al livello 2:</span></span>
<span><span class="va">names_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"Z"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">seg</span><span class="op">$</span><span class="va">segment.list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">members</span> <span class="op">&lt;-</span> <span class="va">names_vec</span><span class="op">[</span><span class="va">seg</span><span class="op">$</span><span class="va">segment.list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">members</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Segmento %d: [%s]\n"</span>, <span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">members</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;   Segmento 1: [A, B, C]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nZ è isolato perché:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Z è isolato perché:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  1. Immobilità 93% (200/215)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   1. Immobilità 93% (200/215)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  2. Solo 15 uscite, distribuite uniformemente\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   2. Solo 15 uscite, distribuite uniformemente</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  3. RR verso tutte le destinazioni &lt;&lt; 1\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   3. RR verso tutte le destinazioni &lt;&lt; 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  4. Grado 0 nel grafo → non può formare clique\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   4. Grado 0 nel grafo → non può formare clique</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="impatto-della-riduzione-di-densità-sulla-segmentazione">12. Impatto della Riduzione di Densità sulla Segmentazione<a class="anchor" aria-label="anchor" href="#impatto-della-riduzione-di-densit%C3%A0-sulla-segmentazione"></a>
</h2>
<div class="section level3">
<h3 id="il-problema-rumore-e-archi-spuri">12.1 Il problema: rumore e archi spuri<a class="anchor" aria-label="anchor" href="#il-problema-rumore-e-archi-spuri"></a>
</h3>
<p>Nelle matrici di mobilità reali, specialmente quelle di grandi
dimensioni, il <strong>rumore statistico</strong> può creare connessioni
spurie nel grafo:</p>
<pre><code>Rumore nei dati → RR &gt; 1 per caso → Arco spurio → Clique spuria → Segmentazione errata</code></pre>
<p>Questo problema è particolarmente grave quando:</p>
<ul>
<li>Molte celle hanno pochi conteggi (alta varianza)</li>
<li>La matrice è densa (molte celle non-zero)</li>
<li>I gruppi “veri” sono collegati da transizioni casuali</li>
</ul>
</div>
<div class="section level3">
<h3 id="come-la-riduzione-di-densità-migliora-la-segmentazione">12.2 Come la riduzione di densità migliora la segmentazione<a class="anchor" aria-label="anchor" href="#come-la-riduzione-di-densit%C3%A0-migliora-la-segmentazione"></a>
</h3>
<p>La funzione <code><a href="../reference/reduce_density.html">reduce_density()</a></code> interviene
<strong>prima</strong> del calcolo dei rischi relativi, azzerando le
celle considerate rumore:</p>
<pre><code>Matrice originale → reduce_density() → Matrice pulita → weight.matrix() → Grafo → MONECA</code></pre>
<div class="section level4">
<h4 id="effetto-sul-grafo">12.2.1 Effetto sul grafo<a class="anchor" aria-label="anchor" href="#effetto-sul-grafo"></a>
</h4>
<table class="table">
<thead><tr class="header">
<th>Aspetto</th>
<th>Senza riduzione</th>
<th>Con riduzione</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Celle non-zero</td>
<td>Molte (rumore incluso)</td>
<td>Meno (solo segnale)</td>
</tr>
<tr class="even">
<td>Archi nel grafo</td>
<td>Molti (spuri inclusi)</td>
<td>Meno (più accurati)</td>
</tr>
<tr class="odd">
<td>Cliques trovate</td>
<td>Possono essere “miste”</td>
<td>Più “pure”</td>
</tr>
<tr class="even">
<td>Isolati</td>
<td>Meno (connessi per caso)</td>
<td>Più (solo veri isolati)</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="meccanismo-matematico">12.2.2 Meccanismo matematico<a class="anchor" aria-label="anchor" href="#meccanismo-matematico"></a>
</h4>
<ol style="list-style-type: decimal">
<li>
<strong>Celle di rumore azzerate</strong>: transizioni rare/casuali
→ 0</li>
<li>
<strong>RR non calcolabile</strong>: se numeratore = 0, la cella non
contribuisce</li>
<li>
<strong>Nessun arco spurio</strong>: connessioni casuali
rimosse</li>
<li>
<strong>Cliques più pure</strong>: solo categorie con mobilità
strutturale reciproca</li>
</ol>
</div>
</div>
<div class="section level3">
<h3 id="esempio-comparativo">12.3 Esempio comparativo<a class="anchor" aria-label="anchor" href="#esempio-comparativo"></a>
</h3>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Creare matrice con 3 gruppi + rumore</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="va">pattern_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span>, <span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gruppo A (1-4): alta mobilità interna</span></span>
<span><span class="va">pattern_matrix</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">80</span>, <span class="fl">35</span>, <span class="fl">30</span>, <span class="fl">25</span>,</span>
<span>  <span class="fl">32</span>, <span class="fl">75</span>, <span class="fl">28</span>, <span class="fl">22</span>,</span>
<span>  <span class="fl">28</span>, <span class="fl">30</span>, <span class="fl">70</span>, <span class="fl">20</span>,</span>
<span>  <span class="fl">22</span>, <span class="fl">20</span>, <span class="fl">18</span>, <span class="fl">65</span></span>
<span><span class="op">)</span>, <span class="fl">4</span>, <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gruppo B (5-8): alta mobilità interna</span></span>
<span><span class="va">pattern_matrix</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">70</span>, <span class="fl">28</span>, <span class="fl">25</span>, <span class="fl">18</span>,</span>
<span>  <span class="fl">25</span>, <span class="fl">65</span>, <span class="fl">30</span>, <span class="fl">15</span>,</span>
<span>  <span class="fl">22</span>, <span class="fl">28</span>, <span class="fl">60</span>, <span class="fl">20</span>,</span>
<span>  <span class="fl">15</span>, <span class="fl">12</span>, <span class="fl">18</span>, <span class="fl">55</span></span>
<span><span class="op">)</span>, <span class="fl">4</span>, <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gruppo C (9-12): alta mobilità interna</span></span>
<span><span class="va">pattern_matrix</span><span class="op">[</span><span class="fl">9</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">60</span>, <span class="fl">22</span>, <span class="fl">20</span>, <span class="fl">15</span>,</span>
<span>  <span class="fl">20</span>, <span class="fl">55</span>, <span class="fl">25</span>, <span class="fl">12</span>,</span>
<span>  <span class="fl">18</span>, <span class="fl">22</span>, <span class="fl">50</span>, <span class="fl">18</span>,</span>
<span>  <span class="fl">12</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">45</span></span>
<span><span class="op">)</span>, <span class="fl">4</span>, <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Aggiungere RUMORE tra i gruppi</span></span>
<span><span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">n</span>, lambda <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">noise</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">noise</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">noise</span><span class="op">[</span><span class="fl">9</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">noisy_matrix</span> <span class="op">&lt;-</span> <span class="va">pattern_matrix</span> <span class="op">+</span> <span class="va">noise</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">noisy_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">noisy_matrix</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">40</span><span class="op">:</span><span class="fl">80</span>, <span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Costruire matrice completa</span></span>
<span><span class="va">row_tots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">noisy_matrix</span><span class="op">)</span></span>
<span><span class="va">col_tots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">noisy_matrix</span><span class="op">)</span></span>
<span><span class="va">full_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">noisy_matrix</span>, <span class="va">row_tots</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">col_tots</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">noisy_matrix</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">group_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">full_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">full_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">group_names</span>, <span class="st">"Tot"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Struttura attesa:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Struttura attesa:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Gruppo A: A1, A2, A3, A4\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Gruppo A: A1, A2, A3, A4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Gruppo B: B1, B2, B3, B4\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Gruppo B: B1, B2, B3, B4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Gruppo C: C1, C2, C3, C4\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Gruppo C: C1, C2, C3, C4</span></span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analisi SENZA riduzione</span></span>
<span><span class="va">wm_original</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weight.matrix.html">weight.matrix</a></span><span class="op">(</span><span class="va">full_matrix</span>, cut.off <span class="op">=</span> <span class="fl">1</span>, symmetric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">n_edges_original</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">wm_original</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span><span class="va">seg_original</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moneca_fast.html">moneca_fast</a></span><span class="op">(</span><span class="va">full_matrix</span>, segment.levels <span class="op">=</span> <span class="fl">3</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Analisi CON riduzione</span></span>
<span><span class="va">reduced_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">full_matrix</span>,</span>
<span>                                  method <span class="op">=</span> <span class="st">"svd"</span>,</span>
<span>                                  k <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                  filter_quantile <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>                                  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                  seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wm_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weight.matrix.html">weight.matrix</a></span><span class="op">(</span><span class="va">reduced_matrix</span>, cut.off <span class="op">=</span> <span class="fl">1</span>, symmetric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">n_edges_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">wm_reduced</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span><span class="va">seg_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moneca_fast.html">moneca_fast</a></span><span class="op">(</span><span class="va">reduced_matrix</span>, segment.levels <span class="op">=</span> <span class="fl">3</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Archi nel grafo (originale): %d\n"</span>, <span class="va">n_edges_original</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Archi nel grafo (originale): 18</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Archi nel grafo (ridotto):   %d\n"</span>, <span class="va">n_edges_reduced</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Archi nel grafo (ridotto):   18</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Riduzione: %.1f%%\n"</span>, <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">n_edges_reduced</span> <span class="op">/</span> <span class="va">n_edges_original</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Riduzione: 0.0%</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Funzione per valutare purezza dei segmenti</span></span>
<span><span class="va">evaluate_purity</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">seg</span>, <span class="va">names_vec</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">level2</span> <span class="op">&lt;-</span> <span class="va">seg</span><span class="op">$</span><span class="va">segment.list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">level2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">members</span> <span class="op">&lt;-</span> <span class="va">names_vec</span><span class="op">[</span><span class="va">level2</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">members</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">members</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">purity</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">groups</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="st">"puro"</span> <span class="kw">else</span> <span class="st">"misto"</span></span>
<span>      <span class="va">results</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        members <span class="op">=</span> <span class="va">members</span>,</span>
<span>        groups <span class="op">=</span> <span class="va">groups</span>,</span>
<span>        purity <span class="op">=</span> <span class="va">purity</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nSegmenti al livello 2 - ORIGINALE:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Segmenti al livello 2 - ORIGINALE:</span></span>
<span><span class="va">orig_segs</span> <span class="op">&lt;-</span> <span class="fu">evaluate_purity</span><span class="op">(</span><span class="va">seg_original</span>, <span class="va">group_names</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="va">orig_segs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">status</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">purity</span> <span class="op">==</span> <span class="st">"puro"</span><span class="op">)</span> <span class="st">"[OK]"</span> <span class="kw">else</span> <span class="st">"[MIX]"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  %s [%s] (gruppi: %s)\n"</span>,</span>
<span>              <span class="va">status</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">members</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">groups</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;   [OK] [C1, C2, C3, C4] (gruppi: C)</span></span>
<span><span class="co">#&gt;   [OK] [B1, B2, B3, B4] (gruppi: B)</span></span>
<span><span class="co">#&gt;   [OK] [A1, A2, A3, A4] (gruppi: A)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nSegmenti al livello 2 - RIDOTTO:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Segmenti al livello 2 - RIDOTTO:</span></span>
<span><span class="va">red_segs</span> <span class="op">&lt;-</span> <span class="fu">evaluate_purity</span><span class="op">(</span><span class="va">seg_reduced</span>, <span class="va">group_names</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="va">red_segs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">status</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">purity</span> <span class="op">==</span> <span class="st">"puro"</span><span class="op">)</span> <span class="st">"[OK]"</span> <span class="kw">else</span> <span class="st">"[MIX]"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  %s [%s] (gruppi: %s)\n"</span>,</span>
<span>              <span class="va">status</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">members</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">groups</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;   [OK] [C1, C2, C3, C4] (gruppi: C)</span></span>
<span><span class="co">#&gt;   [OK] [B1, B2, B3, B4] (gruppi: B)</span></span>
<span><span class="co">#&gt;   [OK] [A1, A2, A3, A4] (gruppi: A)</span></span>
<span></span>
<span><span class="co"># Calcolare purezza complessiva</span></span>
<span><span class="va">purity_orig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">orig_segs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">purity</span> <span class="op">==</span> <span class="st">"puro"</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">orig_segs</span><span class="op">)</span></span>
<span><span class="va">purity_red</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">red_segs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">purity</span> <span class="op">==</span> <span class="st">"puro"</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">red_segs</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\nPurezza segmenti (originale): %.0f%%\n"</span>, <span class="fl">100</span> <span class="op">*</span> <span class="va">purity_orig</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Purezza segmenti (originale): 100%</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Purezza segmenti (ridotto):   %.0f%%\n"</span>, <span class="fl">100</span> <span class="op">*</span> <span class="va">purity_red</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Purezza segmenti (ridotto):   100%</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="raccomandazioni-pratiche">12.4 Raccomandazioni pratiche<a class="anchor" aria-label="anchor" href="#raccomandazioni-pratiche"></a>
</h3>
<div class="section level4">
<h4 id="quando-applicare-la-riduzione">12.4.1 Quando applicare la riduzione<a class="anchor" aria-label="anchor" href="#quando-applicare-la-riduzione"></a>
</h4>
<p>La riduzione di densità è particolarmente utile quando:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Matrici grandi</strong> (60+ categorie) con molte celle
rumorose</li>
<li>
<strong>Segmenti “misti”</strong> nell’analisi iniziale (categorie
di gruppi diversi insieme)</li>
<li>
<strong>Troppi archi</strong> nel grafo dei rischi relativi</li>
<li>
<strong>Pochi isolati</strong> quando ci si aspetterebbe di più</li>
</ol>
</div>
<div class="section level4">
<h4 id="parametri-consigliati">12.4.2 Parametri consigliati<a class="anchor" aria-label="anchor" href="#parametri-consigliati"></a>
</h4>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Configurazione conservativa (preserva più struttura)</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">mx</span>,</span>
<span>                          method <span class="op">=</span> <span class="st">"svd"</span>,</span>
<span>                          variance_target <span class="op">=</span> <span class="fl">0.85</span>,</span>
<span>                          filter_quantile <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Configurazione aggressiva (rimuove più rumore)</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">mx</span>,</span>
<span>                          method <span class="op">=</span> <span class="st">"svd"</span>,</span>
<span>                          variance_target <span class="op">=</span> <span class="fl">0.70</span>,</span>
<span>                          filter_quantile <span class="op">=</span> <span class="fl">0.50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Per matrici molto dense</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span><span class="va">mx</span>,</span>
<span>                          method <span class="op">=</span> <span class="st">"svd"</span>,</span>
<span>                          variance_target <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>                          filter_quantile <span class="op">=</span> <span class="fl">0.60</span>,</span>
<span>                          threshold <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="validazione-dei-risultati-1">12.4.3 Validazione dei risultati<a class="anchor" aria-label="anchor" href="#validazione-dei-risultati-1"></a>
</h4>
<p>Confrontare sempre:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Numero di segmenti</strong> prima e dopo la riduzione</li>
<li>
<strong>Purezza dei segmenti</strong> (se si conosce la struttura
attesa)</li>
<li>
<strong>Numero di isolati</strong> (dovrebbe aumentare se il rumore
collegava gruppi)</li>
<li>
<strong>Stabilità</strong> (risultati simili con parametri
leggermente diversi)</li>
</ol>
</div>
</div>
</div>
<div class="section level2">
<h2 id="appendice-a-codice-completo-per-analisi-esempio">Appendice A: Codice Completo per Analisi Esempio<a class="anchor" aria-label="anchor" href="#appendice-a-codice-completo-per-analisi-esempio"></a>
</h2>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Carica librerie</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gmontaletti.github.io/MONECA/">moneca</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Genera dati di grandi dimensioni</span></span>
<span><span class="va">large_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_mobility_data.html">generate_mobility_data</a></span><span class="op">(</span></span>
<span>  n_classes <span class="op">=</span> <span class="fl">80</span>,</span>
<span>  n_total <span class="op">=</span> <span class="fl">100000</span>,</span>
<span>  immobility_strength <span class="op">=</span> <span class="fl">0.65</span>,</span>
<span>  class_clustering <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">123</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Visualizza scree plot</span></span>
<span><span class="fu"><a href="../reference/plot_scree.html">plot_scree</a></span><span class="op">(</span><span class="va">large_data</span>, max_components <span class="op">=</span> <span class="fl">40</span>, variance_target <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Applica riduzione della densità</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduce_density.html">reduce_density</a></span><span class="op">(</span></span>
<span>  <span class="va">large_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"svd"</span>,</span>
<span>  normalization <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  k <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  variance_target <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  threshold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Analisi MONECA</span></span>
<span><span class="va">seg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moneca.html">moneca</a></span><span class="op">(</span></span>
<span>  <span class="va">reduced</span>,</span>
<span>  segment.levels <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  small.cell.reduction <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. Valuta qualità</span></span>
<span><span class="va">quality</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment.quality.html">segment.quality</a></span><span class="op">(</span><span class="va">seg</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">quality</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 6. Visualizza rete</span></span>
<span><span class="fu"><a href="../reference/plot_moneca_ggraph.html">plot_moneca_ggraph</a></span><span class="op">(</span></span>
<span>  <span class="va">seg</span>,</span>
<span>  level <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  layout <span class="op">=</span> <span class="st">"fr"</span>,</span>
<span>  node_color <span class="op">=</span> <span class="st">"segment"</span>,</span>
<span>  node_size <span class="op">=</span> <span class="st">"mobility"</span>,</span>
<span>  show_labels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Rete di Mobilità Ridotta - Livello 1"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 7. Visualizza dendrogramma</span></span>
<span><span class="fu"><a href="../reference/plot_moneca_dendrogram.html">plot_moneca_dendrogram</a></span><span class="op">(</span></span>
<span>  <span class="va">seg</span>,</span>
<span>  label_size <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Struttura Gerarchica"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 8. Estrai membership</span></span>
<span><span class="va">membership</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment.membership.dataframe.html">segment.membership.dataframe</a></span><span class="op">(</span><span class="va">seg</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">membership</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="appendice-b-glossario">Appendice B: Glossario<a class="anchor" aria-label="anchor" href="#appendice-b-glossario"></a>
</h2>
<p><strong>Clique</strong>: sottografo completo in cui ogni coppia di
nodi è connessa da un arco. MONECA identifica cliques come cluster di
posizioni con elevata mobilità interna.</p>
<p><strong>Componente</strong>: direzione di variazione nella
decomposizione matriciale. Le prime componenti catturano i pattern
dominanti.</p>
<p><strong>Densità</strong>: proporzione di celle non-zero in una
matrice. Matrici sparse hanno bassa densità.</p>
<p><strong>Elbow point</strong> (punto di gomito): punto in un grafico
varianza-componenti dove il beneficio marginale di aggiungere componenti
diminuisce bruscamente.</p>
<p><strong>Fattorizzazione</strong>: decomposizione di una matrice nel
prodotto di matrici più semplici.</p>
<p><strong>Filter quantile</strong>: parametro di entrambi i metodi (SVD
e NMF) che controlla la proporzione di celle da mantenere basandosi sui
valori di ricostruzione. Valori più alti mantengono più celle; la
selezione automatica usa il rilevamento del gomito (elbow
detection).</p>
<p><strong>Immobilità</strong>: permanenza nella stessa categoria tra
due osservazioni. Rappresentata dalla diagonale della matrice di
mobilità. Alta immobilità può contribuire all’isolamento di una
categoria.</p>
<p><strong>Isolato</strong>: categoria che non appartiene a nessun
segmento multi-membro nella segmentazione MONECA. Può derivare da
pattern disperso (mobilità uniforme), atipico (non reciproco), o
periferico (alta immobilità con poche uscite).</p>
<p><strong>Matrice core</strong>: matrice di mobilità escludendo riga e
colonna dei totali marginali.</p>
<p><strong>Normalizzazione</strong>: trasformazione dei dati per
rimuovere effetti sistematici o rendere confrontabili scale diverse.</p>
<p><strong>Rango</strong>: dimensione dello spazio generato dalle righe
(o colonne) di una matrice. Approssimazione a basso rango mantiene solo
le direzioni più importanti.</p>
<p><strong>Residui</strong>: differenza tra valori osservati e valori
attesi sotto un modello di riferimento (es. indipendenza).</p>
<p><strong>Scree plot</strong>: grafico della varianza spiegata per
componente, utilizzato per scegliere il numero di componenti.</p>
<p><strong>Sparsità</strong>: proporzione di celle zero in una matrice.
Complementare della densità.</p>
<p><strong>SVD troncata</strong>: SVD mantenendo solo le prime k
componenti, producendo un’approssimazione a basso rango.</p>
<p><strong>Valori singolari</strong>: elementi della matrice diagonale Σ
nella SVD, rappresentano l’importanza delle componenti.</p>
<p><strong>Varianza spiegata</strong>: proporzione della variabilità
totale catturata da un insieme di componenti.</p>
<p><strong>Arco spurio</strong>: connessione nel grafo dei rischi
relativi creata dal rumore statistico piuttosto che da una vera
relazione di mobilità strutturale. La riduzione di densità mira a
eliminare gli archi spuri.</p>
<p><strong>Purezza del segmento</strong>: misura di quanto un segmento
identificato da MONECA corrisponda a un gruppo “vero” atteso. Un
segmento puro contiene solo categorie dello stesso gruppo logico; un
segmento misto contiene categorie di gruppi diversi.</p>
<p><strong>Rischio relativo (RR)</strong>: rapporto tra mobilità
osservata e mobilità attesa sotto indipendenza. RR &gt; 1 indica
mobilità sopra le aspettative; RR &lt; 1 indica mobilità sotto le
aspettative. Solo celle con RR &gt;= cut.off formano archi nel grafo
MONECA.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Giampaolo Montaletti, Jonas Touboel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
