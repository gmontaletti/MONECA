<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Log-Linear Models for Mobility Tables • moneca</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Log-Linear Models for Mobility Tables">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">moneca</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/moneca-introduction.html">Introduction to moneca: Mobility Network Clustering Analysis</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="dropdown-item" href="https://gmontaletti.github.io/MONECA/news/index.html#moneca-105">Version 1.0.5</a></li>
    <li><a class="dropdown-item" href="https://gmontaletti.github.io/MONECA/news/index.html#moneca-100">Version 1.0.0</a></li>
    <li><a class="dropdown-item" href="https://gmontaletti.github.io/MONECA/news/index.html#moneca-09">Version 0.9</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gmontaletti/MONECA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Log-Linear Models for Mobility Tables</h1>
                        <h4 data-toc-skip class="author">Giampaolo
Montaletti</h4>
            
            <h4 data-toc-skip class="date">2026-02-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gmontaletti/MONECA/blob/master/vignettes/loglinear-models.Rmd" class="external-link"><code>vignettes/loglinear-models.Rmd</code></a></small>
      <div class="d-none name"><code>loglinear-models.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>A mobility table records how individuals move between categories
(occupations, social classes, regions) over time. MONECA identifies
clusters of categories with high internal mobility using a
graph-theoretic algorithm. Log-linear models complement this by
providing a statistical framework to test whether those clusters — or
other structural features — capture genuine patterns in the data.</p>
<p>The moneca package provides two functions for this purpose:</p>
<ul>
<li>
<code><a href="../reference/fit_mobility_model.html">fit_mobility_model()</a></code> fits a single log-linear model to
a mobility table</li>
<li>
<code><a href="../reference/compare_mobility_models.html">compare_mobility_models()</a></code> compares multiple models side
by side, with likelihood-ratio tests for nested pairs</li>
</ul>
<p>This vignette walks through a complete analysis using synthetic data,
covering the five model types, how to read their output, how to compare
them, and how to inspect residuals for further insight.</p>
</div>
<div class="section level2">
<h2 id="setup-generate-data-and-run-moneca">Setup: generate data and run MONECA<a class="anchor" aria-label="anchor" href="#setup-generate-data-and-run-moneca"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gmontaletti.github.io/MONECA/">moneca</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate an 8-class mobility table</span></span>
<span><span class="va">mx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_mobility_data.html">generate_mobility_data</a></span><span class="op">(</span></span>
<span>  n_classes <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  n_total <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  immobility_strength <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  class_clustering <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run MONECA</span></span>
<span><span class="va">seg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moneca_fast.html">moneca_fast</a></span><span class="op">(</span><span class="va">mx</span>, segment.levels <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                              |======================================================================| 100%</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">seg</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt;                         moneca MOBILITY ANALYSIS RESULTS                        </span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; OVERALL MOBILITY PATTERNS</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Overall Population Mobility Rate:                    41.3%</span></span>
<span><span class="co">#&gt; Average Mobility Concentration (all levels):         88.8%</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; HIERARCHICAL SEGMENTATION ANALYSIS</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Internal Mobility Within Segments (%):</span></span>
<span><span class="co">#&gt; Level 1 Level 2 Level 3 Level 4 </span></span>
<span><span class="co">#&gt;    58.7    82.9    90.2   100.0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Mobility Concentration in Significant Pathways by Level (%):</span></span>
<span><span class="co">#&gt; Level 1 Level 2 Level 3 Level 4 </span></span>
<span><span class="co">#&gt;    82.0    82.9    90.2   100.0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Network Structure by Level:</span></span>
<span><span class="co">#&gt;                                    Level 1      Level 2      Level 3      Level 4 </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Active Segments/Classes:                 8            3            2            1 </span></span>
<span><span class="co">#&gt; Significant Edges:                      13            0            0            0 </span></span>
<span><span class="co">#&gt; Network Density:                     0.232        0.000        0.000          NaN </span></span>
<span><span class="co">#&gt; Isolated Segments:                       0            3            2            1 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; DETAILED WEIGHTED DEGREE DISTRIBUTIONS (STRENGTH)</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total Weighted Connections (Strength In + Out):</span></span>
<span><span class="co">#&gt;          Min   Q1 Median Mean   Q3  Max</span></span>
<span><span class="co">#&gt; Level 1 1.23 2.43   5.68  5.1 6.59 10.5</span></span>
<span><span class="co">#&gt; Level 2 0.00 0.00   0.00  0.0 0.00  0.0</span></span>
<span><span class="co">#&gt; Level 3 0.00 0.00   0.00  0.0 0.00  0.0</span></span>
<span><span class="co">#&gt; Level 4 0.00 0.00   0.00  0.0 0.00  0.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Outward Mobility Strength (Weighted Out-Degree):</span></span>
<span><span class="co">#&gt;         Min   Q1 Median Mean   Q3  Max</span></span>
<span><span class="co">#&gt; Level 1   0 2.39   2.67 2.55 3.16 4.02</span></span>
<span><span class="co">#&gt; Level 2   0 0.00   0.00 0.00 0.00 0.00</span></span>
<span><span class="co">#&gt; Level 3   0 0.00   0.00 0.00 0.00 0.00</span></span>
<span><span class="co">#&gt; Level 4   0 0.00   0.00 0.00 0.00 0.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Inward Mobility Strength (Weighted In-Degree):</span></span>
<span><span class="co">#&gt;         Min   Q1 Median Mean   Q3  Max</span></span>
<span><span class="co">#&gt; Level 1   0 0.92    2.7 2.55 3.11 7.51</span></span>
<span><span class="co">#&gt; Level 2   0 0.00    0.0 0.00 0.00 0.00</span></span>
<span><span class="co">#&gt; Level 3   0 0.00    0.0 0.00 0.00 0.00</span></span>
<span><span class="co">#&gt; Level 4   0 0.00    0.0 0.00 0.00 0.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Edge Weight Distribution (Relative Risk Values):</span></span>
<span><span class="co">#&gt;          Min  Q1 Median Mean   Q3  Max</span></span>
<span><span class="co">#&gt; Level 1 1.21 1.3    1.4 1.57 1.78 2.56</span></span>
<span><span class="co">#&gt; Level 2   NA  NA     NA  NaN   NA   NA</span></span>
<span><span class="co">#&gt; Level 3   NA  NA     NA  NaN   NA   NA</span></span>
<span><span class="co">#&gt; Level 4   NA  NA     NA  NaN   NA   NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ================================================================================</span></span></code></pre></div>
<p>The resulting object <code>seg</code> contains segment assignments at
multiple hierarchical levels. The log-linear models below test whether
these assignments explain statistically meaningful structure in the
table.</p>
</div>
<div class="section level2">
<h2 id="the-five-model-types">The five model types<a class="anchor" aria-label="anchor" href="#the-five-model-types"></a>
</h2>
<p>Each model represents a different hypothesis about what drives
mobility patterns. They are ordered from simplest to most complex.</p>
<div class="section level3">
<h3 id="independence">Independence<a class="anchor" aria-label="anchor" href="#independence"></a>
</h3>
<p>The independence model assumes that origin and destination are
unrelated: knowing where someone starts tells you nothing about where
they end up. All cell frequencies are predicted from the row and column
marginal totals alone.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_mobility_model.html">fit_mobility_model</a></span><span class="op">(</span><span class="va">mx</span>, type <span class="op">=</span> <span class="st">"independence"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">m_ind</span><span class="op">)</span></span>
<span><span class="co">#&gt; Log-Linear Model for Mobility Table</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Type: independence</span></span>
<span><span class="co">#&gt; Categories: 8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance (G2): 14676.049</span></span>
<span><span class="co">#&gt; Df: 49</span></span>
<span><span class="co">#&gt; P-value: 0</span></span>
<span><span class="co">#&gt; Dissimilarity index: 0.500</span></span>
<span><span class="co">#&gt; AIC: 15068.707</span></span>
<span><span class="co">#&gt; BIC: 15101.091</span></span></code></pre></div>
<p>This model almost always fits poorly for mobility tables, because
people tend to stay in their current position or move to nearby ones. It
serves as a baseline against which other models are compared.</p>
</div>
<div class="section level3">
<h3 id="quasi-independence">Quasi-independence<a class="anchor" aria-label="anchor" href="#quasi-independence"></a>
</h3>
<p>The quasi-independence model adds a separate parameter for each
diagonal cell, accounting for the fact that people tend to stay put
(immobility). Off-diagonal flows are still assumed to follow the
marginal distributions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_qi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_mobility_model.html">fit_mobility_model</a></span><span class="op">(</span><span class="va">mx</span>, type <span class="op">=</span> <span class="st">"quasi_independence"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">m_qi</span><span class="op">)</span></span>
<span><span class="co">#&gt; Log-Linear Model for Mobility Table</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Type: quasi_independence</span></span>
<span><span class="co">#&gt; Categories: 8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance (G2): 3843.491</span></span>
<span><span class="co">#&gt; Df: 41</span></span>
<span><span class="co">#&gt; P-value: 0</span></span>
<span><span class="co">#&gt; Dissimilarity index: 0.176</span></span>
<span><span class="co">#&gt; AIC: 4252.149</span></span>
<span><span class="co">#&gt; BIC: 4301.803</span></span></code></pre></div>
<p>The improvement over independence is typically large, because
immobility is the dominant feature of most mobility tables. However, a
low p-value or high dissimilarity index here means that the off-diagonal
structure — who moves where — is not random.</p>
</div>
<div class="section level3">
<h3 id="quasi-symmetry">Quasi-symmetry<a class="anchor" aria-label="anchor" href="#quasi-symmetry"></a>
</h3>
<p>The quasi-symmetry model tests whether the flow from category A to B
equals the flow from B to A, after accounting for differences in
marginal sizes. It adds a parameter for each unordered pair of
categories.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_qs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_mobility_model.html">fit_mobility_model</a></span><span class="op">(</span><span class="va">mx</span>, type <span class="op">=</span> <span class="st">"quasi_symmetry"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">m_qs</span><span class="op">)</span></span>
<span><span class="co">#&gt; Log-Linear Model for Mobility Table</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Type: quasi_symmetry</span></span>
<span><span class="co">#&gt; Categories: 8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance (G2): 19.811</span></span>
<span><span class="co">#&gt; Df: 21</span></span>
<span><span class="co">#&gt; P-value: 0.533</span></span>
<span><span class="co">#&gt; Dissimilarity index: 0.008</span></span>
<span><span class="co">#&gt; AIC: 468.469</span></span>
<span><span class="co">#&gt; BIC: 561.301</span></span></code></pre></div>
<p>If this model fits well, mobility is approximately symmetric:
transitions between any two categories are balanced (relative to their
sizes). If it fits poorly, some flows are directional — people move more
easily in one direction than the other.</p>
<p>The quasi-symmetry model is fitted using Iterative Proportional
Fitting (IPF) rather than GLM, which makes it fast and numerically
stable even for large matrices.</p>
</div>
<div class="section level3">
<h3 id="uniform-association">Uniform association<a class="anchor" aria-label="anchor" href="#uniform-association"></a>
</h3>
<p>The uniform association model adds a single parameter measuring the
overall strength of ordinal association. It treats categories as ordered
(by their position in the table) and asks: do adjacent categories
exchange members more often than distant ones?</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_ua</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_mobility_model.html">fit_mobility_model</a></span><span class="op">(</span><span class="va">mx</span>, type <span class="op">=</span> <span class="st">"uniform_association"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">m_ua</span><span class="op">)</span></span>
<span><span class="co">#&gt; Log-Linear Model for Mobility Table</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Type: uniform_association</span></span>
<span><span class="co">#&gt; Categories: 8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance (G2): 3491.285</span></span>
<span><span class="co">#&gt; Df: 48</span></span>
<span><span class="co">#&gt; P-value: 0</span></span>
<span><span class="co">#&gt; Dissimilarity index: 0.220</span></span>
<span><span class="co">#&gt; AIC: 3885.943</span></span>
<span><span class="co">#&gt; BIC: 3920.485</span></span></code></pre></div>
<p>This model is useful when categories have a natural ordering (e.g.,
social classes from lower to upper). If the mobility structure is
multidimensional rather than ordinal, the single association parameter
will not capture it well.</p>
</div>
<div class="section level3">
<h3 id="moneca-topology">MONECA topology<a class="anchor" aria-label="anchor" href="#moneca-topology"></a>
</h3>
<p>The MONECA topology model uses segment assignments from a MONECA
analysis as structural predictors. It adds diagonal parameters (like
quasi-independence) plus a segment-pair factor that distinguishes
within-segment from between-segment flows.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_top</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_mobility_model.html">fit_mobility_model</a></span><span class="op">(</span><span class="va">seg</span>, type <span class="op">=</span> <span class="st">"moneca_topology"</span>, level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">m_top</span><span class="op">)</span></span>
<span><span class="co">#&gt; Log-Linear Model for Mobility Table</span></span>
<span><span class="co">#&gt; ====================================</span></span>
<span><span class="co">#&gt; Type: moneca_topology</span></span>
<span><span class="co">#&gt; Categories: 8</span></span>
<span><span class="co">#&gt; Segment level: 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance (G2): 1290.816</span></span>
<span><span class="co">#&gt; Df: 38</span></span>
<span><span class="co">#&gt; P-value: 3.06e-246</span></span>
<span><span class="co">#&gt; Dissimilarity index: 0.087</span></span>
<span><span class="co">#&gt; AIC: 1705.474</span></span>
<span><span class="co">#&gt; BIC: 1761.605</span></span></code></pre></div>
<p>If this model fits substantially better than quasi-independence, the
segments identified by MONECA correspond to genuine mobility barriers:
people move within segments more than expected and between segments less
than expected.</p>
</div>
</div>
<div class="section level2">
<h2 id="reading-the-output">Reading the output<a class="anchor" aria-label="anchor" href="#reading-the-output"></a>
</h2>
<p>Each <code><a href="../reference/fit_mobility_model.html">fit_mobility_model()</a></code> call returns a
<code>moneca_loglinear</code> object with several fields:</p>
<ul>
<li>
<strong>Deviance (G²)</strong>: the likelihood-ratio statistic
measuring how far the model is from the saturated model (which fits the
data exactly). Lower values indicate better fit.</li>
<li>
<strong>Degrees of freedom (df)</strong>: the number of free data
points minus the number of model parameters. More complex models use
more parameters and have fewer degrees of freedom.</li>
<li>
<strong>P-value</strong>: derived from a chi-squared test of the
deviance. A large p-value (&gt; 0.05) means the model fits adequately; a
small p-value means the model misses structure present in the data.</li>
<li>
<strong>Dissimilarity index</strong>: the proportion of cases that
would need to be reclassified for the model to reproduce the observed
table exactly. Values below 0.05 indicate good fit; below 0.03,
excellent fit.</li>
<li>
<strong>AIC / BIC</strong>: information criteria for comparing
non-nested models. Lower values are preferred. BIC penalizes complexity
more heavily than AIC.</li>
<li>
<strong>Fitted values</strong> (<code>$fitted</code>): the model’s
predicted cell counts, as an n x n matrix.</li>
<li>
<strong>Residuals</strong> (<code>$residuals</code>): Pearson
residuals, as an n x n matrix. Large positive residuals indicate flows
the model under-predicts.</li>
</ul>
</div>
<div class="section level2">
<h2 id="comparing-models">Comparing models<a class="anchor" aria-label="anchor" href="#comparing-models"></a>
</h2>
<p>The <code><a href="../reference/compare_mobility_models.html">compare_mobility_models()</a></code> function produces a
summary table and likelihood-ratio tests in a single call. When passed a
moneca object via <code>mx</code>, it automatically fits all five model
types:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_mobility_models.html">compare_mobility_models</a></span><span class="op">(</span>mx <span class="op">=</span> <span class="va">seg</span>, level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">comp</span><span class="op">)</span></span>
<span><span class="co">#&gt; Log-Linear Model Comparison</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                model  deviance df       aic       bic   p_value dissimilarity</span></span>
<span><span class="co">#&gt;       quasi_symmetry    19.811 21   468.469   561.301  5.33e-01         0.008</span></span>
<span><span class="co">#&gt;      moneca_topology  1290.816 38  1705.474  1761.605 3.06e-246         0.087</span></span>
<span><span class="co">#&gt;  uniform_association  3491.285 48  3885.943  3920.485  0.00e+00         0.220</span></span>
<span><span class="co">#&gt;   quasi_independence  3843.491 41  4252.149  4301.803  0.00e+00         0.176</span></span>
<span><span class="co">#&gt;         independence 14676.049 49 15068.707 15101.091  0.00e+00         0.500</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood-Ratio Tests:</span></span>
<span><span class="co">#&gt;             model_1             model_2 delta_deviance delta_df p_value</span></span>
<span><span class="co">#&gt;        independence  quasi_independence      10832.559        8       0</span></span>
<span><span class="co">#&gt;        independence uniform_association      11184.765        1       0</span></span>
<span><span class="co">#&gt;  quasi_independence      quasi_symmetry       3823.680       20       0</span></span>
<span><span class="co">#&gt;  quasi_independence     moneca_topology       2552.674        3       0</span></span></code></pre></div>
<div class="section level3">
<h3 id="reading-the-comparison-table">Reading the comparison table<a class="anchor" aria-label="anchor" href="#reading-the-comparison-table"></a>
</h3>
<p>The table is sorted by BIC (lowest first). Key columns to
examine:</p>
<ul>
<li>
<strong>BIC</strong>: the primary criterion for model selection
among non-nested models. The model with the lowest BIC provides the best
trade-off between fit and parsimony.</li>
<li>
<strong>Dissimilarity</strong>: a more intuitive measure of
practical fit. Compare values across models to see which ones capture
the data most accurately.</li>
<li>
<strong>P-value</strong>: if any model has a large p-value, it fits
the data adequately on its own. If all p-values are small, all models
miss some structure, and the comparison focuses on which misses
least.</li>
</ul>
</div>
<div class="section level3">
<h3 id="reading-the-likelihood-ratio-tests">Reading the likelihood-ratio tests<a class="anchor" aria-label="anchor" href="#reading-the-likelihood-ratio-tests"></a>
</h3>
<p>The <code>lr_tests</code> component tests whether moving from a
simpler model to a more complex one provides a statistically significant
improvement. Each row shows:</p>
<ul>
<li>
<strong>model_1</strong> (simpler) and <strong>model_2</strong>
(more complex): the two nested models</li>
<li>
<strong>delta_deviance</strong>: the reduction in G² when moving
from the simpler to the more complex model</li>
<li>
<strong>delta_df</strong>: the number of additional parameters
used</li>
<li>
<strong>p_value</strong>: if small, the more complex model captures
real structure that the simpler one misses</li>
</ul>
<p>For example, a significant test between quasi-independence and MONECA
topology means that the MONECA segments explain mobility patterns beyond
what diagonal immobility alone can account for. The segments correspond
to genuine structural features of the table, not artifacts of the
clustering algorithm.</p>
</div>
</div>
<div class="section level2">
<h2 id="working-with-larger-matrices">Working with larger matrices<a class="anchor" aria-label="anchor" href="#working-with-larger-matrices"></a>
</h2>
<p>The log-linear functions scale to large matrices. The quasi-symmetry
model uses IPF rather than GLM, so it remains fast even when GLM-based
fitting becomes numerically expensive.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mx_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_mobility_data.html">generate_mobility_data</a></span><span class="op">(</span></span>
<span>  n_classes <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  n_total <span class="op">=</span> <span class="fl">50000</span>,</span>
<span>  immobility_strength <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  class_clustering <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">99</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">seg_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moneca_fast.html">moneca_fast</a></span><span class="op">(</span><span class="va">mx_large</span>, segment.levels <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                              |======================================================================| 100%</span></span>
<span><span class="co">#&gt;   |                                                                              |======================================================================| 100%</span></span>
<span><span class="co">#&gt;   |                                                                              |======================================================================| 100%</span></span>
<span></span>
<span><span class="co"># Fit all models and compare</span></span>
<span><span class="va">comp_large</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_mobility_models.html">compare_mobility_models</a></span><span class="op">(</span>mx <span class="op">=</span> <span class="va">seg_large</span>, level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">comp_large</span><span class="op">)</span></span>
<span><span class="co">#&gt; Log-Linear Model Comparison</span></span>
<span><span class="co">#&gt; ===========================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                model  deviance  df        aic        bic p_value dissimilarity</span></span>
<span><span class="co">#&gt;       quasi_symmetry    120.32 406   2269.943   4642.326       1         0.008</span></span>
<span><span class="co">#&gt;      moneca_topology  13993.01 746  15462.638  16202.207       0         0.113</span></span>
<span><span class="co">#&gt;  uniform_association  26763.13 840  28044.757  28332.900       0         0.246</span></span>
<span><span class="co">#&gt;   quasi_independence  74820.91 811  76160.538  76587.951       0         0.345</span></span>
<span><span class="co">#&gt;         independence 190407.61 841 191687.230 191970.571       0         0.813</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood-Ratio Tests:</span></span>
<span><span class="co">#&gt;             model_1             model_2 delta_deviance delta_df p_value</span></span>
<span><span class="co">#&gt;        independence  quasi_independence       115586.7       30       0</span></span>
<span><span class="co">#&gt;        independence uniform_association       163644.5        1       0</span></span>
<span><span class="co">#&gt;  quasi_independence      quasi_symmetry        74700.6      405       0</span></span>
<span><span class="co">#&gt;  quasi_independence     moneca_topology        60827.9       65       0</span></span></code></pre></div>
<p>For matrices with 50 or more categories, the quasi-symmetry model
fitted via IPF typically converges in 20–50 iterations, while a
GLM-based approach for the same model would require thousands of
symmetric-pair parameters.</p>
</div>
<div class="section level2">
<h2 id="inspecting-residuals">Inspecting residuals<a class="anchor" aria-label="anchor" href="#inspecting-residuals"></a>
</h2>
<p>The residuals from the best-fitting model identify specific flows
that the model does not capture well. Large positive Pearson residuals
point to transitions that occur more often than the model predicts —
unexpected mobility channels that may warrant further investigation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract residuals from the MONECA topology model</span></span>
<span><span class="va">resid_mx</span> <span class="op">&lt;-</span> <span class="va">m_top</span><span class="op">$</span><span class="va">residuals</span></span>
<span></span>
<span><span class="co"># Convert to a sorted data frame</span></span>
<span><span class="va">resid_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Origin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">resid_mx</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">resid_mx</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Destination <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">resid_mx</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">resid_mx</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Residual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">resid_mx</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove diagonal (immobility is accounted for by the model)</span></span>
<span><span class="va">resid_df</span> <span class="op">&lt;-</span> <span class="va">resid_df</span><span class="op">[</span><span class="va">resid_df</span><span class="op">$</span><span class="va">Origin</span> <span class="op">!=</span> <span class="va">resid_df</span><span class="op">$</span><span class="va">Destination</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Show the largest under-predicted flows</span></span>
<span><span class="va">resid_df</span> <span class="op">&lt;-</span> <span class="va">resid_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">resid_df</span><span class="op">$</span><span class="va">Residual</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">resid_df</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Origin Destination  Residual</span></span>
<span><span class="co">#&gt; 45 Class 5     Class 6 15.425074</span></span>
<span><span class="co">#&gt; 39 Class 7     Class 5 11.555896</span></span>
<span><span class="co">#&gt; 17 Class 1     Class 3 10.465040</span></span>
<span><span class="co">#&gt; 38 Class 6     Class 5  9.117058</span></span>
<span><span class="co">#&gt; 11 Class 3     Class 2  7.256005</span></span>
<span><span class="co">#&gt; 30 Class 6     Class 4  5.509197</span></span>
<span><span class="co">#&gt; 18 Class 2     Class 3  5.506344</span></span>
<span><span class="co">#&gt; 3  Class 3     Class 1  5.153430</span></span>
<span><span class="co">#&gt; 29 Class 5     Class 4  5.145182</span></span>
<span><span class="co">#&gt; 56 Class 8     Class 7  4.498055</span></span></code></pre></div>
<p>These are category pairs where observed mobility exceeds the model’s
prediction. They represent flows that cross the segment boundaries
identified by MONECA — transitions between clusters that the topology
model does not anticipate. Such cross-segment flows can reveal labor
market connections, institutional pathways, or structural changes that a
cluster-based model misses.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>The typical workflow for log-linear analysis of a mobility table
is:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Run MONECA</strong> (<code><a href="../reference/moneca.html">moneca()</a></code> or
<code><a href="../reference/moneca_fast.html">moneca_fast()</a></code>) to identify segment structure</li>
<li>
<strong>Compare models</strong> with
<code><a href="../reference/compare_mobility_models.html">compare_mobility_models()</a></code> to assess whether the segments
capture genuine patterns</li>
<li>
<strong>Inspect residuals</strong> from the best model to identify
unexpected mobility channels</li>
</ol>
<p>The five model types test different hypotheses:</p>
<table class="table">
<colgroup>
<col width="21%">
<col width="42%">
<col width="36%">
</colgroup>
<thead><tr class="header">
<th align="left">Model</th>
<th align="left">What it tests</th>
<th align="left">Typical use</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Independence</td>
<td align="left">No association between origin and destination</td>
<td align="left">Baseline</td>
</tr>
<tr class="even">
<td align="left">Quasi-independence</td>
<td align="left">Immobility only; off-diagonal flows are random</td>
<td align="left">Standard mobility baseline</td>
</tr>
<tr class="odd">
<td align="left">Quasi-symmetry</td>
<td align="left">Flows are balanced in both directions</td>
<td align="left">Test for directional asymmetry</td>
</tr>
<tr class="even">
<td align="left">Uniform association</td>
<td align="left">Single ordinal gradient drives mobility</td>
<td align="left">Test for hierarchical ordering</td>
</tr>
<tr class="odd">
<td align="left">MONECA topology</td>
<td align="left">Segment structure explains mobility barriers</td>
<td align="left">Validate MONECA segmentation</td>
</tr>
</tbody>
</table>
<p>When the MONECA topology model outperforms quasi-independence, it
confirms that the algorithmic segmentation identifies real structural
boundaries in the mobility data. The segments are not just a convenient
visualization — they correspond to statistically measurable
discontinuities in how people move between categories.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Giampaolo Montaletti, Jonas Touboel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
