<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md • moneca</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CLAUDE.md"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">moneca</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/moneca-introduction.html">Introduction to moneca: Mobility Network Clustering Analysis</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="dropdown-item" href="https://gmontaletti.github.io/MONECA/news/index.html#moneca-100">Version 1.0.0</a></li>
    <li><a class="dropdown-item" href="https://gmontaletti.github.io/MONECA/news/index.html#moneca-09">Version 0.9</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gmontaletti/MONECA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>CLAUDE.md</h1>
      <small class="dont-index">Source: <a href="https://github.com/gmontaletti/MONECA/blob/master/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="about-moneca">About moneca<a class="anchor" aria-label="anchor" href="#about-moneca"></a></h2>
<p>moneca (Mobility Network Clustering Analysis) is an R package that creates weighted networks from mobility tables and uses cliques to create discrete and nested clusters. The package analyzes social mobility patterns through graph-theoretic approaches.</p>
<p><strong>Current Status (v0.9.2)</strong>: The package has been streamlined with a focused API of 21 exported functions, organized into core analysis, data generation, modern visualization, analysis tools, and legacy compatibility functions. Recent major revision removed archived experimental features and consolidated the codebase around the proven core algorithm and modern visualization system.</p>
</div>
<div class="section level2">
<h2 id="package-development-commands">Package Development Commands<a class="anchor" aria-label="anchor" href="#package-development-commands"></a></h2>
<div class="section level3">
<h3 id="building-and-checking">Building and Checking<a class="anchor" aria-label="anchor" href="#building-and-checking"></a></h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Build package</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>R CMD build .</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Check package (comprehensive validation)</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>R CMD check moneca_0.<span class="dv">4</span>.<span class="fl">0.</span>tar.gz</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># Install from source</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>R CMD INSTALL .</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co"># Alternative with devtools (recommended)</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">build</span>()</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check</span>()</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install</span>()</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testing-and-documentation">Testing and Documentation<a class="anchor" aria-label="anchor" href="#testing-and-documentation"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run comprehensive test suite</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">test</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate documentation with roxygen2</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">document</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build vignettes</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">build_vignettes</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run examples</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">run_examples</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load for interactive testing</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check test coverage</span></span>
<span><span class="fu">covr</span><span class="fu">::</span><span class="fu">package_coverage</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dependencies-installation">Dependencies Installation<a class="anchor" aria-label="anchor" href="#dependencies-installation"></a></h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install all required dependencies</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ggplot2"</span>, <span class="st">"ggraph"</span>, <span class="st">"igraph"</span>, <span class="st">"tidygraph"</span>, <span class="st">"dplyr"</span>, </span>
<span>                   <span class="st">"RColorBrewer"</span>, <span class="st">"scales"</span>, <span class="st">"toOrdinal"</span>, <span class="st">"grid"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install development dependencies</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"devtools"</span>, <span class="st">"testthat"</span>, <span class="st">"knitr"</span>, <span class="st">"rmarkdown"</span>, <span class="st">"covr"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Quick dependency check</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_deps</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="code-architecture">Code Architecture<a class="anchor" aria-label="anchor" href="#code-architecture"></a></h2>
<div class="section level3">
<h3 id="core-algorithm-flow">Core Algorithm Flow<a class="anchor" aria-label="anchor" href="#core-algorithm-flow"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>moneca()</strong>: Main clustering function that runs iterative segmentation</li>
<li>
<strong>moneca_fast()</strong>: Optimized implementation producing identical results to moneca()</li>
<li>
<strong>weight.matrix()</strong>: Converts mobility tables to relative risk matrices</li>
<li>
<strong>find.segments()</strong>: Identifies cliques in weighted networks (internal function)</li>
<li>
<strong>segment.matrix()</strong>: Aggregates mobility data by segments for next iteration (internal function)</li>
</ol></div>
<div class="section level3">
<h3 id="key-data-structures">Key Data Structures<a class="anchor" aria-label="anchor" href="#key-data-structures"></a></h3>
<ul><li>
<strong>segment.list</strong>: Nested list of clique memberships for each level</li>
<li>
<strong>mat.list</strong>: Mobility matrices for each segmentation level</li>
<li>
<strong>small.cell.reduction</strong>: Parameter controlling minimum cell sizes</li>
</ul></div>
<div class="section level3">
<h3 id="streamlined-api-21-exported-functions">Streamlined API (21 Exported Functions)<a class="anchor" aria-label="anchor" href="#streamlined-api-21-exported-functions"></a></h3>
<p>The package exports exactly 21 functions organized into functional groups:</p>
<div class="section level4">
<h4 id="core-analysis-3">Core Analysis (3)<a class="anchor" aria-label="anchor" href="#core-analysis-3"></a></h4>
<ul><li>moneca() - Main algorithm</li>
<li>moneca_fast() - Fast implementation</li>
<li>weight.matrix() - Weight matrix conversion</li>
</ul></div>
<div class="section level4">
<h4 id="data-generation-1">Data Generation (1)<a class="anchor" aria-label="anchor" href="#data-generation-1"></a></h4>
<ul><li>generate_mobility_data() - Synthetic data generator</li>
</ul></div>
<div class="section level4">
<h4 id="modern-visualization-5">Modern Visualization (5)<a class="anchor" aria-label="anchor" href="#modern-visualization-5"></a></h4>
<ul><li>plot_moneca_ggraph() - Main network plots</li>
<li>plot_ego_ggraph() - Ego network analysis</li>
<li>plot_stair_ggraph() - Multi-level visualization</li>
<li>plot_moneca_dendrogram() - Hierarchical tree plots</li>
<li>plot_segment_quality() - Quality assessment plots</li>
</ul></div>
<div class="section level4">
<h4 id="analysis-tools-6">Analysis Tools (6)<a class="anchor" aria-label="anchor" href="#analysis-tools-6"></a></h4>
<ul><li>segment.membership() - Extract membership</li>
<li>segment.membership.dataframe() - Membership as data frame</li>
<li>segment.quality() - Quality metrics</li>
<li>segment.edges() - Edge weights</li>
<li>segment.colors() - Color assignments</li>
<li>vertex.mobility() - Vertex-level metrics</li>
</ul></div>
<div class="section level4">
<h4 id="auto-tuning-1">Auto-Tuning (1)<a class="anchor" aria-label="anchor" href="#auto-tuning-1"></a></h4>
<ul><li>auto_tune_small_cell_reduction() - Parameter optimization</li>
</ul></div>
<div class="section level4">
<h4 id="legacy-visualization-5">Legacy Visualization (5)<a class="anchor" aria-label="anchor" href="#legacy-visualization-5"></a></h4>
<ul><li>moneca.plot() - Base R plotting</li>
<li>gg.moneca() - Original ggplot2</li>
<li>ego.plot() - Legacy ego network</li>
<li>stair.plot() - Legacy stair plot</li>
<li>layout.matrix() - Custom layout</li>
</ul></div>
</div>
<div class="section level3">
<h3 id="modern-visualization-system-rmodern_plottingr">Modern Visualization System (R/modern_plotting.R)<a class="anchor" aria-label="anchor" href="#modern-visualization-system-rmodern_plottingr"></a></h3>
<ul><li>
<strong>plot_moneca_ggraph()</strong>: Main network visualization with ggraph (RECOMMENDED)</li>
<li>
<strong>plot_ego_ggraph()</strong>: Ego network analysis plots with modern styling</li>
<li>
<strong>plot_stair_ggraph()</strong>: Multi-level segmentation visualization</li>
<li>
<strong>Enhanced Segment Naming</strong>: All modern plotting functions support flexible segment naming</li>
<li>
<strong>Legacy functions</strong>: <code><a href="reference/gg.moneca.html">gg.moneca()</a></code>, <code><a href="reference/moneca.plot.html">moneca.plot()</a></code>, <code><a href="reference/ego.plot.html">ego.plot()</a></code> still available</li>
</ul></div>
<div class="section level3">
<h3 id="synthetic-data-generation-rsynthetic_datar">Synthetic Data Generation (R/synthetic_data.R)<a class="anchor" aria-label="anchor" href="#synthetic-data-generation-rsynthetic_datar"></a></h3>
<ul><li>
<strong>generate_mobility_data()</strong>: Creates realistic synthetic mobility matrices</li>
<li>
<strong>generate_example_datasets()</strong>: Pre-configured datasets for different mobility scenarios</li>
<li>
<strong>Parameters</strong>: immobility_strength, class_clustering, noise_level, custom class names</li>
</ul></div>
<div class="section level3">
<h3 id="visualization-architecture">Visualization Architecture<a class="anchor" aria-label="anchor" href="#visualization-architecture"></a></h3>
<div class="section level4">
<h4 id="modern-ggraph-system-preferred">Modern ggraph System (Preferred)<a class="anchor" aria-label="anchor" href="#modern-ggraph-system-preferred"></a></h4>
<ul><li>Uses tidygraph for graph manipulation</li>
<li>ggraph for modern network layouts</li>
<li>Supports: FR, KK, stress, and custom layouts</li>
<li>Customizable node aesthetics (size, color, shape by segment/mobility)</li>
<li>Advanced edge styling (width, color, transparency by weight)</li>
</ul></div>
<div class="section level4">
<h4 id="legacy-plotting-backward-compatibility">Legacy Plotting (Backward Compatibility)<a class="anchor" aria-label="anchor" href="#legacy-plotting-backward-compatibility"></a></h4>
<ul><li>
<strong>moneca.plot()</strong>: Base R plotting using igraph</li>
<li>
<strong>gg.moneca()</strong>: Original ggplot2 plotting (depends on eliter package)</li>
<li>
<strong>layout.matrix()</strong>: Fruchterman-Reingold layout with segment-based attraction</li>
</ul></div>
</div>
<div class="section level3">
<h3 id="igraph-compatibility-system">igraph Compatibility System<a class="anchor" aria-label="anchor" href="#igraph-compatibility-system"></a></h3>
<p>The package includes a sophisticated compatibility layer (<code>R/igraph_compatibility.R</code>) that: - Automatically detects igraph version at runtime - Maps old dot-notation functions to new underscore functions - Provides custom <code>norm_coords</code> implementation for removed functions - Ensures compatibility with igraph &gt;= 1.3.0</p>
<p>Key compatibility functions: - <code><a href="reference/moneca_graph_from_adjacency.html">moneca_graph_from_adjacency()</a></code> → <code>graph.adjacency()</code> or <code>graph_from_adjacency_matrix()</code> - <code>moneca_get_edgelist()</code> → <code>get.edgelist()</code> or <code>as_edgelist()</code> - <code>moneca_norm_coords()</code> → custom implementation when <code>norm_coords</code> unavailable</p>
</div>
<div class="section level3">
<h3 id="modern-visualization-system">Modern Visualization System<a class="anchor" aria-label="anchor" href="#modern-visualization-system"></a></h3>
<p>The package now includes modern plotting functions using ggraph: - <code><a href="reference/plot_moneca_ggraph.html">plot_moneca_ggraph()</a></code>: Main network visualization with ggraph - <code><a href="reference/plot_ego_ggraph.html">plot_ego_ggraph()</a></code>: Ego network analysis plots<br>
- <code><a href="reference/plot_stair_ggraph.html">plot_stair_ggraph()</a></code>: Multi-level segmentation visualization - Legacy functions (<code><a href="reference/gg.moneca.html">gg.moneca()</a></code>, <code><a href="reference/moneca.plot.html">moneca.plot()</a></code>) still available for backward compatibility</p>
</div>
<div class="section level3">
<h3 id="enhanced-segment-naming-system">Enhanced Segment Naming System<a class="anchor" aria-label="anchor" href="#enhanced-segment-naming-system"></a></h3>
<p>All modern plotting functions support flexible segment naming through the <code>segment_naming</code> parameter:</p>
<div class="section level4">
<h4 id="input-types">Input Types:<a class="anchor" aria-label="anchor" href="#input-types"></a></h4>
<ul><li>
<strong>Character strings</strong>: “auto”, “concat”, “pattern”, “custom” (existing functionality)</li>
<li>
<strong>Data frame</strong>: Must have columns “name” and “segment_label” (NEW FEATURE)</li>
<li>
<strong>NULL</strong>: Defaults to “auto” strategy</li>
</ul></div>
<div class="section level4">
<h4 id="implementation-details">Implementation Details:<a class="anchor" aria-label="anchor" href="#implementation-details"></a></h4>
<ul><li>
<strong>Data frame validation</strong>: Ensures required columns exist</li>
<li>
<strong>Partial naming support</strong>: Missing names fall back to default strategies<br></li>
<li>
<strong>Cross-function consistency</strong>: Works across all plotting functions</li>
<li>
<strong>Error handling</strong>: Clear error messages for invalid inputs</li>
</ul></div>
<div class="section level4">
<h4 id="usage-examples">Usage Examples:<a class="anchor" aria-label="anchor" href="#usage-examples"></a></h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># String-based naming (existing)</span></span>
<span><span class="fu"><a href="reference/plot_moneca_ggraph.html">plot_moneca_ggraph</a></span><span class="op">(</span><span class="va">seg</span>, segment_naming <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Custom data frame (new)</span></span>
<span><span class="va">custom_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Class1"</span>, <span class="st">"Class2"</span>, <span class="st">"Class3"</span><span class="op">)</span>,</span>
<span>  segment_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Executive"</span>, <span class="st">"Professional"</span>, <span class="st">"Technical"</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/plot_moneca_ggraph.html">plot_moneca_ggraph</a></span><span class="op">(</span><span class="va">seg</span>, segment_naming <span class="op">=</span> <span class="va">custom_labels</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="synthetic-data-generation">Synthetic Data Generation<a class="anchor" aria-label="anchor" href="#synthetic-data-generation"></a></h3>
<ul><li>
<code><a href="reference/generate_mobility_data.html">generate_mobility_data()</a></code>: Creates realistic synthetic mobility matrices</li>
<li>
<code><a href="reference/generate_example_datasets.html">generate_example_datasets()</a></code>: Pre-configured datasets for different mobility scenarios</li>
<li>Supports customizable parameters: immobility strength, class clustering, noise levels</li>
</ul></div>
<div class="section level3">
<h3 id="testing-framework-teststestthat">Testing Framework (tests/testthat/)<a class="anchor" aria-label="anchor" href="#testing-framework-teststestthat"></a></h3>
<ul><li>
<strong>Comprehensive test suite</strong> using testthat (&gt;= 3.0.0)</li>
<li>
<strong>test-synthetic-data.R</strong>: Data generation validation, parameter handling, reproducibility</li>
<li>
<strong>test-moneca-core.R</strong>: Core algorithms, weight matrices, hierarchical segmentation</li>
<li>
<strong>test-plotting.R</strong>: Modern ggraph functions, parameter validation, error handling</li>
<li>
<strong>test-igraph-compatibility.R</strong>: Version compatibility, function mapping, edge cases</li>
<li>
<strong>Run tests</strong>: <code>devtools::test()</code> or <code>testthat::test_dir("tests")</code>
</li>
<li>
<strong>Coverage</strong>: Use <code>covr::package_coverage()</code> to check test coverage</li>
</ul></div>
<div class="section level3">
<h3 id="documentation-structure">Documentation Structure<a class="anchor" aria-label="anchor" href="#documentation-structure"></a></h3>
<ul><li>
<strong>Vignette</strong>: <code>vignettes/moneca-introduction.Rmd</code> - Comprehensive tutorial</li>
<li>
<strong>Function docs</strong>: Roxygen2-generated documentation with modern examples</li>
<li>
<strong>README.md</strong>: Updated with modern workflow, installation, quick start</li>
<li>
<strong>CLAUDE.md</strong>: Development guidance (this file)</li>
</ul></div>
<div class="section level3">
<h3 id="package-dependencies">Package Dependencies<a class="anchor" aria-label="anchor" href="#package-dependencies"></a></h3>
<ul><li>
<strong>Core Required</strong>: ggplot2 (&gt;= 3.4.0), ggraph (&gt;= 2.0.0), igraph (&gt;= 1.3.0), tidygraph (&gt;= 1.2.0), dplyr (&gt;= 1.0.0)</li>
<li>
<strong>Additional</strong>: RColorBrewer, scales, toOrdinal, grid, stats, grDevices</li>
<li>
<strong>Development</strong>: knitr, rmarkdown, testthat (&gt;= 3.0.0)</li>
<li>
<strong>Check deps</strong>: <code>devtools::install_deps()</code> installs all required dependencies</li>
</ul></div>
<div class="section level3">
<h3 id="development-best-practices">Development Best Practices<a class="anchor" aria-label="anchor" href="#development-best-practices"></a></h3>
<ul><li>
<strong>S3 classes</strong> with custom print methods for MONECA objects</li>
<li>
<strong>Backward compatibility</strong> maintained for all existing functions</li>
<li>
<strong>Modern examples</strong> use synthetic data (no external dependencies)</li>
<li>
<strong>Extensive parameter validation</strong> with informative error messages</li>
<li>
<strong>Reproducible analysis</strong> with seed parameters in synthetic data</li>
<li>
<strong>Modular architecture</strong> with clear separation of concerns</li>
<li>
<strong>Enhanced visualization features</strong> like flexible segment naming improve usability</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="quick-start-for-development">Quick Start for Development<a class="anchor" aria-label="anchor" href="#quick-start-for-development"></a></h2>
<div class="section level3">
<h3 id="testing-new-features">Testing New Features<a class="anchor" aria-label="anchor" href="#testing-new-features"></a></h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load package for development</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate test data</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/generate_mobility_data.html">generate_mobility_data</a></span><span class="op">(</span>n_classes <span class="op">=</span> <span class="fl">5</span>, seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run analysis</span></span>
<span><span class="va">seg</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/moneca.html">moneca</a></span><span class="op">(</span><span class="va">test_data</span>, segment.levels <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test modern plotting</span></span>
<span><span class="fu"><a href="reference/plot_moneca_ggraph.html">plot_moneca_ggraph</a></span><span class="op">(</span><span class="va">seg</span>, node_color <span class="op">=</span> <span class="st">"segment"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test enhanced segment naming</span></span>
<span><span class="va">custom_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>  segment_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Executive"</span>, <span class="st">"Professional"</span>, <span class="st">"Technical"</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/plot_moneca_ggraph.html">plot_moneca_ggraph</a></span><span class="op">(</span><span class="va">seg</span>, segment_naming <span class="op">=</span> <span class="va">custom_names</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run specific tests</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_file.html" class="external-link">test_file</a></span><span class="op">(</span><span class="st">"tests/testthat/test-moneca-core.R"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="common-development-tasks">Common Development Tasks<a class="anchor" aria-label="anchor" href="#common-development-tasks"></a></h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Update documentation after changes</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">document</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check package thoroughly</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install and test locally</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build vignettes after updates</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">build_vignettes</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="file-organization">File Organization<a class="anchor" aria-label="anchor" href="#file-organization"></a></h3>
<ul><li>
<strong>R/moneca.R</strong>: Package-level documentation</li>
<li>
<strong>R/analytical_functions.R</strong>: Core algorithm (moneca(), find.segments(), internal functions)</li>
<li>
<strong>R/moneca_fast.R</strong>: Fast implementation with optimized algorithms</li>
<li>
<strong>R/modern_plotting.R</strong>: Modern ggraph visualization functions</li>
<li>
<strong>R/synthetic_data.R</strong>: Data generation functions</li>
<li>
<strong>R/descriptive_functions.R</strong>: Analysis tools (segment.membership, segment.quality, etc.)</li>
<li>
<strong>R/ggplotting.R</strong>: Legacy ggplot2 functions (backward compatibility)</li>
<li>
<strong>R/auto_tuning.R</strong>: Auto-tuning functionality</li>
<li>
<strong>R/igraph_compatibility.R</strong>: Version compatibility layer</li>
<li>
<strong>R/optimized_algorithms.R</strong>: Performance-optimized internal algorithms</li>
<li>
<strong>tests/testthat/</strong>: Complete test suite</li>
<li>
<strong>vignettes/</strong>: Package tutorial and documentation</li>
<li>
<strong>man/</strong>: Auto-generated function documentation</li>
</ul></div>
<div class="section level3">
<h3 id="migration-notes-for-existing-users">Migration Notes for Existing Users<a class="anchor" aria-label="anchor" href="#migration-notes-for-existing-users"></a></h3>
<ul><li>
<strong>Package name</strong>: Changed from MONECA to moneca (lowercase)</li>
<li>
<strong>Installation</strong>: Use <code>install_github("gmontaletti/moneca")</code> instead of the original repository</li>
<li>
<strong>Loading</strong>: Use <code><a href="https://gmontaletti.github.io/MONECA/">library(moneca)</a></code> instead of <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library(MONECA)</a></code>
</li>
<li>
<strong>Plotting</strong>: Recommend migrating from <code><a href="reference/gg.moneca.html">gg.moneca()</a></code> to <code><a href="reference/plot_moneca_ggraph.html">plot_moneca_ggraph()</a></code>
</li>
<li>
<strong>Data</strong>: Use <code><a href="reference/generate_mobility_data.html">generate_mobility_data()</a></code> instead of external datasets for examples</li>
<li>
<strong>Performance</strong>: Use <code><a href="reference/moneca_fast.html">moneca_fast()</a></code> for large datasets (produces identical results)</li>
<li>
<strong>Testing</strong>: All core functions continue to work unchanged</li>
<li>
<strong>Dependencies</strong>: Package now requires ggraph and tidygraph for modern features</li>
</ul></div>
<div class="section level3">
<h3 id="development-guidelines">Development Guidelines<a class="anchor" aria-label="anchor" href="#development-guidelines"></a></h3>
<ul><li>Never change the original moneca() function - it is the reference implementation</li>
<li>Use moneca_fast() for performance improvements while maintaining identical results</li>
<li>The reference directory for cleanup/move file operations is in ../reference/moneca/</li>
<li>When bumping version, update citation in README.md</li>
<li>Maintain backward compatibility for all exported functions</li>
<li>All new visualization should use ggraph-based modern_plotting.R functions</li>
</ul></div>
<div class="section level3">
<h3 id="recent-major-revision-v092">Recent Major Revision (v0.9.2)<a class="anchor" aria-label="anchor" href="#recent-major-revision-v092"></a></h3>
<ul><li>Removed experimental/archived features (parallel processing, temporal analysis, advanced tuning variants)</li>
<li>Consolidated to 21 well-tested exported functions</li>
<li>Simplified vignette to focus on core workflow: moneca() → moneca_fast() → plot_*()</li>
<li>Updated all documentation to reflect streamlined API</li>
<li>Retained full backward compatibility for existing code</li>
</ul></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Giampaolo Montaletti, Jonas Touboel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

