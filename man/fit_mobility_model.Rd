% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/loglinear_models.R
\name{fit_mobility_model}
\alias{fit_mobility_model}
\title{Fit Log-Linear Models to Mobility Tables}
\usage{
fit_mobility_model(
  mx,
  type = c("independence", "quasi_independence", "quasi_symmetry", "uniform_association",
    "moneca_topology"),
  level = NULL,
  scores = c("integer", "midrank"),
  small.cell.reduction = 0
)
}
\arguments{
\item{mx}{A mobility matrix with margins (totals row/column), OR a moneca
object. If a moneca object, the matrix is extracted from
\code{mat.list[[1]]}.}

\item{type}{Character string specifying the model type. One of:
\describe{
  \item{\code{"independence"}}{No origin-destination association. Baseline
    with 2(n-1) parameters.}
  \item{\code{"quasi_independence"}}{Accounts for diagonal immobility
    cells. Adds n diagonal parameters. Standard mobility table baseline.}
  \item{\code{"quasi_symmetry"}}{Tests whether mobility O->D equals D->O.
    Adds n diagonal and n*(n-1)/2 symmetric pair parameters.}
  \item{\code{"uniform_association"}}{Single-parameter association model
    using row/column scores.}
  \item{\code{"moneca_topology"}}{Tests whether MONECA segments explain
    mobility structure beyond diagonal effects. Requires a moneca object
    or explicit segment membership.}
}}

\item{level}{Integer specifying the hierarchical level for MONECA topology
model. Required when \code{type = "moneca_topology"} and \code{mx} is a
moneca object. Default is NULL.}

\item{scores}{Character string specifying score type for uniform association
model: \code{"integer"} (default) or \code{"midrank"}.}

\item{small.cell.reduction}{Numeric. Cells with counts below this value
are set to zero before fitting. Default is 0 (no reduction).}
}
\value{
An object of class \code{"moneca_loglinear"} containing:
  \describe{
    \item{model}{The \code{glm} fit object}
    \item{type}{Model type string}
    \item{deviance}{Residual deviance (G-squared)}
    \item{df}{Residual degrees of freedom}
    \item{aic}{Akaike Information Criterion}
    \item{bic}{Bayesian Information Criterion}
    \item{p_value}{P-value from chi-squared goodness-of-fit test}
    \item{dissimilarity_index}{Proportion of cases misclassified}
    \item{coefficients}{Named coefficient vector}
    \item{fitted}{Fitted values reshaped as n x n matrix}
    \item{residuals}{Pearson residuals reshaped as n x n matrix}
    \item{design_info}{List describing the design matrix construction}
    \item{original_matrix}{The input mobility matrix (with margins)}
    \item{segment_level}{Level used (moneca_topology only, NULL otherwise)}
  }
}
\description{
Fits standard log-linear models to mobility tables for statistical
testing of mobility structure. Supports independence, quasi-independence,
quasi-symmetry, uniform association, and MONECA topology models.
}
\details{
All models are fit as Poisson log-linear models using \code{glm()}.
The deviance statistic (G-squared) tests the goodness of fit relative
to the saturated model. A non-significant p-value indicates the model
adequately describes the observed mobility patterns.

The BIC is computed using the number of cells (n-squared) as the sample
size, which is the standard R approach for GLMs. For contingency table
comparisons based on total count N, users should refer to the deviance
and degrees of freedom directly.

The dissimilarity index indicates the proportion of individuals that
would need to be reclassified for the model to fit exactly. Values
below 0.05 indicate good fit; below 0.03 indicates excellent fit.
}
\examples{
# Generate test data and run MONECA
mx <- generate_mobility_data(n_classes = 5, seed = 42)
seg <- moneca_fast(mx, segment.levels = 3)

# Fit different models
m_ind <- fit_mobility_model(mx, type = "independence")
m_qi <- fit_mobility_model(mx, type = "quasi_independence")

# Fit MONECA topology model
m_top <- fit_mobility_model(seg, type = "moneca_topology", level = 2)

# Compare models
compare_mobility_models(m_ind, m_qi, m_top)

}
\seealso{
\code{\link{compare_mobility_models}} for model comparisons,
  \code{\link{moneca}} for the main clustering algorithm
}
