<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Temporal Mobility Network Clustering Analysis — moneca_temporal • moneca</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Temporal Mobility Network Clustering Analysis — moneca_temporal"><meta name="description" content="Performs moving window clustering analysis on a time series of mobility matrices,
maintaining stable segment labels across time periods. This function extends MONECA
to handle temporal data by analyzing overlapping windows of mobility matrices and
tracking how segments evolve over time."><meta property="og:description" content="Performs moving window clustering analysis on a time series of mobility matrices,
maintaining stable segment labels across time periods. This function extends MONECA
to handle temporal data by analyzing overlapping windows of mobility matrices and
tracking how segments evolve over time."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">moneca</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.9.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/moneca-introduction.html">Introduction to moneca: Mobility Network Clustering Analysis</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="dropdown-item" href="https://gmontaletti.github.io/MONECA/news/index.html#moneca-08">Version 0.8</a></li>
    <li><a class="dropdown-item" href="https://gmontaletti.github.io/MONECA/news/index.html#moneca-07">Version 0.7</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gmontaletti/MONECA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Temporal Mobility Network Clustering Analysis</h1>
      <small class="dont-index">Source: <a href="https://github.com/gmontaletti/MONECA/blob/master/R/temporal_clustering.R" class="external-link"><code>R/temporal_clustering.R</code></a></small>
      <div class="d-none name"><code>moneca_temporal.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs moving window clustering analysis on a time series of mobility matrices,
maintaining stable segment labels across time periods. This function extends MONECA
to handle temporal data by analyzing overlapping windows of mobility matrices and
tracking how segments evolve over time.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">moneca_temporal</span><span class="op">(</span></span>
<span>  <span class="va">matrix_list</span>,</span>
<span>  window_size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  segment.levels <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  stability_method <span class="op">=</span> <span class="st">"hungarian"</span>,</span>
<span>  aggregation_method <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  cut.off <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  small.cell.reduction <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  min_overlap <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-matrix-list">matrix_list<a class="anchor" aria-label="anchor" href="#arg-matrix-list"></a></dt>
<dd><p>List of mobility matrices, one for each time period. Each matrix
must be square with identical dimensions and row/column names.</p></dd>


<dt id="arg-window-size">window_size<a class="anchor" aria-label="anchor" href="#arg-window-size"></a></dt>
<dd><p>Integer specifying the number of time periods to include in each
moving window. Default is 3.</p></dd>


<dt id="arg-segment-levels">segment.levels<a class="anchor" aria-label="anchor" href="#arg-segment-levels"></a></dt>
<dd><p>Integer specifying the maximum number of hierarchical
segmentation levels. Default is 3.</p></dd>


<dt id="arg-stability-method">stability_method<a class="anchor" aria-label="anchor" href="#arg-stability-method"></a></dt>
<dd><p>Character string specifying the method for matching segments
across time periods:</p><ul><li><p>"hungarian" (default): Uses Hungarian algorithm for optimal bipartite matching</p></li>
<li><p>"jaccard": Uses Jaccard similarity of segment memberships</p></li>
<li><p>"overlap": Simple overlap coefficient</p></li>
</ul></dd>


<dt id="arg-aggregation-method">aggregation_method<a class="anchor" aria-label="anchor" href="#arg-aggregation-method"></a></dt>
<dd><p>Character string specifying how to combine matrices within
each window:</p><ul><li><p>"mean" (default): Average of matrices in window</p></li>
<li><p>"sum": Sum of matrices</p></li>
<li><p>"weighted": Weighted average with more recent periods having higher weight</p></li>
</ul></dd>


<dt id="arg-cut-off">cut.off<a class="anchor" aria-label="anchor" href="#arg-cut-off"></a></dt>
<dd><p>Numeric threshold for minimum relative risk. Default is 1.</p></dd>


<dt id="arg-small-cell-reduction">small.cell.reduction<a class="anchor" aria-label="anchor" href="#arg-small-cell-reduction"></a></dt>
<dd><p>Numeric value for handling small cells. Default is 0.</p></dd>


<dt id="arg-min-overlap">min_overlap<a class="anchor" aria-label="anchor" href="#arg-min-overlap"></a></dt>
<dd><p>Minimum proportion of nodes that must overlap between segments
for matching. Default is 0.5.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Logical indicating whether to use parallel processing for windows.
When TRUE, windows are processed in parallel using multiple CPU cores, which can
significantly speed up analysis for large datasets. Uses mclapply on Unix/Mac
and parLapply on Windows. Default is FALSE.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical indicating whether to show progress messages. Default is TRUE.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to moneca().</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class "moneca_temporal" containing:</p><dl><dt>windows</dt>
<dd><p>List of time windows analyzed (start and end periods)</p></dd>

    <dt>segment_maps</dt>
<dd><p>List of segment membership matrices for each window</p></dd>

    <dt>stable_labels</dt>
<dd><p>Consistently labeled segments across all time periods</p></dd>

    <dt>transition_matrix</dt>
<dd><p>Matrix showing segment-to-segment transitions</p></dd>

    <dt>moneca_results</dt>
<dd><p>List of full moneca objects for each window</p></dd>

    <dt>matching_history</dt>
<dd><p>Details of segment matching between windows</p></dd>

    <dt>parameters</dt>
<dd><p>List of analysis parameters used</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function performs the following steps:
1. Creates overlapping windows of specified size from the input matrices
2. Aggregates matrices within each window according to aggregation_method
3. Runs moneca clustering on each aggregated window
4. Matches segments between consecutive windows to maintain label stability
5. Tracks transitions and changes in segment composition</p>
<p>Segment matching uses either the Hungarian algorithm for optimal assignment
based on membership overlap, or Jaccard similarity for simpler matching.
The function ensures that segment labels remain as consistent as possible
across time periods, making it easier to track segment evolution.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="moneca.html">moneca</a></code> for single-period analysis,
<code><a href="temporal_stability_analysis.html">temporal_stability_analysis</a></code> for stability metrics,
<code><a href="plot_temporal_segments.html">plot_temporal_segments</a></code> for visualization</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Generate synthetic monthly mobility data</span></span></span>
<span class="r-in"><span><span class="va">months_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="generate_mobility_data.html">generate_mobility_data</a></span><span class="op">(</span>n_classes <span class="op">=</span> <span class="fl">6</span>, seed <span class="op">=</span> <span class="va">m</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run temporal analysis with 3-month moving window (sequential)</span></span></span>
<span class="r-in"><span><span class="va">temporal_result</span> <span class="op">&lt;-</span> <span class="fu">moneca_temporal</span><span class="op">(</span></span></span>
<span class="r-in"><span>  matrix_list <span class="op">=</span> <span class="va">months_data</span>,</span></span>
<span class="r-in"><span>  window_size <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  segment.levels <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  stability_method <span class="op">=</span> <span class="st">"hungarian"</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run with parallel processing for faster execution</span></span></span>
<span class="r-in"><span><span class="va">temporal_result_parallel</span> <span class="op">&lt;-</span> <span class="fu">moneca_temporal</span><span class="op">(</span></span></span>
<span class="r-in"><span>  matrix_list <span class="op">=</span> <span class="va">months_data</span>,</span></span>
<span class="r-in"><span>  window_size <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  segment.levels <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  stability_method <span class="op">=</span> <span class="st">"hungarian"</span>,</span></span>
<span class="r-in"><span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,  <span class="co"># Enable parallel processing</span></span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Print summary</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">temporal_result</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Analyze stability</span></span></span>
<span class="r-in"><span><span class="va">stability</span> <span class="op">&lt;-</span> <span class="fu"><a href="temporal_stability_analysis.html">temporal_stability_analysis</a></span><span class="op">(</span><span class="va">temporal_result</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Giampaolo Montaletti, Jonas Touboel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

